var gmwa=gmwa||{};gmwa.init=function(e,o,r){if(gmwa.logger.init(o),gmwa.logger.log("App|GM WebApp started"),gmwa.isSafari=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),gmwa.storage=Storages.localStorage,gmwa.mapsFW=r,void 0===e);else if(gmwa.storage.isEmpty("_gmwa_dt"))gmwa.storage.set("_gmwa_dt",e);else{var t=gmwa.storage.get("_gmwa_dt");t!=e&&(gmwa.storage.set("_gmwa_dt",e),gmwa.webpush.subscribe())}gmwa.services.worker.register(),window.lazySizesConfig=window.lazySizesConfig||{},window.lazySizesConfig.hFac=.4,window.dayjs&&window.dayjs.locale("es"),gmwa.components.maps&&gmwa.components.maps.init(r),gmwa.initDefaults(),gmwa.router.init()},gmwa.initDefaults=function(){$(".list-collapsible").on("click",function(){$(this).next("div:first").slideToggle("slow")})};var gmwa=gmwa||{};gmwa.config={gcmAPIKey:"AAAAOWC1TY0:APA91bFOZCjb4Iy4LE8VaXvAYm4xstzeKCHNMncRSLTMckFLzyDrSVttOFDH5txUneCoqLjTC-49nuu_dsrF60zw-j7XPq53iPB1niUjSc4gjp6F1DjrynpPIZFQgwHx-eMCZoHNvsbe"};var gmwa=gmwa||{};gmwa.logger={},gmwa.logger.init=function(e){gmwa.logger.debug=e,e?(gmwa.logger.log=console.log.bind(window.console),gmwa.logger.info=console.info.bind(window.console),gmwa.logger.warn=console.warn.bind(window.console),gmwa.logger.error=console.error.bind(window.console)):(gmwa.logger.log=function(){},gmwa.logger.info=function(){},gmwa.logger.warn=function(){},gmwa.logger.error=function(){})};var gmwa=gmwa||{};gmwa.router={},gmwa.router.sendPushSubscription=!1,gmwa.router.init=function(){"/"==window.location.pathname?(gmwa.logger.log("Router|Resolved to home controller"),gmwa.controllers.home.init()):"/local"==window.location.pathname.substr(0,6)?(gmwa.logger.log("Router|Resolved to comercio controller"),gmwa.controllers.comercio.init()):"/reservar"==window.location.pathname.substr(0,9)?(gmwa.logger.log("Router|Resolved to reserve controller"),gmwa.controllers.reserve.init()):"/fotos"==window.location.pathname.substr(0,6)?(gmwa.logger.log("Router|Resolved to gals controller"),gmwa.controllers.gals.init()):"/buscar"==window.location.pathname.substr(0,7)||"/rubro"==window.location.pathname.substr(0,6)||"/rubro-zona"==window.location.pathname.substr(0,11)||"/zona"==window.location.pathname.substr(0,5)?(gmwa.logger.log("Router|Resolved to resultList controller"),gmwa.controllers.resultlist.init()):"/promociones-y-ofertas"==window.location.pathname?(gmwa.logger.log("Router|Resolved to promosHome controller"),gmwa.controllers.promosHome.init()):"/promociones-y-ofertas"==window.location.pathname.substr(0,22)?(gmwa.logger.log("Router|Resolved to promosAll controller"),gmwa.controllers.promosAll.init()):"/promociones/"==window.location.pathname.substr(0,13)?(gmwa.logger.log("Router|Resolved to promosSponsor controller"),gmwa.controllers.promosSponsor.init()):"/promocion/"==window.location.pathname.substr(0,11)?(gmwa.logger.log("Router|Resolved to promosFicha controller"),gmwa.controllers.promosFicha.init()):"/pedidos"==window.location.pathname?(gmwa.logger.log("Router|Resolved to requestsList controller"),gmwa.controllers.requestsList.init()):"/pedir/"==window.location.pathname.substr(0,7)?(gmwa.logger.log("Router|Resolved to store controller"),gmwa.router.sendPushSubscription=!0,gmwa.controllers.store.init()):"/pd/"==window.location.pathname.substr(0,4)?(gmwa.logger.log("Router|Resolved to productOrderMenu controller"),gmwa.router.sendPushSubscription=!0,gmwa.controllers.productOrderMenu.init()):"/presupuesto/v/"==window.location.pathname.substr(0,15)?(gmwa.logger.log("Router|Resolved to quoteView controller"),gmwa.controllers.quoteView.init()):"/presupuesto/"==window.location.pathname.substr(0,13)?(gmwa.logger.log("Router|Resolved to quoteRequest controller"),gmwa.router.sendPushSubscription=!0,gmwa.controllers.quoteRequest.init()):"/pedidos/pedido"==window.location.pathname.substr(0,15)?(gmwa.logger.log("Router|Resolved to orderView controller"),gmwa.controllers.orderView.init()):"/pedido/checkout"==window.location.pathname.substr(0,16)?(gmwa.logger.log("Router|Resolved to orderCheckout controller"),gmwa.router.sendPushSubscription=!0,gmwa.controllers.orderCheckout.init()):"/cartelera"==window.location.pathname.substr(0,10)?(gmwa.logger.log("Router|Resolved to cartelera controller"),gmwa.controllers.cartelera.init()):"/horoscopo"==window.location.pathname.substr(0,10)?(gmwa.logger.log("Router|Resolved to horoscopo controller"),gmwa.controllers.horoscopo.init()):"/reportarerror"==window.location.pathname.substr(0,14)?(gmwa.logger.log("Router|Resolved to reportar error controller"),gmwa.controllers.reportarError.init()):"/contacto"==window.location.pathname.substr(0,9)?(gmwa.logger.log("Router|Resolved to contacto controller"),gmwa.controllers.contact.init()):"/azar"==window.location.pathname.substr(0,5)?(gmwa.logger.log("Router|Resolved to azar controller"),gmwa.controllers.azar.init()):"/login"==window.location.pathname.substr(0,6)?(gmwa.logger.log("Router|Resolved to login controller"),gmwa.controllers.login.init()):"/favs"==window.location.pathname.substr(0,5)?(gmwa.logger.log("Router|Resolved to favorites controller"),gmwa.controllers.favorites.init()):(gmwa.logger.log("Router|Resolved to default home controller"),gmwa.controllers.home.init())};var gmwa=gmwa||{};gmwa.utils={},gmwa.utils.eErrMsg=null,gmwa.utils.isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},gmwa.utils.isAndroid=function(){return/Android/i.test(navigator.userAgent)},gmwa.utils.showProgress=function(e,o,r,t){var a='<div id="divProgress" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;z-index:2000;background-color: rgba(0,0,0,0.5);text-align: center;">';r&&(a+='<div style="margin-top: 20px;text-align: center;background-color: #FFF;display: inline-block;padding: 10px; box-shadow: 0px 2px 6px 0px rgba(0,0,0,0.5);">',a+='<div id="galspinner" class="spinner" style="margin-top: 20px;"><div class="rect1" style="background-color:#757575"></div><div class="rect2" style="background-color:#757575"></div><div class="rect3" style="background-color:#757575"></div><div class="rect4" style="background-color:#757575"></div><div class="rect5" style="background-color:#757575"></div></div>',a+='<div style="font-size:22px;font-weight:100">'+e+"</div><div>"+o+"</div></div>"),a+="</div>",gmwa.utils.divProgress=$(a),t&&($("#guia-container").css("filter","blur(2px)"),$("#guia-container").css("-webkit-filter:","blur(2px)")),$("body").append(gmwa.utils.divProgress)},gmwa.utils.hideProgress=function(){$("#divProgress").remove(),$("#guia-container").css("filter","blur(0px)"),$("#guia-container").css("-webkit-filter:","blur(0px)")},gmwa.utils.showError=function(e,o){if(null===gmwa.utils.eErrMsg){var r='<div class="tiny reveal" id="errMsg" data-reveal><h4>'+e+"</h4><p>"+o+'</p><button class="button" data-close>OK</button><button class="close-button" data-close aria-label="Close reveal" type="button"><span aria-hidden="true">&times;</span></button></div>';gmwa.utils.eErrMsg=$(r),gmwa.utils.eErrMsg.foundation(),gmwa.utils.eErrMsg.foundation("open")}else gmwa.utils.eErrMsg.foundation("open")},gmwa.utils.scrollTo=function(e){$("html, body").animate({scrollTop:$("#"+e).offset().top},500)},gmwa.utils.flash=function(e){$("#"+e).effect("highlight",{},2e3)},gmwa.utils.formatNumber=function(e,o,r,t,a){o="undefined"==typeof o?2:o,r="undefined"==typeof r?".":r,t="undefined"==typeof t?",":t,a="undefined"==typeof a?"$U":a;var n=3,l="\\d(?=(\\d{"+(n||3)+"})+"+(o>0?"\\D":"$")+")",i=parseFloat(e).toFixed(Math.max(0,~~o));return(t?i.replace(".",t):i).replace(new RegExp(l,"g"),"$&"+(r||","))},gmwa.utils.formatNumberObject=function(e,o,r,t,a){o="undefined"==typeof o?2:o,r="undefined"==typeof r?".":r,t="undefined"==typeof t?",":t,a="undefined"==typeof a?"$U":a;var n=3,l="\\d(?=(\\d{"+(n||3)+"})+"+(o>0?"\\D":"$")+")",i=parseFloat(e).toFixed(Math.max(0,~~o)),s=(t?i.replace(".",t):i).replace(new RegExp(l,"g"),"$&"+(r||",")).toString(),c=s.split(",");return{number:c[0],decimals:"undefined"==typeof c[1]?"":c[1],currency:a}},gmwa.utils.formatNumberHTML=function(e,o,r,t,a){o="undefined"==typeof o?2:o,r="undefined"==typeof r?".":r,t="undefined"==typeof t?",":t,a="undefined"==typeof a?"$U":a;var n=3,l="\\d(?=(\\d{"+(n||3)+"})+"+(o>0?"\\D":"$")+")",i=parseFloat(e).toFixed(Math.max(0,~~o)),s=(t?i.replace(".",t):i).replace(new RegExp(l,"g"),"$&"+(r||",")).toString(),c=s.split(","),d={number:c[0],decimals:"undefined"==typeof c[1]?"":c[1],currency:a};return'<span class="currency">'+d.currency+"</span> "+d.number+'<span class="decimals">,'+d.decimals+"</span>"},gmwa.utils.loadStylesheet=function(e,o){var r=document.createElement("link");r.href=e,r.rel="stylesheet",r.type="text/css",r.media="only x",r.onload=function(){r.media="all",o()},document.getElementsByTagName("head")[0].appendChild(r)},gmwa.utils.loadScript=function(e,o){var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.readyState?r.onreadystatechange=function(){("loaded"==r.readyState||"complete"==r.readyState)&&(r.onreadystatechange=null,o&&"function"==typeof o&&o())}:r.onload=function(){o&&"function"==typeof o&&o()},r.src=e,(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(r)},gmwa.utils.sendGAEvent=function(e,o,r){if(gtag){console.log("Utils | sendGAEvent | Sending event("+e+","+o+","+r+")");var t=r.split("|"),a=t[0],n=t[1],l=t[2];gtag("event",o,{event_category:e,event_label:r,name:a,idr:n,ids:l})}},gmwa.utils.isEmail=function(e){var o=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return o.test(e)};var gmwa=gmwa||{};gmwa.webpush={},gmwa.webpush.isPushEnabled=!1,gmwa.webpush.isPushSupported=!1,gmwa.webpush.isBlocked=!1,gmwa.webpush.pushId="web.uy.com.1122",gmwa.webpush.urlBase64ToUint8Array=function(e){const o="=".repeat((4-e.length%4)%4),r=(e+o).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(r),a=new Uint8Array(t.length);for(var n=0;n<t.length;++n)a[n]=t.charCodeAt(n);return a},gmwa.webpush.unsubscribe=function(e){gmwa.isSafari||navigator.serviceWorker.ready.then(function(o){gmwa.logger.log("WebPush|Unsubscribe from push requested"),o.pushManager.getSubscription().then(function(o){return o?void o.unsubscribe().then(function(){gmwa.logger.log("WebPush|Push service unsubscribed"),gmwa.webpush.isPushEnabled=!1,e(0)})["catch"](function(o){e(-1),gmwa.logger.log("WebPush|Unsubscription error: ",o)}):(gmwa.webpush.isPushEnabled=!1,gmwa.logger.log("WebPush|No subscription yet. User must request permission"),void e(0))})["catch"](function(o){e(-2),gmwa.logger.log("WebPush|Error thrown while unsubscribing from push messaging.",o)})})},gmwa.webpush.subscribe=function(e){if(gmwa.isSafari)if("safari"in window&&"pushNotification"in window.safari){gmwa.logger.log("WebPush|Subscribe to push requested for PushID "+gmwa.webpush.pushId);var o=window.safari.pushNotification.permission(gmwa.webpush.pushId);if("denied"===o.permission)gmwa.logger.log("WebPush|Permission for Notifications was denied"),gmwa.logger.log(o),e&&e(-1);else{if("granted"===o.permission)return gmwa.webpush.isPushEnabled=!0,e&&e(0),gmwa.logger.log("WebPush|Permission for Notifications was granted!"),gmwa.logger.log(o),gmwa.webpush.sendSubscriptionToServer({isAPN:!0,endpoint:o.deviceToken});"default"===o.permission?window.safari.pushNotification.requestPermission("https://wgm.tingelmar.com",gmwa.webpush.pushId,{id:"web.wgm"},function(o){if("denied"===o.permission)gmwa.logger.log("WebPush|Permission for Notifications was denied"),gmwa.logger.log(o),e&&e(-1);else{if("granted"===o.permission)return gmwa.webpush.isPushEnabled=!0,gmwa.logger.log("WebPush|Permission for Notifications was granted!"),gmwa.logger.log(o),e&&e(0),gmwa.webpush.sendSubscriptionToServer({isAPN:!0,endpoint:o.deviceToken});gmwa.logger.log("WebPush|Permission for Notifications is unknown!"),gmwa.logger.log(o)}}):(gmwa.logger.log("WebPush|Permission for Notifications is unknown!"),gmwa.logger.log(o))}}else gmwa.logger.log("WebPush|WebPush not supported"),e&&e(-2);else navigator.serviceWorker.ready.then(function(o){gmwa.logger.log("WebPush|Subscribe to push requested");var r="";r=window.location.hostname.toLowerCase().indexOf("buscoinfo")>=0?"BMdNOGlVFilaDpgOdZTP1znMUxo93j6ck8J4Rt3sMpdPHPkoyiJTfuUe3X2379dMfIy-zDETn3S_2GF5Ownc_qg":"BAmkGWd5l67dpfKt35y1C5w33tyxuK3if4XbYLe3j69z2R5ZhLPsh3-flPdwIC_1Ecle9WRHXJXY_s61uzIlMFo",gmwa.logger.log("WebPush|Will request notifications subscription with pub key => "+r);const t=gmwa.webpush.urlBase64ToUint8Array(r);o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t}).then(function(o){return gmwa.webpush.isPushEnabled=!0,e&&e(0),gmwa.webpush.sendSubscriptionToServer(o)})["catch"](function(o){"denied"===Notification.permission?(gmwa.logger.log("WebPush|Permission for Notifications was denied"),e&&e(-1)):(gmwa.logger.error("WebPush|Unable to subscribe to push.",o),e&&e(-2))})})},gmwa.webpush.sendSubscriptionToServer=function(e){var o=(e.endpoint.split("/"),JSON.stringify(e)),r="/pedidos/pushsubscribe?dt="+gmwa.storage.get("_gmwa_dt");$.ajax({type:"POST",url:r,data:o,dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){0===e.outcode?(gmwa.logger.log("WebPush|API returned OK: "+JSON.stringify(e)),gmwa.storage.set("_gmwa_subscription",o),gmwa.logger.log("WebPush|Subscription saved to local storage"),gmwa.logger.log(o)):gmwa.logger.error("WebPush|API returned error: "+JSON.stringify(e))}).fail(function(e){gmwa.logger.error("WebPush|API returned error: "+JSON.stringify(e))})};var gmwa=gmwa||{};gmwa.components=gmwa.components||{},gmwa.components.galleryviewer={},gmwa.components.galleryviewer.init=function(){gmwa.logger.log("GalleryViewer|Init..."),$("a.gal-image-ho").on("click",function(e){e.preventDefault();var o=-1;if("PICTURE"==e.currentTarget.childNodes[0].tagName.toUpperCase()){var r=e.currentTarget.childNodes[0].getElementsByTagName("img");if(r&&r.length){var t=r[0].attributes.index;t&&(o=parseInt(t.nodeValue))}}else o=parseInt(e.currentTarget.childNodes[0].attributes.index.nodeValue);if(-1!=o){var a='<div id="galviewer"><i class="fa fa-times gal-close" aria-hidden="true"></i><div id="galspinner" class="spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div><div id="galspinnertext" style="text-align: center;color: #FFF;font-size: 13px;">Cargando...</div><div id="gal-cntr" class="gal-cntr" style="display:none"><div class="gal-prev"><i class="fa fa-angle-left" aria-hidden="true"></i></div><img id="galimg" ><div class="gal-next"><i class="fa fa-angle-right" aria-hidden="true"></i></div><div id="gal-info" class="gal-info"></div></div></div>';$(document.body).append(a);var n=function(e){$("#galviewer").remove(),$(document).off("keydown")};$("#galviewer").on("click",function(e){n(e)}).children().click(function(e){return!1}),$(".gal-close").on("click",function(e){n(e)}),gmwa.logger.log("Will request data..."),$.getJSON("/galeria/info/"+e.currentTarget.dataset.idrids+"/"+e.currentTarget.dataset.ide+"/"+e.currentTarget.dataset.id).done(function(e){if(0==e.outcode){window.currentGallery=e.r.gallery,window.currentGalleryIndex=o;var r=function(e){gmwa.logger.log("Moving next"),window.currentGalleryIndex+1<window.currentGallery.images.length&&(window.currentGalleryIndex++,$("#galimg").attr("src",window.currentGallery.images[window.currentGalleryIndex].src),$("#galImgTitle").text(window.currentGallery.images[window.currentGalleryIndex].title),$("#galImgDesc").text(window.currentGallery.images[window.currentGalleryIndex].desc),window.currentGalleryIndex==window.currentGallery.images.length-1?$(".gal-next").hide():$(".gal-next").show(),$(".gal-prev").show())},t=function(e){gmwa.logger.log("Moving prev"),window.currentGalleryIndex-1>=0&&(window.currentGalleryIndex--,$("#galimg").attr("src",window.currentGallery.images[window.currentGalleryIndex].src),$("#galImgTitle").text(window.currentGallery.images[window.currentGalleryIndex].title),$("#galImgDesc").text(window.currentGallery.images[window.currentGalleryIndex].desc),0===window.currentGalleryIndex?$(".gal-prev").hide():$(".gal-prev").show(),$(".gal-next").show())};$(".gal-next").on("click",r),$(".gal-prev").on("click",t),$(document).on("keydown",function(e){switch(e.which){case 37:t();break;case 39:r();break;case 27:n(e);break;default:return}e.preventDefault()});var a='<div class="bizDetails"><table><tr><td>';a+=e.r.retailer.ics&&e.r.retailer.ics.length>0?'<img src="'+e.r.retailer.ics+'"></td><td>':'<img src="/img/local_default.png"></td><td>',a+="<h1>"+e.r.retailer.nam+"</h1><br><h2>"+e.r.retailer.adr+"</h2></td></tr></table></div>";var l='<div class="galDetails"><h1>'+e.r.gallery.name+"</h1><h2>"+e.r.gallery.description+'</h2><h3 id="galImgTitle">'+e.r.gallery.images[window.currentGalleryIndex].title+'</h3><h4 id="galImgDesc">'+e.r.gallery.images[window.currentGalleryIndex].desc+"</h4></div>";$(".gal-info").html(a+l),$("#galimg").attr("src",window.currentGallery.images[window.currentGalleryIndex].src),$("#galImgTitle").text(window.currentGallery.images[window.currentGalleryIndex].title),$("#galImgDesc").text(window.currentGallery.images[window.currentGalleryIndex].desc),0==window.currentGalleryIndex&&$(".gal-prev").hide(),$(".gal-cntr").fadeIn(400),$("#galspinner, #galspinnertext").hide()}else gmwa.logger.error("API returned error: "+e.outcode+" ("+e.outmsg+")")}).fail(function(e){gmwa.logger.error(e)})}})};var gmwa=gmwa||{};gmwa.components=gmwa.components||{},gmwa.components.header={},gmwa.components.header.buscadorOpened=!1,gmwa.components.header.navigating=!1,gmwa.components.header.menuOpened=!1,gmwa.components.header.menuBtn=null,gmwa.components.header.init=function(){gmwa.logger.log("Header|Init...");var e={url:function(e){return e.length>=3?"/components/pred-rubros-json/"+e:void 0},requestDelay:300,getValue:"name",template:{type:"description",fields:{description:"desc"}},list:{maxNumberOfElements:15,onChooseEvent:function(){var e=$("#search-rubroNombre").getSelectedItemData();if(1==e.type&&!gmwa.components.header.navigating){var o=e.key.split("~"),r=parseInt(1e4*o[0])+parseInt(o[1]),t="/local/"+encodeURI(e.name.toLowerCase())+"/LOC";t+=r.toString(),gmwa.components.header.navigating=!0,window.location=t}}}};$("#search-rubroNombre").easyAutocomplete(e),e={url:function(e){return e.length>=3?"/components/pred-zonas-json/"+e:void 0},requestDelay:300,getValue:"name",template:{type:"description",fields:{description:"desc"}}},$("#search-zonaNombre").easyAutocomplete(e),$("#searcher-form a, #doSearch").on("click",function(e){e.preventDefault(),gmwa.components.header.search()}),$("#searcher-form").submit(function(e){e.preventDefault(),gmwa.components.header.search()}),$("#headerLupa").on("click",function(e){$("#headerBuscador").show()}),$("#cancelSearch").on("click",function(e){$("#headerBuscador").hide()});var o=$("#btnLogin").attr("href");void 0!==o&&(o=o.replace("retUrl=/","retUrl="+location.href),$("#btnLogin").attr("href",o)),gmwa.components.header.menuBtn=$("#btnMenu i"),$("#btnMenu").on("click",function(e){void 0==gmwa.components.header.menuCntr?(gmwa.components.header.menuCntr=$("#headerToolbar"),gmwa.components.header.menuCntr.show(function(){gmwa.components.header.menuCntr.addClass("show")})):gmwa.components.header.menuCntr.show(function(){gmwa.components.header.menuCntr.addClass("show")})}),$("#btnMenuClose").on("click",function(e){gmwa.components.header.menuCntr.removeClass("show"),setTimeout(function(){gmwa.components.header.menuCntr.hide()},400)}),gmwa.components.header.initCrosshair()},gmwa.components.header.search=function(){var e=gmwa.components.header.slugify($("#search-rubroNombre").val().trim()),o=gmwa.components.header.slugify($("#search-zonaNombre").val().trim());e=e?e:"empresas",o=o?o:"todo-el-pais",gmwa.components.header.crossHairActive&&gmwa.components.header.coords&&gmwa.components.header.coords.latitude?document.location="/buscar/"+e+"/"+o+"/"+gmwa.components.header.coords.latitude+","+gmwa.components.header.coords.longitude:document.location="/buscar/"+e+"/"+o},gmwa.components.header.slugify=function(e){e=e.replace(/^\s+|\s+$/g,""),e=e.toLowerCase();for(var o="ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;",r="aaaaaeeeeeiiiiooooouuuunc------",t=0,a=o.length;a>t;t++)e=e.replace(new RegExp(o.charAt(t),"g"),r.charAt(t));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},gmwa.components.header.initCrosshair=function(){if("geolocation"in navigator&&(gmwa.components.header.crossHairActive=!1,$("#cross").on("click",function(e){gmwa.components.header.crossHairActive?($("#cross").removeClass("fa-close"),$("#cross").addClass("fa-crosshairs"),$("#search-zonaNombre").val(""),$("#search-zonaNombre").prop("disabled",!1),gmwa.components.header.crossHairActive=!1,gmwa.storage.remove("_gmwa_nm")):gmwa.components.header.activateNearMe()}),!gmwa.storage.isEmpty("_gmwa_nm"))){try{$lastZoneData=gmwa.storage.get("_gmwa_nm")}catch(e){gmwa.logger.error("Header|Exception catched loading lastZoneData!"),gmwa.logger.error(e),gmwa.storage.remove("_gmwa_nm")}var o=(new Date).getTime()/1e3;o-$lastZoneData.timestamp>=300?(gmwa.logger.log("Header|Refreshing lastZonaData..."),gmwa.components.header.activateNearMe()):(gmwa.logger.log("Header|Using cached lastZonaData..."),gmwa.components.header.coords=$lastZoneData.coords,$("#cross").removeClass("fa-crosshairs"),$("#cross").addClass("fa-close"),$("#search-zonaNombre").val($lastZoneData.zoneName),$("#search-zonaNombre").prop("disabled",!0),gmwa.components.header.crossHairActive=!0)}},gmwa.components.header.activateNearMe=function(){gmwa.components.header.getNearMe(function(e){if(e){$("#cross").removeClass("fa-crosshairs"),$("#cross").addClass("fa-close"),$("#search-zonaNombre").val(e),$("#search-zonaNombre").prop("disabled",!0);var o={zoneName:e,coords:{latitude:gmwa.components.header.coords.latitude,longitude:gmwa.components.header.coords.longitude},timestamp:(new Date).getTime()/1e3};gmwa.storage.set("_gmwa_nm",JSON.stringify(o)),gmwa.components.header.crossHairActive=!0}})},gmwa.components.header.getNearMe=function(e){navigator.geolocation.getCurrentPosition(function(o){gmwa.components.header.coords=o.coords,$.ajax({url:"/zonanearestcoords/"+o.coords.latitude+"/"+o.coords.longitude,contentType:"application/json; charset=utf-8"}).done(function(r){null!=r?e(r.nmz):(gmwa.logger.error("No zone found for coords: "+o.coords.latitude+" , "+o.coords.longitude),e(null))}).fail(function(r){gmwa.logger.error("Error getting zone for coords: "+o.coords.latitude+" , "+o.coords.longitude),gmwa.logger.error(r),e(null)})})};var gmwa=gmwa||{};gmwa.components=gmwa.components||{},gmwa.components.listadoRZ={},gmwa.components.listadoRZ.init=function(){gmwa.logger.log("ListadoRZ|Init..."),$(".listado-rubro li, .listado-zona li").on("click",function(){$(this).parents("ul:first").find("li").removeClass("check"),$(this).addClass("check")})};var gmwa=gmwa||{};gmwa.components=gmwa.components||{},gmwa.components.maps={},gmwa.components.maps.GMaps={},gmwa.components.maps.LMaps={},gmwa.components.maps.downloadDeferred=function(e){var o=document.createElement("div");o.innerHTML='<link rel="stylesheet" type="text/css" href="/js/vendors/leaflet2/leaflet.css">',document.body.appendChild(o);var r=document.createElement("script");r.src="/js/vendors/leaflet2/leaflet.js",r.onload=function(){e()},document.body.appendChild(r)},gmwa.components.maps.LMaps.initMap=function(e,o,r,t,a){var n=$("#"+e);if(0!=n.length){var l="https://maps.tingelmar.com/osm_tiles/",i="{z}/{x}/{y}.png",s=7,c=18,d=t,m="Map Data &#9400 OpenStreetMap contributors",g=new L.Map(e),u=l+i,p=new L.TileLayer(u,{minZoom:s,maxZoom:c,attribution:m}),w=parseFloat(o),h=parseFloat(r);return g.setView(new L.LatLng(w,h),d),g.addLayer(p),g}},gmwa.components.maps.LMaps.initMapAsync=function(e,o,r,t,a,n){"undefined"==typeof L?gmwa.components.maps.downloadDeferred(function(){n(gmwa.components.maps.LMaps.initMap(e,o,r,t,a))}):n(gmwa.components.maps.LMaps.initMap(e,o,r,t,a))},gmwa.components.maps.LMaps.addMarkerSimple=function(e,o,r){var t=new L.marker([parseFloat(o),parseFloat(r)]);return t.addTo(e),t},gmwa.components.maps.LMaps.addMarkerDraggable=function(e,o,r){var t=new L.marker([parseFloat(o),parseFloat(r)],{draggable:"true"});return t.addTo(e),t},gmwa.components.maps.GMaps.initMap=function(e,o,r,t,a){var n=$("#"+e);if(0!=n.length){var l=new google.maps.LatLng(o,r);if(a)var i={zoom:t,center:l,mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:!1,scrollwheel:!1,panControl:!0,zoomControl:!0,scaleControl:!0,overviewMapControl:!0,streetViewControl:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}};else var i={zoom:t,center:l,mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:!0,scrollwheel:!0,panControl:!0,zoomControl:!0,scaleControl:!0,overviewMapControl:!0,streetViewControl:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}};return new google.maps.Map(n[0],i)}},gmwa.components.maps.GMaps.addMarkerSimple=function(e,o,r){var t=new google.maps.LatLng(o,r);return new google.maps.Marker({position:t,map:e})},gmwa.components.maps.init=function(e){0==e?gmwa.components.maps.instance=gmwa.components.maps.GMaps:gmwa.components.maps.instance=gmwa.components.maps.LMaps};var gmwa=gmwa||{};gmwa.components=gmwa.components||{},gmwa.components.videoviewer={},gmwa.components.videoviewer.init=function(){gmwa.logger.log("VideoViewer|Init 2..."),$("a.itemVideo").on("click",function(e){e.preventDefault();var o='<div id="galviewer"><i class="fa fa-times gal-close" aria-hidden="true"></i><div id="gal-cntr" class="gal-cntr" style="padding-right:0px"><iframe id="galvid" type="text/html"   src="https://www.youtube.com/embed/'+this.dataset.id+'?autoplay=1&loop=0&rel=0"  frameborder="0"/>';$(document.body).append(o);var r=function(e){$("#galviewer").remove(),$(document).off("keydown")};$("#galviewer").on("click",function(e){r(e)}).children().click(function(e){return!1}),$(".gal-close").on("click",function(e){r(e)}),$(document).on("keydown",function(e){switch(e.which){case 27:r(e);break;default:return}e.preventDefault()})})},gmwa.controllers=gmwa.controllers||{},gmwa.controllers.comercio={},gmwa.controllers.comercio.toggleFav=null,gmwa.controllers.comercio.init=function(){gmwa.logger.log("Comercio|Init..."),$("div.ver-condiciones").on("click",function(e){e.preventDefault();var o=$(this).find("a:first");$(this).next("div.condiciones:first").toggle(0,function(){$("div.condiciones:first").is(":visible")?o.text("Ocultar condiciones"):o.text("Ver condiciones")})}),gmwa.components.header.init(),gmwa.components.videoviewer.init(),gmwa.utils.isMobile()&&gmwa.controllers.comercio.initKeenSlider(),gmwa.controllers.comercio.buildSpecialHoursStatus(),gmwa.controllers.comercio.smiImg=document.getElementById("smiImg"),gmwa.controllers.comercio.smiImg?gmwa.controllers.comercio.smiImg.addEventListener("click",function(e){gmwa.controllers.comercio.initializeMap()}):gmwa.controllers.comercio.initializeMap(),gmwa.controllers.comercio.updateMailData(),gmwa.controllers.comercio.inlineSpinner=document.getElementById("btnFastLoginNext2Spin"),$("#bookSave").click(function(e){e.preventDefault(),null==gmwa.controllers.comercio.toggleFav&&(gmwa.controllers.comercio.toggleFav=$(this).data("saved")),"1"==gmwa.controllers.comercio.toggleFav?($(this).prop("disabled",!0),gmwa.controllers.comercio.toggleFavorite($("#ficha").data("idr"),$("#ficha").data("ids"),"del",function(e){e&&($("#bookSave").html('<i class="fa fa-bookmark-o" aria-hidden="true"></i> Guardar'),$("#bookSave").prop("disabled",!1),gmwa.controllers.comercio.toggleFav="0")})):($(this).prop("disabled",!0),gmwa.controllers.comercio.toggleFavorite($("#ficha").data("idr"),$("#ficha").data("ids"),"add",function(e){e&&($("#bookSave").html('<i class="fa fa-bookmark" aria-hidden="true"></i> Guardado'),$("#bookSave").prop("disabled",!1),gmwa.controllers.comercio.toggleFav="1")}))}),$("#commentBtn").click(function(e){e.preventDefault(),gmwa.controllers.comercio.doReview()}),$("#btnLike").click(function(e){e.preventDefault(),(void 0==gmwa.controllers.comercio.commentLike||0==gmwa.controllers.comercio.commentLike)&&($("#btnLike").addClass("btnLikeSelected"),$("#btnDisLike").removeClass("btnDislikeSelected"),gmwa.controllers.comercio.commentLike=!0)}),$("#btnDisLike").click(function(e){e.preventDefault(),(void 0==gmwa.controllers.comercio.commentLike||1==gmwa.controllers.comercio.commentLike)&&($("#btnDisLike").addClass("btnDislikeSelected"),$("#btnLike").removeClass("btnLikeSelected"),gmwa.controllers.comercio.commentLike=!1)}),$("#btn-getdir").click(function(e){var o=$("#ficha").data("name")+"|"+$("#ficha").data("idr")+"|"+$("#ficha").data("ids");gmwa.utils.sendGAEvent("Profile","Directions",o),gmwa.controllers.comercio.openDirections(e)}),$(".retact-def-btn a").each(function(e){$(this).attr("href")&&("0"==$(this).attr("data-type")?$(this).on("click",function(e){var o=$("#ficha").data("name")+"|"+$("#ficha").data("idr")+"|"+$("#ficha").data("ids");gmwa.utils.sendGAEvent("Profile","DF-Call",o)}):"1"==$(this).attr("data-type")?$(this).on("click",function(e){var o=$("#ficha").data("name")+"|"+$("#ficha").data("idr")+"|"+$("#ficha").data("ids");gmwa.utils.sendGAEvent("Profile","DF-SMS",o)}):"2"==$(this).attr("data-type")?$(this).on("click",function(e){var o=$("#ficha").data("name")+"|"+$("#ficha").data("idr")+"|"+$("#ficha").data("ids");gmwa.utils.sendGAEvent("Profile","DF-WA",o)}):"3"==$(this).attr("data-type")&&$(this).on("click",function(e){var o=$("#ficha").data("name")+"|"+$("#ficha").data("idr")+"|"+$("#ficha").data("ids");gmwa.utils.sendGAEvent("Profile","DF-UB",o)}))}),$(".retact-btn a").each(function(e){$(this).attr("href")&&("tel:"==$(this).attr("href").substr(0,4)?$(this).on("click",function(e){var o=$("#ficha").data("name")+"|"+$("#ficha").data("idr")+"|"+$("#ficha").data("ids");gmwa.utils.sendGAEvent("Profile","Call",o)}):"http:"==$(this).attr("href").substr(0,5)?$(this).on("click",function(e){var o=$("#ficha").data("name")+"|"+$("#ficha").data("idr")+"|"+$("#ficha").data("ids");gmwa.utils.sendGAEvent("Profile","Web",o)}):"mailto:"==$(this).attr("href").substr(0,7)?$(this).on("click",function(e){var o=$("#ficha").data("name")+"|"+$("#ficha").data("idr")+"|"+$("#ficha").data("ids");gmwa.utils.sendGAEvent("Profile","Mail",o)}):"sms:"==$(this).attr("href").substr(0,4)&&$(this).on("click",function(e){var o=$("#ficha").data("name")+"|"+$("#ficha").data("idr")+"|"+$("#ficha").data("ids");gmwa.utils.sendGAEvent("Profile","SMS",o)}))}),$("#snets").click(function(e){var o=$("#ficha").data("name")+"|"+$("#ficha").data("idr")+"|"+$("#ficha").data("ids"),r=$(this).attr("data-net");gmwa.utils.sendGAEvent("Profile","SNET"+r,o)}),navigator.share?($("#btnShareMenu").hide(),$("#btnShare").click(function(e){e.preventDefault(),e.stopPropagation();var o={name:$("#ficha").attr("data-name"),text:$("#locAdr").text().trim(),url:window.location.href};gmwa.controllers.comercio.sendShareEvent("native"),navigator.share({title:o.name,text:o.name+" | "+o.text,url:o.url}).then(function(){})["catch"](function(e){console.log("Error sharing",e)})})):($("#btnShare").click(function(e){gmwa.controllers.comercio.shareOpened?($("#shareModal").foundation("close"),gmwa.controllers.comercio.shareOpened=!0):($("#shareModal").foundation("open"),gmwa.controllers.comercio.shareOpened=!1)}),$(".sharerpanel a").each(function(){$(this).on("click",function(e){gmwa.controllers.comercio.sendShareEvent($(this).text())})}))},gmwa.controllers.comercio.updateMailData=function(){var e="info@1122.com.uy",o="1122",r=$(".infoFicha .title").text();window.location.hostname.toLowerCase().indexOf("buscoinfo")>=0&&(e="feedback@buscoinfo.com.py",o="BuscoInfo");var t="Mensaje a "+o+" | "+r,a="mailto:"+e;a+="?subject="+t+"&body=-----"+t,
$("#fContactEmail").attr("href",a)},gmwa.controllers.comercio.initializeGoogleMap=function(){var e=$("#mapa");if(0!=e.length){var o=e.data("lat"),r=e.data("lng"),t=15,a=e.data("im");if(""!=o&&""!=r&&0!=o&&0!=r&&0!=t){var n=new google.maps.LatLng(o,r);if(a)var l={zoom:t,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:!1,scrollwheel:!1,panControl:!0,zoomControl:!0,scaleControl:!0,overviewMapControl:!0,streetViewControl:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}};else var l={zoom:t,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:!0,scrollwheel:!0,panControl:!0,zoomControl:!0,scaleControl:!0,overviewMapControl:!0,streetViewControl:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}};var i=new google.maps.Map(e[0],l);new google.maps.Marker({position:n,map:i})}}},gmwa.controllers.comercio.initializeMap=function(){var e=$("#mapa"),o=e.data("lat"),r=e.data("lng"),t=16,a=e.data("im");""==o||""==r||0==o||0==r||0==t||isNaN(o)||isNaN(r)||(gmwa.logger.log("Initializing Maps..."),gmwa.components.maps.instance.initMapAsync("mapa",o,r,t,a,function(e){gmwa.controllers.comercio.map=e,gmwa.components.maps.instance.addMarkerSimple(gmwa.controllers.comercio.map,o,r),gmwa.controllers.comercio.smiImg&&(gmwa.controllers.comercio.smiImg.style.display="none")}))},gmwa.controllers.comercio.enhanceHoursCalulateDelta=function(e,o){return hHourOpens=parseInt(e/100),hHour=parseInt(o/100),hHourOpens==hHour?e-o:e-o-40},gmwa.controllers.comercio.convertDateToString=function(e,o){return o?e.format("dddd D [de] MMMM"):e.format("D [de] MMMM")},gmwa.controllers.comercio.buildHourLabel=function(e){var o=parseInt(e);return 100>o?o>=10?"00:"+e:"00:0"+e:e.slice(0,-2)+":"+e.slice(-2,8)},gmwa.controllers.comercio.buildSpecialHoursStatus=function(){var e={color:"darkorange",text:"text",show:!0,htext:"text",specialDate:null},o=window.hrsps,r=null;if(r=new Date,r=r.getFullYear()+"-"+(0+String(r.getMonth()+1)).slice(-2)+"-"+(0+String(r.getDate())).slice(-2),o.length){e.color="#7CB342";var t=dayjs(o[0].d+" 00:00:00");if(e.specialDate=gmwa.controllers.comercio.convertDateToString(t,!0),o[0].dsc&&(e.specialDate=o[0].dsc+", "+gmwa.controllers.comercio.convertDateToString(t,!0)),o[0].cf){var a;if(o[0].hp){a=" abierto de ";var n=[];o[0].hp.forEach(function(e){n.push(gmwa.controllers.comercio.buildHourLabel(e.start)+" a "+gmwa.controllers.comercio.buildHourLabel(e.end))}),a+=n.join(", ")}else a=" cerrado",e.color="#FF5722";o[0].dsc?e.htext=gmwa.controllers.comercio.convertDateToString(t,!0)+' "'+o[0].dsc+'" '+a:e.htext=gmwa.controllers.comercio.convertDateToString(t,!0)+a}else e.color="#a96500",(new Date).getDay()==parseInt(t.format("d"))?e.htext="El horario de hoy puede variar":e.htext="El horario para el "+gmwa.controllers.comercio.convertDateToString(t,!0)+(o[0].dsc?" "+o[0].dsc:"")+" puede variar";$("#horarioEspecial").append($('<div style="color: '+e.color+'">'+e.htext+"</div>"))}},gmwa.controllers.comercio.enhanceHours=function(){var e=!1,o="...",r="",t=new Date,a=100*t.getHours()+t.getMinutes(),n=-1,l=-1,i=-1,s=$("#hoursIsToday").children(0).children(1);s.each(function(){n=$(this).data("start"),l=$(this).data("end"),dayIsOpen=$(this).parent().data("isopen"),dayIsOpen&&(e||(n>a?(l>a&&n>l?(o="<span style='color:#2f7733;font-weight: 100;'>(abierto)</span>",r="<span style='color:#2f7733;'>Ahora abierto</span>"):(i=gmwa.controllers.comercio.enhanceHoursCalulateDelta(n,a),100>i?(o="<span style='color:#cc362b;font-weight: 100;'>(abre en "+i+" mins)</span>",r="<span style='color:#cc362b;'>Ahora cerrado </span><span> (abre en "+i+" mins)</span>"):(o="<span style='color:#cc362b;font-weight: 100;'>(cerrado)</span>",n+="",n=[n.slice(0,-2),":",n.slice(-2)].join(""),r="<span style='color:#cc362b;'>Ahora cerrado </span><span> (abre hoy a las "+n+")</span>")),e=!0):a>n&&l>a?(i=gmwa.controllers.comercio.enhanceHoursCalulateDelta(l,a),100>i?(o="<span style='color:#c74802;font-weight: 100;'>(cierra en "+i+" mins)</span>",r="<span style='color:#c74802'>Ahora abierto </span><span> (cierra en "+i+" mins)</span>"):(o="<span style='color:#2f7733;font-weight: 100;'>(abierto)</span>",r="<span style='color:#2f7733'>Ahora abierto</span>"),e=!0):n>l&&a>n&&2400>a?(o="<span style='color:#2f7733;font-weight: 100;'>(abierto)</span>",r="<span style='color:#2f7733;'>Ahora abierto</span>",e=!0):(o="<span style='color:#cc362b;font-weight: 100;'>(cerrado)</span>",r="<span style='color:#cc362b'>Ahora cerrado</span>")))});var c=t.getDay();if(c=0==c?6:c-1,!e){r="<span style='color:#F44336;'>Ahora cerrado</span>";for(var d=c+1,m=$(".hours-table>tbody>tr"),g=null,u=null,p=0;p<m.length;p++)if(d>=m.length-1&&(d=0),g=m.eq(d),g.children().eq(1).children().length>0){u=g.children().eq(1).children().eq(0).data("start")+"",u=[u.slice(0,-2),":",u.slice(-2)].join(""),r+=c==d?" <span> (abre hoy a las "+u+")</span>":d-c==1?" <span> (abre mañana a las "+u+")</span>":" <span> (abre el "+g.children().eq(0).text()+" a las "+u+")</span>";break}}$("#hoursIsToday td:nth-child(2)").append($("<div style='display: block;'>"+o+"<div>")),$(".horario").append($(r))},gmwa.controllers.comercio.toggleFavorite=function(e,o,r,t){var a={op:r,retailer:e,store:o};$.ajax({type:"POST",url:"/local/fav",data:JSON.stringify(a),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){"0"==e.outcode?t(!0):999==e.outcode?(gmwa.utils.showError("Inicia sesión","Para poder guardar tus lugares favoritos"),t(!1)):(gmwa.logger.error("toggleFavorite | Server returned "+e.outcode+" ("+e.outmsg+")"),t(!1))}).fail(function(e){gmwa.logger.error("toggleFavorite | API returned error: "+JSON.stringify(e)),t(!1)})},gmwa.controllers.comercio.sendReview=function(e,o){$.ajax({type:"POST",url:"/local/comment",data:JSON.stringify(e),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){"0"==e.outcode?o(!0):999==e.outcode?(gmwa.utils.showError("Inicia sesión","Para poder agregar comentarios"),o(!1)):(gmwa.logger.error("sendReview | Server returned "+e.outcode+" ("+e.outmsg+")"),o(!1))}).fail(function(e){gmwa.logger.error("sendReview | API returned error: "+JSON.stringify(e)),o(!1)})},gmwa.controllers.comercio.sendReviewAndLike=function(e,o){gmwa.controllers.comercio.initFastLogin(e,o);var r=document.querySelector("#ficha").getAttribute("data-username");r&&r.length>0?gmwa.controllers.comercio.doSendReviewAndLike(e,o):$("#fastLoginModal").foundation("open")},gmwa.controllers.comercio.doSendReviewAndLike=function(e,o){$.ajax({type:"POST",url:"/local/commentLike",data:JSON.stringify(e),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){"0"==e.outcode||"139"==e.outcode?o(e):999==e.outcode?(gmwa.utils.showError("Inicia sesión","Para poder agregar comentarios"),o(!1)):151==e.outcode?(gmwa.utils.showError("No se pudo iniciar sesión","El usuario o la contraseña no son los correctos"),o(!1)):(gmwa.logger.error("sendReviewAndLike | Server returned "+e.outcode+" ("+e.outmsg+")"),o(!1))}).fail(function(e){gmwa.logger.error("sendReviewAndLike | API returned error: "+JSON.stringify(e)),o(!1)})},gmwa.controllers.comercio.initFastLogin=function(e,o){gmwa.controllers.comercio.lblflEmail||(gmwa.controllers.comercio.flDesc=document.getElementById("flDesc"),gmwa.controllers.comercio.flErr=document.getElementById("flErr"),gmwa.controllers.comercio.lblflEmail=document.getElementById("lblflEmail"),gmwa.controllers.comercio.flEmail=document.getElementById("flEmail"),gmwa.controllers.comercio.lblflName=document.getElementById("lblflName"),gmwa.controllers.comercio.flName=document.getElementById("flName"),gmwa.controllers.comercio.lblflPass=document.getElementById("lblflPass"),gmwa.controllers.comercio.flPass=document.getElementById("flPass"),gmwa.controllers.comercio.btnFastLoginNext1=document.getElementById("btnFastLoginNext1"),gmwa.controllers.comercio.btnFastLoginNext2=document.getElementById("btnFastLoginNext2"),gmwa.controllers.comercio.btnFastLoginNext1.addEventListener("click",function(e){return gmwa.controllers.comercio.fastLoginFormMove(1),gmwa.controllers.comercio.flEmail.value&&0!=gmwa.controllers.comercio.flEmail.value.length&&gmwa.utils.isEmail(gmwa.controllers.comercio.flEmail.value)?(gmwa.controllers.comercio.fastLoginFormMailExists=!1,void $.ajax({type:"GET",url:"/checkuser/"+encodeURIComponent(gmwa.controllers.comercio.flEmail.value),contentType:"application/json; charset=utf-8"}).done(function(e){e?(gmwa.controllers.comercio.fastLoginFormMove(2),e.exists?(gmwa.controllers.comercio.fastLoginFormMailExists=!0,gmwa.controllers.comercio.fastLoginFormMove(3)):gmwa.controllers.comercio.fastLoginFormMove(4),gmwa.controllers.comercio.btnFastLoginNext2.style.display="block"):(gmwa.utils.showError("Verificación de correo","No se pudo verificar el correo, por favor inténtelo más tarde."),gmwa.controllers.comercio.fastLoginFormMove(0),o(!1))}).fail(function(e){gmwa.controllers.comercio.fastLoginFormMove(0),gmwa.utils.showError("Verificación de correo","No se pudo verificar el correo, por favor inténtelo más tarde. [2]"),o(!1)})):(gmwa.controllers.comercio.fastLoginFormMove(0),void gmwa.controllers.comercio.fastLoginShowError("Ingrese una dirección de correo electrónico válido"))}),gmwa.controllers.comercio.btnFastLoginNext2.addEventListener("click",function(){return gmwa.controllers.comercio.fastLoginFormMailExists||gmwa.controllers.comercio.flName.value&&!(gmwa.controllers.comercio.flName.value.length<3)?!gmwa.controllers.comercio.flPass.value||gmwa.controllers.comercio.flPass.value.length<4?(gmwa.controllers.comercio.fastLoginFormMailExists?gmwa.controllers.comercio.fastLoginFormMove(3):gmwa.controllers.comercio.fastLoginFormMove(4),void gmwa.controllers.comercio.fastLoginShowError("Ingrese una contraseña válida")):(e.name=gmwa.controllers.comercio.flName.value,e.email=encodeURIComponent(gmwa.controllers.comercio.flEmail.value),e.password=gmwa.controllers.comercio.flPass.value,gmwa.controllers.comercio.fastLoginFormMove(5),void gmwa.controllers.comercio.doSendReviewAndLike(e,function(e){if(!e)return void gmwa.controllers.comercio.fastLoginFormReset();var r=new Date(1e3*e.r.user.cookieTTL);document.cookie=e.r.user.cookieName+"="+e.r.user.token+"; expires="+r.toUTCString()+"; path=/",gmwa.controllers.comercio.fastLoginFormMove(0),$("#fastLoginModal").foundation("close"),o(e)})):(gmwa.controllers.comercio.fastLoginFormMove(4),void gmwa.controllers.comercio.fastLoginShowError("Ingrese un nombre"))}))},gmwa.controllers.comercio.fastLoginFormReset=function(){gmwa.controllers.comercio.btnFastLoginNext1.style.display="block",gmwa.controllers.comercio.btnFastLoginNext2.style.display="none",gmwa.controllers.comercio.flDesc.innerText="Para poder enviar tu comentario es necesario inciar sesión",gmwa.controllers.comercio.flDesc.style.display="block",gmwa.controllers.comercio.lblflPass.style.display="none",gmwa.controllers.comercio.flPass.style.display="none",gmwa.controllers.comercio.lblflEmail.style.display="block",gmwa.controllers.comercio.flEmail.style.display="block",gmwa.controllers.comercio.btnFastLoginNext1.disabled=!1,gmwa.controllers.comercio.btnFastLoginNext2.disabled=!1,gmwa.controllers.comercio.flName.disabled=!1,gmwa.controllers.comercio.flPass.disabled=!1,gmwa.controllers.comercio.flEmail.disabled=!1,gmwa.controllers.comercio.inlineSpinner.style.display="none",$("#commentMsg").prop("disabled",!1),$("#commentBtn").prop("disabled",!1)},gmwa.controllers.comercio.fastLoginFormMove=function(e){gmwa.controllers.comercio.flErr.style.display="none",0==e?(gmwa.controllers.comercio.lblflEmail.style.display="block",gmwa.controllers.comercio.flEmail.style.display="block",gmwa.controllers.comercio.btnFastLoginNext1.style.display="block",gmwa.controllers.comercio.flEmail.disabled=!1,gmwa.controllers.comercio.btnFastLoginNext1.disabled=!1):1==e?(gmwa.controllers.comercio.flEmail.disabled=!0,gmwa.controllers.comercio.btnFastLoginNext1.disabled=!0):2==e?(gmwa.controllers.comercio.lblflEmail.style.display="none",gmwa.controllers.comercio.flEmail.style.display="none",gmwa.controllers.comercio.btnFastLoginNext1.style.display="none"):3==e?(gmwa.controllers.comercio.flDesc.innerText="Ya existe una cuenta con ese correo, ingresa tu contraseña para continuar",gmwa.controllers.comercio.flDesc.style.display="block",gmwa.controllers.comercio.lblflPass.style.display="block",gmwa.controllers.comercio.flPass.style.display="block",gmwa.controllers.comercio.btnFastLoginNext2.style.display="block"):4==e?(gmwa.controllers.comercio.flDesc.innerText="No existe una cuenta con ese correo, ingresa tu nombre y una contraseña para continuar",gmwa.controllers.comercio.flDesc.style.display="block",gmwa.controllers.comercio.lblflName.style.display="block",gmwa.controllers.comercio.flName.style.display="block",gmwa.controllers.comercio.lblflPass.style.display="block",gmwa.controllers.comercio.flPass.style.display="block",gmwa.controllers.comercio.btnFastLoginNext2.style.display="block"):5==e&&(gmwa.controllers.comercio.lblflName.disabled=!0,gmwa.controllers.comercio.flName.disabled=!0,gmwa.controllers.comercio.lblflPass.disabled=!0,gmwa.controllers.comercio.flPass.disabled=!0,gmwa.controllers.comercio.btnFastLoginNext2.disabled=!0)},gmwa.controllers.comercio.fastLoginShowError=function(e){gmwa.controllers.comercio.flErr.innerText=e,gmwa.controllers.comercio.flErr.style.display="block"},gmwa.controllers.comercio.doReview=function(){var e={};e.body=$("#commentMsg").val(),e.retailer=$("#ficha").data("idr"),e.store=$("#ficha").data("ids"),e.like=gmwa.controllers.comercio.commentLike;var o=$("#ficha").data("name");return null==e.body||0==e.body.length?void $("#commentErrMsg").html("Ingresa tu comentario para poder enviarlo"):($("#commentErrMsg").html(""),void 0==e.like?void $("#commentErrMsg").html("Selecciona si recomiendas este lugar"):(gmwa.logger.info("sendReview | Sending review ..."),gmwa.controllers.comercio.inlineSpinner.style.display="inline",$("#commentMsg").prop("disabled",!0),$("#commentBtn").prop("disabled",!0),void gmwa.controllers.comercio.sendReviewAndLike(e,function(e){e&&0==e.outcode?$("#cmntCntr").html('<div style="padding: 40px 0px 80px 0px;text-align:center"><svg style="width: 45px;height: 45px;margin: 10px 0px;fill: #9e9e9e;" height="511pt" viewBox="1 0 511 511.99995" width="511pt" xmlns="http://www.w3.org/2000/svg"><path d="m450.675781 125.457031-63.636719-63.636719-118.496093 119.488282 63.648437 63.644531zm0 0"/><path d="m211.527344 282.316406c-5.152344 12.371094 7.269531 24.777344 19.632812 19.609375l76.175782-39.40625-56.4375-56.4375zm0 0"/><path d="m508.105469 68.027344c5.859375-5.859375 5.859375-15.355469 0-21.214844l-42.421875-42.417969c-5.859375-5.859375-15.355469-5.859375-21.214844 0l-36.214844 36.214844 63.632813 63.636719zm0 0"/><path d="m45.5 421h15v76c0 6.0625 3.648438 11.542969 9.257812 13.855469 5.527344 2.308593 12.015626 1.078125 16.347657-3.25l86.605469-86.605469h174.789062c24.8125 0 45-20.1875 45-45v-148.933594l-47.316406 47.316406c-4.128906 4.132813-8.949219 7.382813-14.355469 9.652344l-85.882813 44.53125c-7.808593 3.371094-13.667968 4.558594-19.644531 4.558594-4.464843 0-8.769531-.859375-12.929687-2.125h-106.871094c-8.292969 0-15-6.710938-15-15 0-8.292969 6.707031-15 15-15h75.957031c-2.960937-9.820312-1.691406-20.457031 2.390625-30.21875l46.289063-89.898438c1.316406-3.324218 4.570312-8.160156 8.6875-12.273437l47.609375-47.609375h-240.933594c-24.8125 0-45 20.1875-45 45v210c0 24.8125 20.1875 45 45 45zm0 0"/></svg><div style="font-weight: 600;font-size: 18px;">Gracias por tu opinión!</div><div style="">Tu comentario será agregado al perfil de '+o+" en las próximas 24 horas</div></div>"):e&&139==e.outcode?$("#cmntCntr").html('<div style="padding: 40px 0px 80px 0px;text-align:center"><svg style="width: 45px;height: 45px;margin: 10px 0px;fill: #9e9e9e;" height="511pt" viewBox="1 0 511 511.99995" width="511pt" xmlns="http://www.w3.org/2000/svg"><path d="m450.675781 125.457031-63.636719-63.636719-118.496093 119.488282 63.648437 63.644531zm0 0"/><path d="m211.527344 282.316406c-5.152344 12.371094 7.269531 24.777344 19.632812 19.609375l76.175782-39.40625-56.4375-56.4375zm0 0"/><path d="m508.105469 68.027344c5.859375-5.859375 5.859375-15.355469 0-21.214844l-42.421875-42.417969c-5.859375-5.859375-15.355469-5.859375-21.214844 0l-36.214844 36.214844 63.632813 63.636719zm0 0"/><path d="m45.5 421h15v76c0 6.0625 3.648438 11.542969 9.257812 13.855469 5.527344 2.308593 12.015626 1.078125 16.347657-3.25l86.605469-86.605469h174.789062c24.8125 0 45-20.1875 45-45v-148.933594l-47.316406 47.316406c-4.128906 4.132813-8.949219 7.382813-14.355469 9.652344l-85.882813 44.53125c-7.808593 3.371094-13.667968 4.558594-19.644531 4.558594-4.464843 0-8.769531-.859375-12.929687-2.125h-106.871094c-8.292969 0-15-6.710938-15-15 0-8.292969 6.707031-15 15-15h75.957031c-2.960937-9.820312-1.691406-20.457031 2.390625-30.21875l46.289063-89.898438c1.316406-3.324218 4.570312-8.160156 8.6875-12.273437l47.609375-47.609375h-240.933594c-24.8125 0-45 20.1875-45 45v210c0 24.8125 20.1875 45 45 45zm0 0"/></svg><div style="">Tu comentario para '+o+" ya fue enviado y será publicado en las siguientes 24 horas</div></div>"):gmwa.utils.showError("Ocurrió un error","No fue posible procesar su comentario en este momento."),$("#commentBtn #galspinner").remove(),$("#cmntsEmpty").remove(),$("#commentMsg").prop("disabled",!1),$("#commentBtn").prop("disabled",!1)})))},gmwa.controllers.comercio.sendLike=function(e,o){$.ajax({type:"POST",url:"/local/like",data:JSON.stringify(e),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){"0"==e.outcode?o(!0):999==e.outcode?(gmwa.utils.showError("Inicia sesión","Para poder recomendar un lugar"),o(!1)):(gmwa.logger.error("sendLike | Server returned "+e.outcode+" ("+e.outmsg+")"),o(!1))}).fail(function(e){gmwa.logger.error("sendLike | API returned error: "+JSON.stringify(e)),o(!1)})},gmwa.controllers.comercio.doLike=function(e){var o={};o.retailer=$("#ficha").data("idr"),o.store=$("#ficha").data("ids"),e?o.recommend=1:o.recommend=0,$("#commentLike").prop("disabled",!0),$("#commentDislike").prop("disabled",!0),gmwa.logger.info("sendLike | Sending like to idr="+o.retailer+", ids="+o.store+", like="+o.recommend+"..."),gmwa.controllers.comercio.sendLike(o,function(e){if(e)if(1==o.recommend){var r='Haz recomendado este lugar <i class="fa fa-thumbs-o-up" aria-hidden="true"></i><div id="commentStopLike"><small><i class="fa fa-thumbs-o-down" aria-hidden="true"></i> Dejar de recomendar</small></div>';$("#liked").html(r),$("#commentStopLike").click(function(e){gmwa.controllers.comercio.doLike(!1)})}else{var r='No recomiendas este lugar <i class="fa fa-thumbs-o-down" aria-hidden="true"></i><div id="commentStartLike"><small><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> Empezar a recomendar</small></div>';$("#liked").html(r),$("#commentStartLike").click(function(e){gmwa.controllers.comercio.doLike(!0)})}else gmwa.utils.showError("Ocurrió un error","No fue posible procesar su comentario en este momento."),$("#liked #galspinner").remove();$("#commentLike").prop("disabled",!1),$("#commentDislike").prop("disabled",!1)})},gmwa.controllers.comercio.openDirections=function(e){e.preventDefault();var o=$("#btn-getdir").data("addr"),r=$("#btn-getdir").data("lat"),t=$("#btn-getdir").data("lon"),a="";a=-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPad")||-1!=navigator.platform.indexOf("iPod")?encodeURI("maps://maps.google.com/maps?daddr="+r+","+t+"&amp;ll="):o&&o.length>0?encodeURI("https://maps.google.com/maps?daddr="+o+"@"+r+","+t+"&amp;ll="):encodeURI("https://maps.google.com/maps?daddr="+r+","+t+"&amp;ll="),window.open(a)},gmwa.controllers.comercio.sendShareEvent=function(e){var o=e+"|"+$("#ficha").data("name")+"|"+$("#ficha").data("idr")+"|"+$("#ficha").data("ids");gmwa.utils.sendGAEvent("Profile","Share",o)},gmwa.controllers.comercio.coversCarrousel=null,gmwa.controllers.comercio.coversCarrouselInterval=0,gmwa.controllers.comercio.initKeenSlider=function(){gmwa.controllers.comercio.coversCarrouselInterval=0;var e=document.getElementById("keenCovers");e&&(gmwa.controllers.comercio.coversCarrousel=new KeenSlider(e,{loop:!0,duration:1e3,dragStart:function(){gmwa.controllers.comercio.carrouselAutoplay(!1)},dragEnd:function(){gmwa.controllers.comercio.carrouselAutoplay(!0)},created:function(){e.style.display="flex";var o=document.querySelectorAll(".keen-slider__slide");o.forEach(function(e,o){o>0&&(e.style.display="block")})},slideChanged:function(e){var o=e.details().relativeSlide,r=document.querySelectorAll(".story-dot ");r.forEach(function(e,r){r==o?e.classList.add("story-dot--active"):e.classList.remove("story-dot--active")})}}),gmwa.controllers.comercio.carrouselAutoplay(!0))},gmwa.controllers.comercio.carrouselAutoplay=function(e){clearInterval(gmwa.controllers.comercio.coversCarrouselInterval),gmwa.controllers.comercio.coversCarrouselInterval=setInterval(function(){e&&gmwa.controllers.comercio.coversCarrousel&&gmwa.controllers.comercio.coversCarrousel.next()},5e3)};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.contact={},gmwa.controllers.contact.init=function(){gmwa.logger.log("Contact|Init..."),gmwa.components.header.init();var e=document.createElement("script");e.src="/js/vendors/parsley/i18n/es.js",e.onload=function(){var e=document.createElement("script");e.src="/js/vendors/parsley/parsley.min.js",e.onload=function(){window.ParsleyValidator.setLocale("es");var e=!1,o=document.getElementById("contactForm"),r=document.getElementById("btnSend");$("#contactForm").parsley(),$.listen("parsley:form:validated",function(t){if($.each(t.fields,function(e,o){var r=null,t=o.$element.next("ul.parsley-errors-list:first");if(o.$element.parents("div:first").find("small.error:first").hide(),t.find("li:first").length){r=t.find("li:first").text(),o.$element.parents("div:first").find("small.error:first").text(r).show();var a=o.$element.data("parsley-id");$("#parsley-id-"+a).show()}}),!e&&t.isValid()){t.validationResult=!1,$("#btnSend").prop("disabled",!0),$("#btnSend").text("Enviando...");var a=null;window.location.hostname.toLowerCase().indexOf("buscoinfo")>=0?(console.info("Sending as BI"),a="6LfzeqEaAAAAAFmSgGiocTLX0ObFqJJ_JzXDpQHB"):(console.info("Sending as GM"),a="6LcIPzwUAAAAAEAKqChvPCt0sx_y03vZM4GiiX5Y");var n=grecaptcha.render(r,{sitekey:a,size:"invisible",callback:function(){t.validationResult=!0,o.submit()}});grecaptcha.reset(n),grecaptcha.execute(n),e=!0}})},document.body.appendChild(e)},document.body.appendChild(e),$(document).on("submit","form",function(){$("#btnSend").prop("disabled",!0),$("#btnSend").text("Enviando...")}),gmwa.logger.log("Contact|Adding referrer as ["+document.referrer+"]"),$("<input>").attr({type:"hidden",id:"refPage",name:"refPage",value:document.referrer}).appendTo("#contactForm")};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.favorites={},gmwa.controllers.favorites.init=function(){$(".savedDelete").click(function(e){var o=$(this).data("fav");gmwa.controllers.comercio.toggleFavorite($(this).data("idr"),$(this).data("ids"),"del",function(e){e&&$("#fav-"+o).remove()})}),gmwa.components.header.init(),$(".btns-rem").each(function(e){$(this).on("click",function(e){e.preventDefault();var o={};o.retailer=$(this).data("idr"),o.store=$(this).data("ids"),o.op="del",$.ajax({type:"POST",url:"/local/fav",data:JSON.stringify(o),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){if("0"==e.outcode){var r=1e4*o.retailer+o.store;$("#fav-"+r).remove()}else gmwa.logger.error("toggleFavorite | Server returned "+e.outcode+" ("+e.outmsg+")")}).fail(function(e){gmwa.logger.error("toggleFavorite | API returned error: "+JSON.stringify(e))})})}),gmwa.controllers.comercio.toggleFavorite=function(e,o,r,t){var a={op:r,retailer:e,store:o};$.ajax({type:"POST",url:"/local/fav",data:JSON.stringify(a),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){"0"==e.outcode?t(!0):999==e.outcode?(gmwa.utils.showError("Inicia sesión","Para poder guardar tus lugares favoritos"),t(!1)):(gmwa.logger.error("toggleFavorite | Server returned "+e.outcode+" ("+e.outmsg+")"),t(!1))}).fail(function(e){gmwa.logger.error("toggleFavorite | API returned error: "+JSON.stringify(e)),t(!1)})}},gmwa.controllers=gmwa.controllers||{},gmwa.controllers.gals={},gmwa.controllers.gals.init=function(){if(gmwa.logger.log("Gals|Init..."),gmwa.components.header.init(),gmwa.controllers.gals.buildSpecialHoursStatus(),gmwa.controllers.gals.smiImg=document.getElementById("smiImg"),gmwa.utils.isMobile()){var e=document.getElementById("tabInfo");e&&e.addEventListener("click",function(e){gmwa.controllers.gals.map||(gmwa.controllers.gals.smiImg?gmwa.controllers.gals.smiImg.addEventListener("click",function(e){gmwa.controllers.gals.initializeMap()}):gmwa.controllers.gals.initializeMap())})}else gmwa.controllers.gals.smiImg?gmwa.controllers.gals.smiImg.addEventListener("click",function(e){gmwa.controllers.gals.initializeMap()}):gmwa.controllers.gals.initializeMap()},gmwa.controllers.gals.initializeGoogleMap=function(){var e=$("#mapa");if(0!=e.length){var o=e.data("lat"),r=e.data("lng"),t=15,a=e.data("im");if(""!=o&&""!=r&&0!=o&&0!=r&&0!=t){var n=new google.maps.LatLng(o,r);if(a)var l={zoom:t,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:!1,scrollwheel:!1,panControl:!0,zoomControl:!0,scaleControl:!0,overviewMapControl:!0,streetViewControl:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}};else var l={zoom:t,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:!0,scrollwheel:!0,panControl:!0,zoomControl:!0,scaleControl:!0,overviewMapControl:!0,streetViewControl:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}};var i=new google.maps.Map(e[0],l);new google.maps.Marker({position:n,map:i})}}},gmwa.controllers.gals.initializeMap=function(){var e=$("#mapa"),o=e.data("lat"),r=e.data("lng"),t=16,a=e.data("im");""==o||""==r||0==o||0==r||0==t||isNaN(o)||isNaN(r)||(gmwa.logger.log("Initializing Maps..."),gmwa.components.maps.instance.initMapAsync("mapa",o,r,t,a,function(e){gmwa.controllers.gals.map=e,gmwa.components.maps.instance.addMarkerSimple(gmwa.controllers.gals.map,o,r),gmwa.controllers.gals.smiImg&&(gmwa.controllers.gals.smiImg.style.display="none")}))},gmwa.controllers.gals.buildSpecialHoursStatus=function(){var e={color:"darkorange",text:"text",show:!0,htext:"text",specialDate:null},o=window.hrsps,r=null;if(r=new Date,r=r.getFullYear()+"-"+(0+String(r.getMonth()+1)).slice(-2)+"-"+(0+String(r.getDate())).slice(-2),o.length){e.color="#7CB342";var t=dayjs(o[0].d+" 00:00:00");if(e.specialDate=gmwa.controllers.gals.convertDateToString(t,!0),o[0].dsc&&(e.specialDate=o[0].dsc+", "+gmwa.controllers.gals.convertDateToString(t,!0)),o[0].cf){var a;if(o[0].hp){a=" abierto de ";var n=[];o[0].hp.forEach(function(e){n.push(gmwa.controllers.gals.buildHourLabel(e.start)+" a "+gmwa.controllers.gals.buildHourLabel(e.end))}),a+=n.join(", ")}else a=" cerrado",e.color="#FF5722";o[0].dsc?e.htext=gmwa.controllers.gals.convertDateToString(t,!0)+' "'+o[0].dsc+'" '+a:e.htext=gmwa.controllers.gals.convertDateToString(t,!0)+a}else e.color="#FF9800",(new Date).getDay()==parseInt(t.format("d"))?e.htext="El horario de hoy puede variar":e.htext="El horario para el "+gmwa.controllers.gals.convertDateToString(t,!0)+(o[0].dsc?" "+o[0].dsc:"")+" puede variar";$("#horarioEspecial").append($('<div style="color: '+e.color+'">'+e.htext+"</div>"))}},gmwa.controllers.gals.convertDateToString=function(e,o){return o?e.format("dddd D [de] MMMM"):e.format("D [de] MMMM")};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.home={},gmwa.controllers.home.init=function(){gmwa.logger.log("Home|Init...");gmwa.utils.isMobile();$("#mi-home").addClass("u-tb-item-selected"),$("#bPushRegister").click(function(e){gmwa.webpush.subscribe()}),$("#bPushUnregister").click(function(e){gmwa.webpush.unsubscribe()}),gmwa.components.header.init()};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.login={},gmwa.controllers.login.inlineSpinner='<div id="galspinner" class="spinner spinnerInline spinnerWhite"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>',gmwa.controllers.login.init=function(){gmwa.logger.log("Login|Init..."),gmwa.components.header.init(),$("#forgotPassBtn").click(function(e){e.preventDefault(),$("#boxLogin").hide(),$("#boxForgotPass").show()}),$("#reInit").click(function(e){e.preventDefault(),$("#boxForgotPass").hide(),$("#boxLogin").show()}),$("#regreInit").click(function(e){e.preventDefault(),$("#boxRegister").hide(),$("#boxLogin").show()}),$("#gotoRegister").click(function(e){e.preventDefault(),$("#boxLogin").hide(),$("#boxRegister").show()}),$("#btnRecoverPas").click(function(e){e.preventDefault();var o=$("#recoverEmail").val();return void 0==o||null==o||0==o.length?void $("#recoverError").html("Ingrese su direccion de correo electronico para recuperar su contraseña"):(o=encodeURIComponent(o),void $.ajax({type:"GET",url:"/resetPass?email="+o}).done(function(e){$("#recoverRequest").hide(),$("#recoverRequested").show()}).fail(function(e){gmwa.logger.error("btnRecoverPas | API returned error: "+JSON.stringify(e)),$("#recoverError").html("No fue posible solicitar la recuperacion en este momento.")}))}),$("#btnRegister").click(function(e){e.preventDefault(),$("#reg_error").text(""),$("#reg_error").hide();var o=$("#reg_email").val();if(void 0==o||null==o||0==o.length)return $("#reg_error").text("Ingrese su direccion de correo electronico"),void $("#reg_error").show();o=encodeURIComponent(o);var r=$("#reg_username").val();if(void 0==r||null==r||0==r.length)return $("#reg_error").text("Ingrese su nombre"),void $("#reg_error").show();var t=$("#reg_pass").val();if(void 0==t||null==t||0==t.length)return $("#reg_error").text("Ingrese una contraseña válida"),void $("#reg_error").show();var a={reg_email:o,reg_username:r,reg_pass:t};$("#btnRegister").html("Espere..."),$("#btnRegister").append(gmwa.controllers.login.inlineSpinner),$("#btnRegister").prop("disabled",!0),$.ajax({type:"POST",url:"/register",data:JSON.stringify(a),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){$("#btnRegister").html("Crear usuario"),$("#btnRegister #galspinner").remove(),$("#btnRegister").prop("disabled",!1),console.log(e),999==e.outcode?($("#reg_error").html('<i class="fa fa-exclamation" aria-hidden="true"></i> Ingrese su direccion de correo electronico'),$("#reg_error").show()):998==e.outcode?($("#reg_error").html('<i class="fa fa-exclamation" aria-hidden="true"></i> Ingrese su nombre'),$("#reg_error").show()):997==e.outcode?($("#reg_error").html('<i class="fa fa-exclamation" aria-hidden="true"></i> Ingrese una contraseña válida'),$("#reg_error").show()):142==e.outcode?($("#reg_error").html('<i class="fa fa-exclamation" aria-hidden="true"></i> La dirección de correo ingresada ya está registrada'),$("#reg_error").show()):0==e.outcode?(a.reg_email=decodeURIComponent(a.reg_email),$("#boxRegister").hide(),$("#boxLogin").show(),$("#lblRegOk").html('<strong style="color: #1497d8;"><i class="fa fa-check-circle-o" aria-hidden="true"></i> Bienvenido '+a.reg_username+"!</strong> <br>Por favor inicia sesion con tu clave ahora."),$("#lblRegOk").show(),$("#username").val(a.reg_email)):($("#reg_error").html('<i class="fa fa-exclamation" aria-hidden="true"></i> No es posible realizar el registro en este momento. ('+e.outcode+")"),$("#reg_error").show())}).fail(function(e){$("#btnRegister").html("Crear usuario"),
$("#btnRegister #galspinner").remove(),$("#btnRegister").prop("disabled",!1),gmwa.logger.error("btnRegister | API returned error: "+JSON.stringify(e)),$("#reg_error").html('<i class="fa fa-exclamation" aria-hidden="true"></i> No fue posible realizar el registro en este momento.')})})};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.reportarError={},gmwa.controllers.reportarError.map=null,gmwa.controllers.reportarError.init=function(){gmwa.logger.log("ReportarError|Init..."),gmwa.components.header.init(),$("#vermapa, #lblvermapa").on("click",function(){this.checked?$("#mapaVer").show("fast",function(){var e=parseFloat($("#errorForm").data("lat")),o=parseFloat($("#errorForm").data("lon"));gmwa.controllers.reportarError.initializeMap(e,o)}):$("#mapaVer").hide()});var e=document.createElement("script");e.src="/js/vendors/parsley/i18n/es.js",e.onload=function(){var e=document.createElement("script");e.src="/js/vendors/parsley/parsley.min.js",e.onload=function(){window.ParsleyValidator.setLocale("es"),$("#errorForm").parsley(),$.listen("parsley:form:validated",function(e){$.each(e.fields,function(e,o){var r=null,t=o.$element.next("ul.parsley-errors-list:first");o.$element.parents("div:first").find("small.error:first").hide(),t.find("li:first").length&&(r=t.find("li:first").text(),o.$element.parents("div:first").find("ul").show())})})},document.body.appendChild(e)},document.body.appendChild(e),$(document).on("submit","form",function(){$("#btnSend").prop("disabled",!0),$("#btnSend").text("Enviando...")})},gmwa.controllers.reportarError.initializeMap=function(e,o){if(null==gmwa.controllers.reportarError.map){var r=$("#us3"),t=16,a=r.data("im");""!=e&&""!=o&&0!=e&&0!=o&&0!=t&&(gmwa.logger.log("Initializing Maps..."),gmwa.components.maps.instance.initMapAsync("mapa",e,o,t,a,function(r){gmwa.controllers.reportarError.map=r,gmwa.controllers.reportarError.marker=gmwa.components.maps.instance.addMarkerDraggable(gmwa.controllers.reportarError.map,e,o),gmwa.controllers.reportarError.marker.on("dragend",function(e){var o=e.target,r=o.getLatLng(),t=r.lat+","+r.lng;o.setLatLng(new L.LatLng(r.lat,r.lng),{draggable:"true"}),gmwa.controllers.reportarError.map.panTo(new L.LatLng(r.lat,r.lng)),$("#storeloc").val(t)})}))}},gmwa.controllers=gmwa.controllers||{},gmwa.controllers.reserve={},gmwa.controllers.reserve.init=function(){if(gmwa.logger.log("Reserve|Init..."),gmwa.components.header.init(),gmwa.controllers.reserve.buildSpecialHoursStatus(),gmwa.utils.isMobile()){var e=document.getElementById("tabInfo");e&&e.addEventListener("click",function(e){gmwa.controllers.reserve.map||gmwa.controllers.reserve.initializeMap()})}else gmwa.controllers.reserve.initializeMap();gmwa.controllers.reserve.initKeenSlider()},gmwa.controllers.reserve.initializeGoogleMap=function(){var e=$("#mapa");if(0!=e.length){var o=e.data("lat"),r=e.data("lng"),t=15,a=e.data("im");if(""!=o&&""!=r&&0!=o&&0!=r&&0!=t){var n=new google.maps.LatLng(o,r);if(a)var l={zoom:t,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:!1,scrollwheel:!1,panControl:!0,zoomControl:!0,scaleControl:!0,overviewMapControl:!0,streetViewControl:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}};else var l={zoom:t,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:!0,scrollwheel:!0,panControl:!0,zoomControl:!0,scaleControl:!0,overviewMapControl:!0,streetViewControl:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}};var i=new google.maps.Map(e[0],l);new google.maps.Marker({position:n,map:i})}}},gmwa.controllers.reserve.initializeMap=function(){var e=$("#mapa"),o=e.data("lat"),r=e.data("lng"),t=16,a=e.data("im");""==o||""==r||0==o||0==r||0==t||isNaN(o)||isNaN(r)||(gmwa.logger.log("Initializing Maps..."),gmwa.components.maps.instance.initMapAsync("mapa",o,r,t,a,function(e){gmwa.controllers.reserve.map=e,gmwa.components.maps.instance.addMarkerSimple(gmwa.controllers.reserve.map,o,r)}))},gmwa.controllers.reserve.buildSpecialHoursStatus=function(){var e={color:"darkorange",text:"text",show:!0,htext:"text",specialDate:null},o=window.hrsps,r=null;if(r=new Date,r=r.getFullYear()+"-"+(0+String(r.getMonth()+1)).slice(-2)+"-"+(0+String(r.getDate())).slice(-2),o.length){e.color="#7CB342";var t=dayjs(o[0].d+" 00:00:00");if(e.specialDate=gmwa.controllers.reserve.convertDateToString(t,!0),o[0].dsc&&(e.specialDate=o[0].dsc+", "+gmwa.controllers.reserve.convertDateToString(t,!0)),o[0].cf){var a;if(o[0].hp){a=" abierto de ";var n=[];o[0].hp.forEach(function(e){n.push(gmwa.controllers.reserve.buildHourLabel(e.start)+" a "+gmwa.controllers.reserve.buildHourLabel(e.end))}),a+=n.join(", ")}else a=" cerrado",e.color="#FF5722";o[0].dsc?e.htext=gmwa.controllers.reserve.convertDateToString(t,!0)+' "'+o[0].dsc+'" '+a:e.htext=gmwa.controllers.reserve.convertDateToString(t,!0)+a}else e.color="#FF9800",(new Date).getDay()==parseInt(t.format("d"))?e.htext="El horario de hoy puede variar":e.htext="El horario para el "+gmwa.controllers.reserve.convertDateToString(t,!0)+(o[0].dsc?" "+o[0].dsc:"")+" puede variar";$("#horarioEspecial").append($('<div style="color: '+e.color+'">'+e.htext+"</div>"))}},gmwa.controllers.reserve.convertDateToString=function(e,o){return o?e.format("dddd D [de] MMMM"):e.format("D [de] MMMM")},gmwa.controllers.reserve.coversCarrousel=null,gmwa.controllers.reserve.coversCarrouselInterval=0,gmwa.controllers.reserve.initKeenSlider=function(){gmwa.controllers.reserve.coversCarrouselInterval=0;var e=document.getElementById("keenCovers");e&&(gmwa.controllers.reserve.coversCarrousel=new KeenSlider(e,{loop:!0,duration:1e3,dragStart:function(){gmwa.controllers.reserve.carrouselAutoplay(!1)},dragEnd:function(){gmwa.controllers.reserve.carrouselAutoplay(!0)},created:function(){e.style.display="flex";var o=document.querySelectorAll(".keen-slider__slide");o.forEach(function(e,o){o>0&&(e.style.display="block")})},slideChanged:function(e){var o=e.details().relativeSlide,r=document.querySelectorAll(".story-dot ");r.forEach(function(e,r){r==o?e.classList.add("story-dot--active"):e.classList.remove("story-dot--active")})}}),gmwa.controllers.reserve.carrouselAutoplay(!0))},gmwa.controllers.reserve.carrouselAutoplay=function(e){clearInterval(gmwa.controllers.reserve.coversCarrouselInterval),gmwa.controllers.reserve.coversCarrouselInterval=setInterval(function(){e&&gmwa.controllers.reserve.coversCarrousel&&gmwa.controllers.reserve.coversCarrousel.next()},5e3)};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.resultlist={},gmwa.controllers.resultlist.markersItems=[],gmwa.controllers.resultlist.init=function(){gmwa.logger.log("ResultList|Init..."),gmwa.components.header.init(),$(".related-list-opener").on("click",function(){var e=$(this);$(this).parents("ul:first").find("li.to-show").toggle(0,function(){"Ver más relacionados"==e.find("b:first").text()?e.find("b:first").text("Ocultar"):e.find("b:first").text("Ver más relacionados")})}),window.innerWidth>=640?($("#listMapCntr").sticky({topSpacing:10,zIndex:0}),gmwa.controllers.resultlist.loadStoresInMap()):(gmwa.controllers.resultlist.mapSwitchOn=!1,$("#fabMapSwitch").click(function(e){gmwa.controllers.resultlist.mapSwitchOn?($("#mapCntr").hide(),$(this).html('<i class="fa fa-map-o" aria-hidden="true"></i>')):($("#mapCntr").show(),void 0===gmwa.controllers.resultlist.map&&gmwa.controllers.resultlist.loadStoresInMap(),$(this).html('<i class="fa fa-list" aria-hidden="true"></i>')),gmwa.controllers.resultlist.mapSwitchOn=!gmwa.controllers.resultlist.mapSwitchOn}))},gmwa.controllers.resultlist.loadStoresInMap=function(){0==gmwa.mapsFW?gmwa.controllers.resultlist.loadStoresInGMap("listMap"):gmwa.controllers.resultlist.loadStoresInLMap("listMap")},gmwa.controllers.resultlist.loadStoresInLMap=function(e){if(gmwa.logger.log("ResultList|Loading LMaps...."),$(".item-comercio").each(function(){var e=$(this).data("lat"),o=$(this).data("lng"),r=$(this).data("id"),t=null,a=$(this).find(".item-icon");if(a.length>0&&(a=$(a[0]),t=a.hasClass("lazyload")?a.attr("data-src"):a.attr("src")),""!==e){var n={latitude:parseFloat(e),longitude:parseFloat(o)},l="gmMarkerDot",i="gmMarkerPin4",s=0,c=$(this).find("h2").text().replace(/ /g,"-");infoWContent='<div id="iwStore" class="rs-iw-cntr" data-id="'+r+'" data-name="'+c+'">',t&&t.length>0?infoWContent+='<img src="'+t+'" alt="'+c+'" witdh="31" height="31"><div style="margin-left: 55px;">':infoWContent+="<div>",infoWContent+="<h4>"+$(this).find("h2").text()+"</h4><p>"+$(this).find("h3").html()+"</p>",infoWContent+="</div></div>","vigente"==$(this).data("plan")?(t&&t.length>0?richMarkerHtml='<div class="'+i+'"><div><img src="'+t+'"  alt="'+c+'" witdh="31" height="31"></div></div>':richMarkerHtml='<div class="'+l+'"></div>',s=1):richMarkerHtml='<div class="'+l+'"></div>',gmwa.controllers.resultlist.markersItems.push({locName:c,point:n,markerHtml:richMarkerHtml,infoWHtml:infoWContent})}}),gmwa.controllers.resultlist.markersItems.length>0){var o=[];gmwa.components.maps.LMaps.initMapAsync(e,gmwa.controllers.resultlist.markersItems[0].point.latitude,gmwa.controllers.resultlist.markersItems[0].point.longitude,16,!1,function(e){gmwa.controllers.resultlist.map=e,gmwa.controllers.resultlist.map.on("popupopen",function(e){console.log("Hook open"),$("#iwStore").on("click",function(e){console.log("popup click"),window.location="/local/"+$(this).data("name").toLowerCase()+"/LOC"+$(this).data("id")})}),gmwa.controllers.resultlist.map.on("popupclose",function(e){console.log("Hook close"),$("#iwStore").off("click")});for(var r=0;r<gmwa.controllers.resultlist.markersItems.length;r++){var t=new L.marker([gmwa.controllers.resultlist.markersItems[r].point.latitude,gmwa.controllers.resultlist.markersItems[r].point.longitude],{icon:L.divIcon({html:gmwa.controllers.resultlist.markersItems[r].markerHtml})}),a=L.popup();a.setContent(gmwa.controllers.resultlist.markersItems[r].infoWHtml),t.bindPopup(a),t.addTo(gmwa.controllers.resultlist.map),gmwa.controllers.resultlist.markersItems[r].marker=t,o.push([gmwa.controllers.resultlist.markersItems[r].point.latitude,gmwa.controllers.resultlist.markersItems[r].point.longitude])}gmwa.controllers.resultlist.map.fitBounds(o,{padding:[20,20]})})}},gmwa.controllers.resultlist.loadStoresInGMap=function(e){var o=document.getElementById(e);if(null!==o){gmwa.controllers.resultlist.map=new google.maps.Map(o,{center:new google.maps.LatLng(-27.747,-62.987952),zoom:13,mapTypeId:"roadmap",styles:gmwa.controllers.resultlist.noPoi,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM}}),gmwa.controllers.resultlist.map.initialZoom=!0,google.maps.event.addListener(gmwa.controllers.resultlist.map,"zoom_changed",function(){var e=google.maps.event.addListener(gmwa.controllers.resultlist.map,"bounds_changed",function(o){this.getZoom()>15&&gmwa.controllers.resultlist.map.initialZoom===!0&&(this.setZoom(15),gmwa.controllers.resultlist.map.initialZoom=!1),google.maps.event.removeListener(e)})}),bounds=new google.maps.LatLngBounds;var r=0,t="";if($(".item-comercio").each(function(){var e=$(this).data("lat"),o=$(this).data("lng"),a=$(this).data("id"),n=$(this).find(".item-icon").attr("src");if((null==n||void 0==n)&&(n=$(this).find(".item-icon").attr("data-src")),""!==e){var l=new google.maps.LatLng(parseFloat(e),parseFloat(o)),i="gmMarkerDot",s="gmMarkerPin4",c=0,d=0,m=$(this).find("h2").text().replace(/ /g,"-");t='<div id="iwStore" class="rs-iw-cntr" data-id="'+a+'" data-name="'+m+'">',n&&n.length>0&&(t+='<img src="'+n+'">'),t+="<div><h4>"+$(this).find("h2").text()+"</h4><p>"+$(this).find("h3").html()+"</p>",t+='<div style="bottom: 0px;position: absolute;right: 0px;font-weight:100">Ver mas</div></div></div>',infoW=new google.maps.InfoWindow({content:t}),infoW.idr=1e3,google.maps.event.addListener(infoW,"domready",function(){$("#iwStore").on("click",function(e){window.location.href="/local/"+$(this).data("name").toLowerCase()+"/LOC"+$(this).data("id")})}),"vigente"==$(this).data("plan")?(richMarkerHtml="<div class='"+s+"'><div><img src='"+n+"'></div></div>",c=1):richMarkerHtml="<div class='"+i+"'></div>";var g=new RichMarker({position:l,draggable:!1,flat:!0,anchor:RichMarkerPosition.BOTTOM,content:richMarkerHtml,map:gmwa.controllers.resultlist.map,piid:d,type:c,infoW:infoW});if(gmwa.controllers.resultlist.markersItems[r++]=g,gmwa.controllers.resultlist.buildMarker(g,gmwa.controllers.resultlist.map,d),bounds.extend(l),Foundation.MediaQuery.atLeast("medium")){var u=$(this).get(0);u.marker=g,$(this).mouseenter(function(e){var o=e.currentTarget.marker.a;0===e.currentTarget.marker.type?o.children[0].children[0].className="gmMarkerDotSelected":o.children[0].children[0].className="gmMarkerPin4Selected",void 0===o.style.zIndex||null===o.style.zIndex||0===o.style.zIndex.length?o.prevZIndex=1:o.prevZIndex=o.style.zIndex,o.style.zIndex=parseInt(o.prevZIndex)+1e3}),$(this).mouseleave(function(e){var o=e.currentTarget.marker.a;0===e.currentTarget.marker.type?o.children[0].children[0].className="gmMarkerDot":o.children[0].children[0].className="gmMarkerPin4",e.currentTarget.marker.hovered=!0,o.style.zIndex=o.prevZIndex})}}}),0===r){var a="-27.747508",n="-62.987952",l="-18.881115",i="-54.440589",s=new google.maps.LatLng(a,n),c=new google.maps.LatLng(l,i);bounds=new google.maps.LatLngBounds(s,c)}gmwa.controllers.resultlist.reArrangeMap(bounds)}},gmwa.controllers.resultlist.reArrangeMap=function(e){google.maps.event.addListener(gmwa.controllers.resultlist.map,"zoom_changed",function(){var e=google.maps.event.addListener(gmwa.controllers.resultlist.map,"bounds_changed",function(o){this.getZoom()>15&&gmwa.controllers.resultlist.map.initialZoom===!0&&(this.setZoom(15),gmwa.controllers.resultlist.map.initialZoom=!1),google.maps.event.removeListener(e)})}),gmwa.controllers.resultlist.bounds=e,gmwa.controllers.resultlist.map.fitBounds(gmwa.controllers.resultlist.bounds),gmwa.controllers.resultlist.map.setCenter(gmwa.controllers.resultlist.map.getCenter())},gmwa.controllers.resultlist.buildMarker=function(e,o,r){google.maps.event.addListener(e,"click",function(){gmwa.controllers.resultlist.lastMarkerSelected&&(0===gmwa.controllers.resultlist.lastMarkerSelected.type?gmwa.controllers.resultlist.lastMarkerSelected.a.children[0].children[0].className="gmMarkerDot":gmwa.controllers.resultlist.lastMarkerSelected.a.children[0].children[0].className="gmMarkerPin4"),0===this.type?this.a.children[0].children[0].className="gmMarkerDotSelected":this.a.children[0].children[0].className="gmMarkerPin4Selected",gmwa.controllers.resultlist.lastMarkerSelected=this,void 0!==gmwa.controllers.resultlist.prevInfoWindow&&gmwa.controllers.resultlist.prevInfoWindow.close(),this.infoW.open(gmwa.controllers.resultlist.map,this),gmwa.controllers.resultlist.prevInfoWindow=this.infoW})};var gmwa=gmwa||{};gmwa.services=gmwa.services||{},gmwa.services.worker={},gmwa.services.worker.register=function(){"serviceWorker"in navigator?navigator.serviceWorker.register("/service-worker.js").then(gmwa.services.worker.initialiseState):gmwa.isSafari?(gmwa.logger.log("App|Safari delaying check...."),setTimeout(function(){gmwa.services.worker.initialiseState()},500)):gmwa.logger.log("App|Service workers aren't supported in this browser.")},gmwa.services.worker.onInitializeState=function(e){void 0===gmwa.services.worker.eventSubsInitializeState&&(gmwa.services.worker.eventSubsInitializeState=[]),gmwa.services.worker.eventSubsInitializeState.push(e)},gmwa.services.worker.triggerInitializeState=function(e,o,r){if(void 0!==gmwa.services.worker.eventSubsInitializeState)for(var t=0;t<gmwa.services.worker.eventSubsInitializeState.length;t++)gmwa.services.worker.eventSubsInitializeState[t]({isPushSupported:e,isPushEnabled:o,isPushBlocked:r})},gmwa.services.worker.initialiseState=function(){if(gmwa.isSafari){if(!("safari"in window&&"pushNotification"in window.safari))return gmwa.logger.log("App|InitState|Notifications aren't supported."),void gmwa.services.worker.triggerInitializeState(!1,!1,!1);var e=window.safari.pushNotification.permission(gmwa.webpush.pushId);gmwa.webpush.isPushSupported=!0,"denied"===e.permission?(gmwa.logger.log("App|InitState|The user has blocked notifications."),gmwa.webpush.isBlocked=!0,gmwa.services.worker.triggerInitializeState(!0,!1,!0)):"granted"===e.permission&&(gmwa.logger.log("User is already subscriberd with token: "+e.deviceToken),gmwa.router.sendPushSubscription&&(gmwa.logger.log("App|PushManager|Found existing push registration, synching with server..."),gmwa.webpush.sendSubscriptionToServer({isAPN:!0,endpoint:e.deviceToken})),gmwa.webpush.isPushEnabled=!0,gmwa.services.worker.triggerInitializeState(!0,!0,!1))}else{if(!("showNotification"in ServiceWorkerRegistration.prototype))return gmwa.logger.log("App|InitState|Notifications aren't supported."),void gmwa.services.worker.triggerInitializeState(!1,!1,!1);if(gmwa.webpush.isPushSupported=!0,"denied"===Notification.permission)return gmwa.logger.log("App|InitState|The user has blocked notifications."),gmwa.webpush.isBlocked=!0,void gmwa.services.worker.triggerInitializeState(!0,!1,!0);if(!("PushManager"in window))return gmwa.logger.log("App|InitState|Push messaging isn't supported."),void gmwa.services.worker.triggerInitializeState(!0,!1,!0);navigator.serviceWorker.ready.then(function(e){e.pushManager.getSubscription().then(function(e){return e?(gmwa.router.sendPushSubscription&&(gmwa.logger.log("App|PushManager|Found existing push registration, synching with server..."),gmwa.webpush.sendSubscriptionToServer(e)),gmwa.webpush.isPushEnabled=!0,void gmwa.services.worker.triggerInitializeState(!0,!0,!1)):(gmwa.logger.log("App|PushManager|No push registration detected. User must request it."),void gmwa.services.worker.triggerInitializeState(!0,!1,!1))})["catch"](function(e){gmwa.logger.error("App|PushManager|Error during getSubscription()",e)})})}};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.promosAll={},gmwa.controllers.promosAll.init=function(){gmwa.components.header.init(),$("#mi-prms").addClass("u-tb-item-selected")};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.promosFicha={},gmwa.controllers.promosFicha.init=function(){$("#mi-prms").addClass("u-tb-item-selected"),gmwa.components.header.init()};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.promosHome={},gmwa.controllers.promosHome.init=function(){$("#mi-prms").addClass("u-tb-item-selected"),gmwa.components.header.init(),$("div[id^='prm-categ-']").each(function(){var e=$(this).data("id"),o=3.4;gmwa.utils.isMobile()&&(o=1.2);new Swiper("#prm-categ-"+e,{slidesPerView:o,paginationClickable:!1,navigation:{nextEl:"#next-categ-prm-"+e,prevEl:"#prev-categ-prm-"+e},spaceBetween:10})})};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.promosSponsor={},gmwa.controllers.promosSponsor.init=function(){$("#mi-prms").addClass("u-tb-item-selected"),gmwa.components.header.init()},gmwa.controllers=gmwa.controllers||{},gmwa.controllers.azar={},gmwa.controllers.azar.init=function(){gmwa.logger.log("Azar|Init..."),$("#mi-azar").addClass("u-tb-item-selected"),gmwa.components.header.init(),$("#bPanel2").on("click",function(e){e.preventDefault(),gmwa.controllers.azar.quinielaLoaded||$.ajax({url:"/azar/quiniela",contentType:"application/json; charset=utf-8"}).done(function(e){e&&($("#quinTitle1").text(e.tipo1),$("#quinFecha1").text(e.fecha1),$("#quinNum1").html('<li><span class="badge">01</span> '+e.num1_01+'</li><li><span class="badge">02</span> '+e.num1_02+'</li><li><span class="badge">03</span> '+e.num1_03+'</li><li><span class="badge">04</span> '+e.num1_04+'</li><li><span class="badge">05</span> '+e.num1_05+"</li>"),$("#quinNum2").html('<li><span class="badge">06</span> '+e.num1_06+'</li><li><span class="badge">07</span> '+e.num1_07+'</li><li><span class="badge">08</span> '+e.num1_08+'</li><li><span class="badge">09</span> '+e.num1_09+'</li><li><span class="badge">10</span> '+e.num1_10+"</li>"),$("#quinNum3").html('<li><span class="badge">11</span> '+e.num1_11+'</li><li><span class="badge">12</span> '+e.num1_12+'</li><li><span class="badge">13</span> '+e.num1_13+'</li><li><span class="badge">14</span> '+e.num1_14+'</li><li><span class="badge">15</span> '+e.num1_15+"</li>"),$("#quinNum4").html('<li><span class="badge">16</span> '+e.num1_16+'</li><li><span class="badge">17</span> '+e.num1_17+'</li><li><span class="badge">18</span> '+e.num1_18+'</li><li><span class="badge">19</span> '+e.num1_19+'</li><li><span class="badge">20</span> '+e.num1_20+"</li>"),$("#quinTitle2").text(e.tipo2),$("#quinFecha2").text(e.fecha2),$("#quinNum21").html('<li><span class="badge">01</span> '+e.num2_01+'</li><li><span class="badge">02</span> '+e.num2_02+'</li><li><span class="badge">03</span> '+e.num2_03+'</li><li><span class="badge">04</span> '+e.num2_04+'</li><li><span class="badge">05</span> '+e.num2_05+"</li>"),$("#quinNum22").html('<li><span class="badge">06</span> '+e.num2_06+'</li><li><span class="badge">07</span> '+e.num2_07+'</li><li><span class="badge">08</span> '+e.num2_08+'</li><li><span class="badge">09</span> '+e.num2_09+'</li><li><span class="badge">10</span> '+e.num2_10+"</li>"),$("#quinNum23").html('<li><span class="badge">11</span> '+e.num2_11+'</li><li><span class="badge">12</span> '+e.num2_12+'</li><li><span class="badge">13</span> '+e.num2_13+'</li><li><span class="badge">14</span> '+e.num2_14+'</li><li><span class="badge">15</span> '+e.num2_15+"</li>"),$("#quinNum24").html('<li><span class="badge">16</span> '+e.num2_16+'</li><li><span class="badge">17</span> '+e.num2_17+'</li><li><span class="badge">18</span> '+e.num2_18+'</li><li><span class="badge">19</span> '+e.num2_19+'</li><li><span class="badge">20</span> '+e.num2_20+"</li>"),gmwa.controllers.azar.quinielaLoaded=!0)}).fail(function(e){gmwa.logger.error("Could not get quinela info: "+JSON.stringify(e))})}),$("#bPanel3").on("click",function(e){e.preventDefault(),gmwa.controllers.azar.tombolaLoaded||$.ajax({url:"/azar/tombola",contentType:"application/json; charset=utf-8"}).done(function(e){e&&($("#tombTitle1").text(e.tipo1),$("#tombFecha1").text(e.fecha1),$("#tombNum1").html('<li><span class="badge">01</span> '+e.num1_01+'</li><li><span class="badge">02</span> '+e.num1_02+'</li><li><span class="badge">03</span> '+e.num1_03+'</li><li><span class="badge">04</span> '+e.num1_04+'</li><li><span class="badge">05</span> '+e.num1_05+"</li>"),$("#tombNum2").html('<li><span class="badge">06</span> '+e.num1_06+'</li><li><span class="badge">07</span> '+e.num1_07+'</li><li><span class="badge">08</span> '+e.num1_08+'</li><li><span class="badge">09</span> '+e.num1_09+'</li><li><span class="badge">10</span> '+e.num1_10+"</li>"),$("#tombNum3").html('<li><span class="badge">11</span> '+e.num1_11+'</li><li><span class="badge">12</span> '+e.num1_12+'</li><li><span class="badge">13</span> '+e.num1_13+'</li><li><span class="badge">14</span> '+e.num1_14+'</li><li><span class="badge">15</span> '+e.num1_15+"</li>"),$("#tombNum4").html('<li><span class="badge">16</span> '+e.num1_16+'</li><li><span class="badge">17</span> '+e.num1_17+'</li><li><span class="badge">18</span> '+e.num1_18+'</li><li><span class="badge">19</span> '+e.num1_19+'</li><li><span class="badge">20</span> '+e.num1_20+"</li>"),$("#tombTitle2").text(e.tipo2),$("#tombFecha2").text(e.fecha2),$("#tombNum21").html('<li><span class="badge">01</span> '+e.num2_01+'</li><li><span class="badge">02</span> '+e.num2_02+'</li><li><span class="badge">03</span> '+e.num2_03+'</li><li><span class="badge">04</span> '+e.num2_04+'</li><li><span class="badge">05</span> '+e.num2_05+"</li>"),$("#tombNum22").html('<li><span class="badge">06</span> '+e.num2_06+'</li><li><span class="badge">07</span> '+e.num2_07+'</li><li><span class="badge">08</span> '+e.num2_08+'</li><li><span class="badge">09</span> '+e.num2_09+'</li><li><span class="badge">10</span> '+e.num2_10+"</li>"),$("#tombNum23").html('<li><span class="badge">11</span> '+e.num2_11+'</li><li><span class="badge">12</span> '+e.num2_12+'</li><li><span class="badge">13</span> '+e.num2_13+'</li><li><span class="badge">14</span> '+e.num2_14+'</li><li><span class="badge">15</span> '+e.num2_15+"</li>"),$("#tombNum24").html('<li><span class="badge">16</span> '+e.num2_16+'</li><li><span class="badge">17</span> '+e.num2_17+'</li><li><span class="badge">18</span> '+e.num2_18+'</li><li><span class="badge">19</span> '+e.num2_19+'</li><li><span class="badge">20</span> '+e.num2_20+"</li>"),gmwa.controllers.azar.tombolaLoaded=!0)}).fail(function(e){gmwa.logger.error("Could not get tombola info: "+JSON.stringify(e))})}),$("#bPanel4").on("click",function(e){e.preventDefault(),gmwa.controllers.azar.loteriaLoaded||$.ajax({url:"/azar/loteria",contentType:"application/json; charset=utf-8"}).done(function(e){e&&($("#lotFecha1").text(e.fecha),$("#lotNum1").html('<li><span class="badge">01</span> '+e.num01+'</li><li><span class="badge">02</span> '+e.num02+'</li><li><span class="badge">03</span> '+e.num03+'</li><li><span class="badge">04</span> '+e.num04+'</li><li><span class="badge">05</span> '+e.num05+"</li>"),$("#lotNum2").html('<li><span class="badge">06</span> '+e.num06+'</li><li><span class="badge">07</span> '+e.num07+'</li><li><span class="badge">08</span> '+e.num08+'</li><li><span class="badge">09</span> '+e.num09+'</li><li><span class="badge">10</span> '+e.num10+"</li>"),$("#lotNum3").html('<li><span class="badge">11</span> '+e.num11+'</li><li><span class="badge">12</span> '+e.num12+'</li><li><span class="badge">13</span> '+e.num13+'</li><li><span class="badge">14</span> '+e.num14+'</li><li><span class="badge">15</span> '+e.num15+"</li>"),$("#lotNum4").html('<li><span class="badge">16</span> '+e.num16+'</li><li><span class="badge">17</span> '+e.num17+'</li><li><span class="badge">18</span> '+e.num18+'</li><li><span class="badge">19</span> '+e.num19+'</li><li><span class="badge">20</span> '+e.num20+"</li>"),$("#lotAprox1").text(e.aprox1),$("#lotAprox2").text(e.aprox2),$("#lotPrem01").text(e.prem01),$("#lotPrem02").text(e.prem02),$("#lotPrem03").text(e.prem03),$("#lotPrem04_05").text(e.prem04_05),$("#lotPrem06_10").text(e.prem06_10),$("#lotPrem11_20").text(e.prem11_20),$("#lotPremaprox").text(e.premaprox),gmwa.controllers.azar.loteriaLoaded=!0)}).fail(function(e){gmwa.logger.error("Could not get loteria info: "+JSON.stringify(e))})})},gmwa.controllers=gmwa.controllers||{},gmwa.controllers.cartelera={},gmwa.controllers.cartelera.init=function(){gmwa.logger.log("Cartelera|Init..."),$("#mi-cart").addClass("u-tb-item-selected"),gmwa.components.header.init()};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.horoscopo={},gmwa.controllers.horoscopo.init=function(){$("#mi-horo").addClass("u-tb-item-selected"),gmwa.components.header.init(),$("a.btnHor").each(function(){$(this).click(function(e){var o=$(this).find("img").attr("src"),r=$(this).find(".signo").text();$("#iconPrediction").attr("src",o),$("#signName").text(r),$.ajax({url:"/horoscopo/"+r}).done(function(e){$("#textPrediction").text(e.pronostico),void 0===gmwa.controllers.horoscopo.modal&&(gmwa.controllers.horoscopo.modal=$("#modalPrediction")),gmwa.controllers.horoscopo.modal.foundation("open")}).fail(function(e){gmwa.logger.error("Could not get horoscopo for sign : "+r),gmwa.logger.error(e)})})})};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.orderCheckout={};var users=null,user=null,apto=!1;gmwa.controllers.orderCheckout.newLocation={},gmwa.controllers.orderCheckout.scheduleType=0,gmwa.controllers.orderCheckout.cartOpened=!1,gmwa.controllers.orderCheckout.coverageChecked=!1,gmwa.controllers.orderCheckout.coverageData=null,gmwa.controllers.orderCheckout.init=function(){gmwa.logger.log("OrderCheckout|Init..."),gmwa.controllers.orderCheckout.isMobile=gmwa.utils.isMobile(),gmwa.components.header.init(),null!=window.preUser&&(users=window.preUser,users.length>0?(user=users[users.length-1],void 0!==user.address&&null!==user.address&&user.address.address.length>0?(user.selectedAddress=user.address,gmwa.controllers.orderCheckout.isFirstAddress=!1):user.selectedAddress=null):gmwa.controllers.orderCheckout.isFirstAddress=!0),!window.isOpened&&window.outOfHours&&(gmwa.controllers.orderCheckout.scheduleType=1),$("#verModal").click(function(e){null===user||gmwa.controllers.orderCheckout.isFirstAddress?(1==gmwa.controllers.orderCheckout.entrega?$("#modalAddAddressGeo").show():$("#modalAddAddressGeo").hide(),gmwa.controllers.orderCheckout.openAddLocation()):gmwa.controllers.orderCheckout.openLocationSelector()}),$("#lblSpInstr").click(function(e){$("#lblSpInstr").hide(),$("#txtSpInstr").show(0,function(){$("#textArea").focus()})}),$("#textArea").focusout(function(e){0===$("#textArea").val().length&&($("#lblSpInstr").show(),$("#txtSpInstr").hide())}),$("#cart-table-title").on("click",function(e){gmwa.controllers.orderCheckout.isMobile&&(gmwa.controllers.orderCheckout.cartOpened?$("#cart-table").hide():$("#cart-table").show(),gmwa.controllers.orderCheckout.cartOpened=!gmwa.controllers.orderCheckout.cartOpened)});var e=dayjs().add(3,"d").toDate(),o=document.createElement("script");o.src="/js/vendors/foundation-datepicker/foundation-datepicker.min.js",o.onload=function(){$("#optPickDate").fdatepicker({language:"es",initialDate:e,startDate:e}).on("changeDate",function(e){var o=dayjs.utc(e.date);o.add(e.date.getTimezoneOffset(),"minutes"),$("#optPickDate").html("<div>"+o.format("dddd")+"</div><p>"+o.format("DD")+"</p><div>"+o.format("MMM").toUpperCase()+"</div>"),$(".optionsDays div").removeClass("selected"),$(this).addClass("selected");var r=o.format("e"),t=gmwa.controllers.orderCheckout.buildHoursOptions(r);$("#opt-list-X-sel").html(t),void 0===gmwa.controllers.orderCheckout.previousScheduleTable&&(gmwa.controllers.orderCheckout.previousScheduleTable=$("#opt-list-1")),gmwa.controllers.orderCheckout.previousScheduleTable.hide(),gmwa.controllers.orderCheckout.previousScheduleTable=$("#opt-list-X"),gmwa.controllers.orderCheckout.previousScheduleTableSelect=gmwa.controllers.orderCheckout.previousScheduleTable.find("select"),gmwa.controllers.orderCheckout.previousScheduleTable.show(),void 0===gmwa.controllers.orderCheckout.scheduleValue&&(gmwa.controllers.orderCheckout.scheduleValue={}),gmwa.controllers.orderCheckout.scheduleValue.date=o.format("YYYY/MM/DD"),gmwa.controllers.orderCheckout.scheduleValue.hour="-1",gmwa.controllers.orderCheckout.previousScheduleTableSelect.val($("#opt-list-X select option:first").val())})},document.body.appendChild(o),gmwa.services.worker.onInitializeState(function(e){gmwa.logger.log("onInitializeState | "+JSON.stringify(e)),e.isPushSupported?e.isPushEnabled?(gmwa.logger.log("Push ON"),$("#qrNotifyMe").prop("checked",!0),gmwa.isSafari&&$("#qrNotifyMe").prop("disabled",!0)):gmwa.isSafari&&$("#qrNotifyMe").prop("disabled",!1):$("#qrNotifyMeCntr").hide()}),$("#qrNotifyMe").click(function(e){$("#qrNotifyMe").prop("disabled",!0),e.preventDefault(),$(this).is(":checked")?gmwa.webpush.subscribe(function(e){0===e?$("#qrNotifyMe").prop("checked",!0):-1==e?($("#qrNotifyMeError1").show(),$("#qrNotifyMe").prop("checked",!1)):-2==e&&($("#qrNotifyMeError2").show(),$("#qrNotifyMe").prop("checked",!1)),$("#qrNotifyMe").prop("disabled",!1)}):gmwa.webpush.unsubscribe(function(e){0===e?$("#qrNotifyMe").prop("checked",!1):-1==e&&gmwa.logger.error("Unubscribe returned "+e),$("#qrNotifyMe").prop("disabled",!1)})}),gmwa.controllers.orderCheckout.drawUserData(),gmwa.controllers.orderCheckout.checkoutOptions(),gmwa.controllers.orderCheckout.hookSchedule(),gmwa.controllers.orderCheckout.checkDeliveryCoverage()},gmwa.controllers.orderCheckout.drawUserData=function(){var e="",o="";null===user?(1==gmwa.controllers.orderCheckout.entrega?(e="<div>Por favor ingresa tus datos y tu ubicación para poder solicitar la entrega</div>",
$("#datosUsuarioMap").html('<i class="fa fa-map-marker" aria-hidden="true" style="position: absolute;left: 30px;top: 20px;font-size: 50px;color: #DDD;"></i>')):(e="<div>Por favor ingresa tus datos para identificarte al momento de levantar el pedido</div>",$("#datosUsuarioMap").html('<i class="fa fa-shopping-bag" aria-hidden="true" style="position: absolute;left: 30px;top: 20px;font-size: 50px;color: #DDD;"></i>')),o="Agregar mis datos"):1==gmwa.controllers.orderCheckout.entrega?null!==user.selectedAddress?(e='<div style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;color: grey;">'+user.name+"</div>",e+="<div style='color: grey; display: inline;'>Tel: "+user.phone+"</div>",e+='<div style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;color: grey;">'+user.selectedAddress.address+"</div>",o="Cambiar"):(e="Para solicitar entrega a domicilio necesitamos los datos de tu dirección.",o="Ingresar mi dirección",$("#datosUsuarioMap").hide()):(e='<div style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;color: grey;">'+user.name+"</div>",e+="<div style='color: grey; display: inline;'>Tel: "+user.phone+"</div>",o="Cambiar",$("#datosUsuarioMap").html('<i class="fa fa-shopping-bag" aria-hidden="true" style="position: absolute;left: 30px;top: 20px;font-size: 50px;color: #DDD;"></i>')),$("#datosUsuario").html(e),$("#verModal").html(o)},gmwa.controllers.orderCheckout.openLocationSelector=function(){return void 0!==gmwa.controllers.orderCheckout.modalSelectAddress?void gmwa.controllers.orderCheckout.modalSelectAddress.foundation("open"):(gmwa.controllers.orderCheckout.modalSelectAddress=$("#modalSelectAddress"),gmwa.controllers.orderCheckout.modalSelectAddress.foundation("open"),void $(".u-address-card").click(gmwa.controllers.orderCheckout.selectAddressCard))},gmwa.controllers.orderCheckout.selectAddressCard=function(e){gmwa.controllers.orderCheckout.selectAddress($(this).attr("data-index"))},gmwa.controllers.orderCheckout.selectAddress=function(e){user=users[e],user.selectedAddress=user.address,gmwa.controllers.orderCheckout.modalSelectAddress&&gmwa.controllers.orderCheckout.modalSelectAddress.foundation("close"),gmwa.controllers.orderCheckout.drawUserData(),gmwa.controllers.orderCheckout.checkDeliveryCoverage()},gmwa.controllers.orderCheckout.checkDeliveryCoverage=function(){if(1==gmwa.controllers.orderCheckout.entrega){$("#infoDelCost").html("Verificando cobertura..."),$("#infoDelCost").show();var e=document.location.href.split("/"),o=e[e.length-3],r=e[e.length-2];if(null===user||void 0===user.selectedAddress||null===user.selectedAddress)return $("#infoDelCost").addClass("alert"),$("#infoDelCost").removeClass("success"),void $("#infoDelCost").html("<div>Para poder solicitar entrega a domicilio, por favor ingrese sus datos y su dirección. Recuerde confirmar el punto en el mapa para asgurar que la entrega llegue a destino sin problemas.</div>");if(void 0===user.selectedAddress.lat||null===user.selectedAddress.lat)return $("#infoDelCost").addClass("alert"),$("#infoDelCost").removeClass("success"),void $("#infoDelCost").html("<div>No se puede verificar su ubicación (1). Por favor vuelva a ingresar su dirección y confirma el punto en el mapa.</div>");$.ajax({url:"/pedidos/checkDeliveryCoverageZone/"+o+"/"+r+"/"+user.selectedAddress.lat+"/"+user.selectedAddress.lng,contentType:"application/json; charset=utf-8"}).done(function(e){200==e.meta.status?(gmwa.logger.log("CoverageCheck | API returned OK. DATA= "+JSON.stringify(e)),gmwa.controllers.orderCheckout.coverageChecked=!0,gmwa.controllers.orderCheckout.coverageData=e.data,e.data.isInside?(0===e.data.amount?($("#infoDelCost").html("<div>Te encuentras dentro del area de cobertura. El envío es gratis.</div>"),gmwa.controllers.orderCheckout.updateCartTotal(0)):($("#infoDelCost").html("<div>Te encuentras dentro del area de cobertura. El costo de envío es $"+e.data.amount+"</div>"),gmwa.controllers.orderCheckout.updateCartTotal(e.data.amount)),$("#infoDelCost").addClass("success"),$("#infoDelCost").removeClass("alert")):($("#infoDelCost").addClass("alert"),$("#infoDelCost").removeClass("success"),$("#infoDelCost").html("<div>Lamentablemente te encuentras fuera del area de cobertura para entrega.</div>"),gmwa.controllers.orderCheckout.updateCartTotal(0))):(gmwa.logger.error("CoverageCheck | API returned error: "+JSON.stringify(e)),$("#infoDelCost").addClass("alert"),$("#infoDelCost").removeClass("success"),$("#infoDelCost").html("<div>Ocurrio un error verificando su ubicación (2). Por favor vuelva a ingresar su dirección y confirma el punto en el mapa.</div>"),gmwa.controllers.orderCheckout.updateCartTotal(0))}).fail(function(e){gmwa.logger.error("CoverageCheck | API returned error: "+JSON.stringify(e)),$("#infoDelCost").addClass("alert"),$("#infoDelCost").removeClass("success"),$("#infoDelCost div").html("<div>Ocurrio un error verificando su ubicación (3). Por favor vuelva a ingresar su dirección y confirma el punto en el mapa.</div>"),gmwa.controllers.orderCheckout.updateCartTotal(0)})}else $("#infoDelCost").hide(),gmwa.controllers.orderCheckout.updateCartTotal(0)},gmwa.controllers.orderCheckout.updateCartTotal=function(e){$("#cartDeliveryCost").html(gmwa.utils.formatNumberHTML(e));var o=$("#cartTotalAmount").data("amount");$("#cartTotalAmount").html(gmwa.utils.formatNumberHTML(o+e)),$("#headerCartTotal").html(gmwa.utils.formatNumberHTML(o+e)),$("#cartTotalAmount").fadeTo("slow",.1).fadeTo("slow",1),$("#headerCartTotal").fadeTo("slow",.1).fadeTo("slow",1)},gmwa.controllers.orderCheckout.openAddLocation=function(){return void 0!==gmwa.controllers.orderCheckout.modalAddAddress?void gmwa.controllers.orderCheckout.modalAddAddress.foundation("open"):(gmwa.controllers.orderCheckout.modalAddAddress=$("#modalAddAddress"),gmwa.controllers.orderCheckout.modalAddAddress.foundation("open"),$("#datoAdd").click(function(e){var o={};o.name=$("#txtNombre").val(),o.phone=$("#txtTelefono").val(),o.email=$("#txtEMail").val();var r={},t=$("#txtCalle").val(),a=$("#txtNro").val(),n=$("#txtCity").val(),l=$("#txtApto").val();l&&l.length>0?r.address=t+" "+a+" apto "+l:r.address=t+" "+a,n&&n.length>0&&(r.address+=", "+n),r.coords=gmwa.controllers.orderCheckout.newLocation;var i="";if((void 0===o.name||null===o.name||0===o.name.length)&&(i="Nombre es requerido"),(void 0===o.phone||null===o.phone||0===o.phone.length)&&(i.length>0&&(i+="<br>"),i+="Telefono es requerido"),1==gmwa.controllers.orderCheckout.entrega&&((void 0===t||null===t||0===t.length)&&(i.length>0&&(i+="<br>"),i+="Calle es requerida"),(void 0===a||null===a||0===a.length)&&(i.length>0&&(i+="<br>"),i+="Numero de puerta es requerido"),(void 0===n||null===n||0===n.length)&&(i.length>0&&(i+="<br>"),i+="Ciudad es requerida"),(void 0===r.coords||void 0===r.coords.lat||0===r.coords.lat.length)&&(i.length>0&&(i+="<br>"),i+="Por favor confirma el punto en el mapa para garantizar estar dentro de la zona de cobertura para entregas. Completa el formulario y haz clic en 'Buscar dirección'")),i.length>0)$("#formError").html(i),$("#formError").show();else{o.selectedAddress={address:r.address,lat:r.coords.lat,lng:r.coords.lng},o.address=o.selectedAddress;var s=!1,c=null;$("#newAddrAdded").length>0?(s=!0,c=$("#addrCntr").children().length-1):c=$("#addrCntr").children().length;var d='<div id="newAddrAdded" class="large-6 medium-6 small-12 columns" data-index="'+c+'"><div class="u-address-card" " data-name="'+o.name+'" data-phone="'+o.phone+'" data-address="'+r.address+'" data-lat="'+r.coords.lat+'" data-lng="'+r.coords.lng+'" >';d+="<p>"+o.name+"</p>",d+="<p><strong>"+r.address+"</strong></p>",d+="<p>Tel: "+o.phone+"</p></div></div>",s?(users[users.length-1]=o,$("#newAddrAdded").replaceWith($(d))):((void 0===users||null===users)&&(users=[]),users.push(o),$("#addrCntr").append($(d))),$("#newAddrAdded").click(gmwa.controllers.orderCheckout.selectAddressCard),gmwa.controllers.orderCheckout.selectAddress(c),gmwa.controllers.orderCheckout.modalAddAddress.foundation("close"),gmwa.controllers.orderCheckout.drawUserData(),gmwa.controllers.orderCheckout.checkDeliveryCoverage()}}),void $("#searchAddr").click(function(e){$(this).prop("disabled",!0);var o=$("#txtCalle").val(),r=$("#txtNro").val(),t=$("#txtCity").val();$("#searchAddrInfo").html("Buscando..."),gmwa.controllers.orderCheckout.buscarCoordenadas(o,r,t,function(e){$(this).prop("disabled",!1),null==e?$("#searchAddrInfo").html('<div style="color: #F44336;">No se pudo ubicar la direccion, por favor ingresela de otra manera e intente nuevamente</div>'):(gmwa.controllers.orderCheckout.newLocation.lat=e.lat,gmwa.controllers.orderCheckout.newLocation.lng=e.lng,gmwa.controllers.orderCheckout.initializeLMap(e.lat,e.lng),$.ajax({url:"/pedido/zoneinfo/"+e.lat+"/"+e.lng,contentType:"application/json; charset=utf-8"}).done(function(e){e.found?gmwa.controllers.orderCheckout.newLocation.zone=e:gmwa.controllers.orderCheckout.newLocation.zone=null,$("#searchAddrInfo").html('<div style="color: #4CAF50;">Ubicacion encontrada. Arrastre el pin en el mapa para ajustarlo de ser necesario</div>'),$("#datoAdd").prop("disabled",!1),gmwa.logger.info(e)}).fail(function(e){$("#datoAdd").prop("disabled",!1),gmwa.logger.error("Could not get zone info: "+JSON.stringify(e))}))})}))},gmwa.controllers.orderCheckout.checkoutOptions=function(e,o,r){var t=$("#deliveryMethod").data("sdp"),a=$("#deliveryMethod").data("sdd");t&&a?gmwa.controllers.orderCheckout.entrega=2:!t&&a?gmwa.controllers.orderCheckout.entrega=1:t&&!a&&(gmwa.controllers.orderCheckout.entrega=2);var n=1,l=!1;$("#ingresarDatos").click(function(e){1==gmwa.controllers.orderCheckout.entrega?$("#modalAddAddressGeo").show():$("#modalAddAddressGeo").hide(),gmwa.controllers.orderCheckout.openAddLocation()}),$("#opciones").click(function(e){$("#formulario").css("display","none"),$("#opcionesDatos").css("display","flex")}),$("#ingresarDatosCancel").click(function(e){gmwa.controllers.orderCheckout.modalSelectAddress.foundation("close")}),$("#btnDeliveryMethod button").click(function(e){$(this).siblings().removeClass("is-active"),$(this).addClass("is-active"),"1"==$(this).attr("data-id")?(gmwa.controllers.orderCheckout.entrega=1,$("#deliveryMethodText-1").show(),$("#deliveryMethodText-2").hide()):(gmwa.controllers.orderCheckout.entrega=2,$("#deliveryMethodText-2").show(),$("#deliveryMethodText-1").hide()),gmwa.controllers.orderCheckout.checkDeliveryCoverage(),gmwa.controllers.orderCheckout.drawUserData()}),$("#btnScheduleType button").click(function(e){$(this).siblings().removeClass("is-active"),$(this).addClass("is-active"),"1"==$(this).attr("data-id")?(gmwa.controllers.orderCheckout.scheduleType=1,$("#schedOptions").show()):(gmwa.controllers.orderCheckout.scheduleType=0,$("#schedOptions").hide())}),$(".tipoPago").click(function(e){n="1"==$(this).attr("data-id")?1:2}),$("#disclaimer").change(function(){l=$(this).prop("checked")}),$("#checkoutConfirm").click(function(){gmwa.controllers.orderCheckout.checkoutConfirm(n,e,o,r)}),$("#checkoutCancel").click(function(){})},gmwa.controllers.orderCheckout.checkoutConfirm=function(e,o,r,t){if(!window.isOpened&&!window.outOfHours)return void gmwa.utils.showError("No es posible pedir en este momento","Vuelve cuando estemos abiertos y confirma tu pedido. Puedes retomarlo en la seccion de Pedidos del menu principal.");var a=document.location.href.split("/"),n=($("#totalPrice").html(),{});n.token=a[a.length-1],n.idr=a[a.length-3],n.ids=a[a.length-2],n.shipping=gmwa.controllers.orderCheckout.entrega,n.description=$("#textArea").val(),0===gmwa.controllers.orderCheckout.scheduleType?(n.scheduleType=0,n.scheduleValue=""):(n.scheduleType=1,void 0!==gmwa.controllers.orderCheckout.scheduleValue?n.scheduleValue={date:gmwa.controllers.orderCheckout.scheduleValue.date,hour:gmwa.controllers.orderCheckout.scheduleValue.hour}:n.scheduleValue={}),n.paymentMethod=e,n.user={email:user.email,name:user.name,phone:user.phone,address:user.selectedAddress},void 0!==gmwa.controllers.orderCheckout.newLocation.zone&&null!==gmwa.controllers.orderCheckout.newLocation.zone&&(n.user.zone=gmwa.controllers.orderCheckout.newLocation.zone.zon);var l=gmwa.controllers.orderCheckout.validateCheckout(n);if(l.length>0){var i="<ul>";return l.forEach(function(e){i+="<li>"+e+"</li>"}),i+="</ul>",$("#errormsg").html(i),void $("#errormsgCntr").show()}$("#errormsgCntr").hide();var s=!0;if($('#cart-table tr[id*="line-id"]').each(function(){if(s){var e=$(this).data("open-days");if(""!=e){if(0==n.scheduleType)var o=(new Date).getDay();else var o=new Date(n.scheduleValue.date).getDay();s=gmwa.controllers.orderCheckout.validateOpenDays(e,o)}}}),s){var c=JSON.stringify(n),d="/pedido/checkout";gmwa.utils.showProgress("Enviando pedido","Espere por favor...",!0,!0),$.ajax({type:"POST",url:d,data:c,dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){200==e.meta.status?(gmwa.logger.log("Order Add Product | API returned OK: "+JSON.stringify(e)),gmwa.logger.log(c),document.location.href="/pedidos/pedido/"+n.token):(gmwa.logger.error("Order Add Product | API returned error: "+JSON.stringify(e)),gmwa.utils.hideProgress(),gmwa.utils.showError("No se pudo enviar el pedido","Ocurrio un problema al enviar el pedido, por favor inténtelo más tarde."))}).fail(function(e){gmwa.utils.hideProgress(),gmwa.utils.showError("No se pudo enviar el pedido","Ocurrio un problema al enviar el pedido, por favor inténtelo más tarde."),gmwa.logger.error("Order Add Product | API returned error: "+JSON.stringify(e))})}else gmwa.utils.showError("Pedido invalido","Uno o mas de los productos no pueden venderse en el día seleccionado"),gmwa.logger.error("Order Add Product | Invalid day to buy product(s)")},gmwa.controllers.orderCheckout.validateOpenDays=function(e,o){const r=64,t=32,a=16,n=8,l=4,i=2,s=1;var c=[];return(e&r)==r&&c.push(0),(e&t)==t&&c.push(1),(e&a)==a&&c.push(2),(e&n)==n&&c.push(3),(e&l)==l&&c.push(4),(e&i)==i&&c.push(5),(e&s)==s&&c.push(6),c.includes(o)?!0:!1},gmwa.controllers.orderCheckout.validateCheckout=function(e){var o=[];return 1!=e.shipping&&2!=e.shipping&&o.push("Selecciona un metodo de entrega"),0!==gmwa.controllers.orderCheckout.scheduleType&&(void 0===e.scheduleValue?1===e.shipping?o.push("Selecciona un dia y una hora para la entrega de tu pedido"):o.push("Selecciona un dia y una hora para levantar tu pedido."):(void 0===e.scheduleValue.date||0===e.scheduleValue.date.length||void 0===e.scheduleValue.hour||0===e.scheduleValue.hour.length||-1==e.scheduleValue.hour)&&(1===e.shipping?o.push("Selecciona un dia y una hora para la entrega de tu pedido"):o.push("Selecciona un dia y una hora para levantar tu pedido."))),void 0!==e.user.name&&null!==e.user.name&&0!==e.user.name.length||2!=e.shipping||o.push("Por favor ingresa un nombre para poder identificarte al momento de levantar tu pedido"),void 0!==e.user.phone&&null!==e.user.phone&&e.user.phone.length>0&&e.user.phone.length<8&&o.push("Por favor ingresa un numero de télefono válido"),void 0===e.user.address&&1==e.shipping&&o.push("Por favor ingresa una dirección donde enviar el pedido"),1==e.shipping&&(void 0===e.user.address.address||0===e.user.address.address.length||void 0===e.user.address.lat||0===e.user.address.lat.length?o.push("Por favor ingresa una dirección valida y especifica el punto en el mapa para facilitar la entrega"):void 0===gmwa.controllers.orderCheckout.coverageData?o.push("Por favor ingresa una direccion valida y especifica el punto en el mapa para facilitar la entrega"):gmwa.controllers.orderCheckout.coverageData.isInside||o.push("La direccion de entrega se encuentra fuera de nuestra zona de cobertura.")),o},gmwa.controllers.orderCheckout.hookSchedule=function(){$(".optionsDays").on("click",function(e){gmwa.controllers.orderCheckout.scheduleType=1,void 0===gmwa.controllers.orderCheckout.previousScheduleTable&&(gmwa.controllers.orderCheckout.previousScheduleTable=$("#opt-list-1")),gmwa.controllers.orderCheckout.previousScheduleTable.hide();var o=$(this).data("id");gmwa.controllers.orderCheckout.previousScheduleTable=$("#opt-list-"+o),gmwa.controllers.orderCheckout.previousScheduleTableSelect=gmwa.controllers.orderCheckout.previousScheduleTable.find("select"),gmwa.controllers.orderCheckout.previousScheduleTable.show(),$(".optionsDays div").removeClass("selected"),$("#optPickDate").removeClass("selected"),$(this).children("div").addClass("selected"),void 0===gmwa.controllers.orderCheckout.scheduleValue&&(gmwa.controllers.orderCheckout.scheduleValue={}),gmwa.controllers.orderCheckout.scheduleValue.date=$(this).data("date"),gmwa.controllers.orderCheckout.scheduleValue.hour="-1",gmwa.controllers.orderCheckout.previousScheduleTableSelect.val($("#opt-list-"+o+" select option:first").val())}),$(".optionsHours").on("change",function(e){void 0!==gmwa.controllers.orderCheckout.scheduleValue&&(gmwa.controllers.orderCheckout.scheduleValue.hour=gmwa.controllers.orderCheckout.previousScheduleTableSelect.val(),gmwa.logger.log(JSON.stringify(gmwa.controllers.orderCheckout.scheduleValue)))})},gmwa.controllers.orderCheckout.buildHoursOptions=function(e){var o=window.optionsTable[e],r="",t=null,a=null,n=null,l=null,i=dayjs(),s=(parseInt(i.hour()),null);if(o.isOpen)for(var c=0;c<o.hours.length;c++){t=o.hours[c].start,a=o.hours[c].end<t?2400:o.hours[c].end,n=(a-t)/50/2,l=dayjs(),l.hour(parseInt(t/100)),l.minute(parseInt(t%100));for(var d=0;n>d;d++)s={},s.start=l.format("HH:mm"),l.add(30,"m"),s.end=l.format("HH:mm"),r+='<option value="'+s.start+" - "+s.end+'" >'+s.start+" - "+s.end+"</option>",s={},s.start=l.format("HH:mm"),l.add(30,"m"),s.end=l.format("HH:mm"),r+='<option value="'+s.start+" - "+s.end+'" >'+s.start+" - "+s.end+"</option>"}else r='<option value="-1" > CERRADO </option>';return r},gmwa.controllers.orderCheckout.removePunctuation=function(e){return e.replace(/[á]/g,"a").replace(/[é]/g,"e").replace(/[ó]/g,"o").replace(/[í]/g,"i").replace(/[ú]/g,"u")},gmwa.controllers.orderCheckout.matchNames=function(e,o){for(var r=e.split(" "),t=o.split(" "),a=t.length,n=0,l=0;l<r.length;l++)for(var i=0;i<t.length;i++){var s=gmwa.controllers.orderCheckout.removePunctuation(r[l].toLowerCase()),c=gmwa.controllers.orderCheckout.removePunctuation(t[i].toLowerCase());s==c&&(n+=1)}var d=n/a;return gmwa.logger.info("Comparing A: ["+e+"] vs B: ["+o+" returned "+n+" over"+a+" ("+d+")"),d>=.5?!0:!1},gmwa.controllers.orderCheckout.buscarCoordenadas=function(e,o,r,t){var a="Uruguay";if(void 0!=e&&void 0!=r){var n="/pedido/gc/"+e+" "+o+","+r+","+a;$.ajax(n).done(function(o){if(o.status=o.results.length>0){for(var n=(o.data,!1),l=!1,i=!1,s=!1,c=0;c<o.results[0].address_components.length;c++)switch(o.results[0].address_components[c].types[0]){case"route":gmwa.controllers.orderCheckout.matchNames(o.results[0].address_components[c].long_name,e)&&(n=!0);break;case"locality":gmwa.controllers.orderCheckout.matchNames(o.results[0].address_components[c].long_name,r)&&(l=!0);break;case"administrative_area_level_1":gmwa.controllers.orderCheckout.matchNames(o.results[0].address_components[c].long_name,r)&&(i=!0);break;case"country":gmwa.controllers.orderCheckout.matchNames(o.results[0].address_components[c].long_name,a)&&(s=!0)}t(n&&(l||i)&&s?o.results[0].geometry.location:null)}})}else t(null)},gmwa.controllers.orderCheckout.initializeGoogleMap=function(e,o){var r=$("#mapa");if(0!=r.length){var t=17;if(""!=e&&""!=o&&0!=e&&0!=o&&0!=t){var a=new google.maps.LatLng(e,o),n={zoom:t,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:!0,scrollwheel:!0,panControl:!0,zoomControl:!0,scaleControl:!0,overviewMapControl:!0,streetViewControl:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}},l=new google.maps.Map(r[0],n),i=new google.maps.Marker({position:a,map:l,draggable:!0});i.addListener("dragend",function(e){gmwa.controllers.orderCheckout.newLocation.lat=e.latLng.lat(),gmwa.controllers.orderCheckout.newLocation.lng=e.latLng.lng()}),setTimeout(function(){gmwa.logger.log("resize!")},1e3)}}},gmwa.controllers.orderCheckout.initializeLMap=function(e,o){if(null==gmwa.controllers.orderCheckout.map){var r=($("#mapa"),16),t=gmwa.controllers.orderCheckout.isMobile;""!=e&&""!=o&&0!=e&&0!=o&&0!=r&&(gmwa.logger.log("Initializing LMaps..."),gmwa.components.maps.instance.initMapAsync("mapa",e,o,r,t,function(r){gmwa.controllers.orderCheckout.map=r,gmwa.controllers.orderCheckout.marker=gmwa.components.maps.instance.addMarkerDraggable(gmwa.controllers.orderCheckout.map,e,o),gmwa.controllers.orderCheckout.marker.on("dragend",function(e){var o=e.target,r=o.getLatLng();gmwa.controllers.orderCheckout.newLocation.lat=r.lat,gmwa.controllers.orderCheckout.newLocation.lng=r.lng,gmwa.controllers.orderCheckout.map.panTo(new L.LatLng(r.lat,r.lng))})}))}};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.orderView={};var status=null,dateAccepted=null,estimatedTime=null,promised=null,scheduleType=null,scheduleValueDate=null,scheduleValueHour=null,openedCart=!1;gmwa.controllers.orderView.init=function(){if($("#mi-reqs").addClass("u-tb-item-selected"),gmwa.logger.log("OrderView|Init..."),gmwa.components.header.init(),dayjs.extend(window.dayjs_plugin_relativeTime),$("#orevprocessval").change(function(e){this.checked?($("#trwrongprocessval").hide(),$("#trwrongprocesscomplex").hide()):($("#trwrongprocessval").show(),$("#trwrongprocesscomplex").show())}),$("#orevshippingval").change(function(e){this.checked?($("#trwrongshippingsval").hide(),$("#trwrongshippingslow").hide(),$("#trwrongshippingbad").hide()):($("#trwrongshippingsval").show(),$("#trwrongshippingslow").show(),$("#trwrongshippingbad").show())}),$("#orevproductval").change(function(e){this.checked?($("#trwrongproductval").hide(),$("#trwrongproductdiff").hide()):($("#trwrongproductval").show(),$("#trwrongproductdiff").show())}),$("#doSendReview").click(gmwa.controllers.orderView.sendReview),status=$("#dataStatus").attr("data-status"),"ACEPTADO"==status){if(dateAccepted=$("#dataFecha").attr("data-date"),estimatedTime=$("#dataFecha").attr("data-estimated"),scheduleType=$("#dataFecha").attr("data-scheduletype"),scheduleValueDate=$("#dataFecha").attr("data-schedulevaluedate"),scheduleValueHour=$("#dataFecha").attr("data-schedulevaluehour"),0==scheduleType)promised=dayjs(dateAccepted).add(estimatedTime,"m");else{promised=dayjs(scheduleValueDate);var e=scheduleValueHour.replace(" ","").split("-"),o=e[0].split(":");promised.hour(o[0]),promised.minute(o[1]),promised.second(0)}gmwa.controllers.orderView.reloj()}$("#cart-checkedout-title").click(function(){openedCart?($("#cart-checked-table").hide(),$("#cart-checkedout-title > i").removeClass("fa-caret-left"),$("#cart-checkedout-title > i").addClass("fa-caret-down")):($("#cart-checked-table").show(),$("#cart-checkedout-title > i").removeClass("fa-caret-down"),$("#cart-checkedout-title > i").addClass("fa-caret-left")),openedCart=!openedCart})},gmwa.controllers.orderView.reloj=function(){var e=dayjs().to(promised);if(dayjs()>=promised){var o=$('<div style="font-size: 17px;line-height: 20px;">El pedido ya deberia haberse entregado</div>');$("#minutes").html(o)}else $("#minutes").html(e);setTimeout(function(){gmwa.controllers.orderView.reloj()},6e4)},gmwa.controllers.orderView.sendReview=function(e){e.preventDefault();var o={token:$("#orevToken").val(),text:$("#orevDesc").val(),processVal:$("#orevprocessval").is(":checked")?1:0,shippingVal:$("#orevshippingval").is(":checked")?1:0,productVal:$("#orevproductval").is(":checked")?1:0,wrongProcessComplex:$("#orevwrongprocesscomplex").is(":checked")?1:0,wrongShippingSlow:$("#qrevwrongshippingslow").is(":checked")?1:0,wrongShippingBad:$("#orevwrongshippingbad").is(":checked")?1:0,wrongProductDiff:$("#qrevwrongproductdiff").is(":checked")?1:0},r=JSON.stringify(o),t="/pedido/review";$.ajax({type:"POST",url:t,data:r,contentType:"application/json"}).done(function(e){void 0===gmwa.controllers.orderView.reviewDoneModal&&($("body").append($('<div class="tiny reveal u-reveal" id="cord" data-reveal data-animation-in="fade-in" data-animation-out="fade-out" data-close-on-click="false" data-close-on-esc="false"><div class="u-reveal-body"></div><div class="u-reveal-footer"><button id="cordClose" type="button" class="alert button">Cerrar</button></div></div>')),gmwa.controllers.orderView.reviewDoneModal=$("#cord"),gmwa.controllers.orderView.reviewDoneModal.foundation()),$("#cord .u-reveal-body").html(e),$("#cordClose").click(function(e){gmwa.controllers.orderView.reviewDoneModal.foundation("close"),document.location.href="/pedidos"}),gmwa.controllers.orderView.reviewDoneModal.foundation("open")}).fail(function(e){gmwa.logger.error("Order Review | API returned error: "+JSON.stringify(e))})};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.productOrderMenu={};var currentItem={},actualPrice=0,selectPrice=0,originalPrice=0;gmwa.controllers.productOrderMenu.init=function(){gmwa.components.header.init(),console.log("---------------- INICIANDO PRODUCT ORDER MENU"),currentItem.customFields=[],currentItem.quantity=1,actualPrice=parseFloat($("#price").val()),currentItem.price=actualPrice,currentItem.originalPrice=actualPrice,originalPrice=actualPrice,gmwa.controllers.storeSmall.initProductControls();var e=document.createElement("script");e.src="https://cdn.rawgit.com/igorlino/elevatezoom-plus/1.1.6/src/jquery.ez-plus.js",e.onload=function(){var e=document.createElement("script");e.src="/js/vendors/photoswipe/dist/photoswipe.min.js",e.onload=function(){var e=document.createElement("script");e.src="/js/vendors/photoswipe/dist/photoswipe-ui-default.min.js",e.onload=function(){gmwa.controllers.productOrderMenu.pswp=$(".pswp")[0],gmwa.controllers.productOrderMenu.pswpItems=[],$(".additional-image, #adImgGal img").each(function(){if("moreImages"!=$(this).attr("id")){var e=$(this).data("zoom-image"),o=$(this).data("size").split("x"),r=o[0],t=o[1],a={src:e,w:r,h:t};gmwa.controllers.productOrderMenu.pswpItems.push(a)}}),gmwa.utils.isMobile()?(gmwa.controllers.productOrderMenu.imagesSwiper=new Swiper("#adImgGal",{slidesPerView:1,paginationClickable:!1,spaceBetween:0,pagination:{el:"#adImgGalPag",type:"bullets"}}),gmwa.controllers.productOrderMenu.imagesSwiper=new Swiper("#relProds",{slidesPerView:1.3,paginationClickable:!1,spaceBetween:0,pagination:{el:"#relProdsPag",type:"bullets"}}),$("#adImgGal img").on("click",function(e){e.preventDefault();var o=parseInt($(this).data("index")),r={index:o,bgOpacity:.7,showHideOpacity:!0,shareEl:!1,fullscreenEl:!1,tapToClose:!0,preload:[0,0]},t=new PhotoSwipe(gmwa.controllers.productOrderMenu.pswp,PhotoSwipeUI_Default,gmwa.controllers.productOrderMenu.pswpItems,r);t.init()})):($(".additional-image").mouseover(function(){var e=$(this).attr("data-image");$("#principal-image").attr("src",e),$(".zoomContainer").remove(),$("#principal-image").removeData("ezPlus"),$("#principal-image").data("zoom-image",$(this).data("zoom-image"));var o=$(this).data("index");$("#principal-image").data("index",o),$("#principal-image").ezPlus({zoomType:"inner",cursor:"crosshair"})}),$("#principal-image").ezPlus({zoomType:"inner",cursor:"crosshair"}),$("#principal-image").on("click",function(e){e.preventDefault();var o=parseInt($("#principal-image").data("index")),r={index:o,bgOpacity:.7,showHideOpacity:!0,shareEl:!1,fullscreenEl:!1,tapToClose:!0,preload:[0,0]},t=new PhotoSwipe(gmwa.controllers.productOrderMenu.pswp,PhotoSwipeUI_Default,gmwa.controllers.productOrderMenu.pswpItems,r);t.init()}))},document.body.appendChild(e)},document.body.appendChild(e)},document.body.appendChild(e),$("#pdForm").submit(function(e){return gmwa.controllers.storeSmall.addProductCheckMandatories()?($("#lblError").html(""),$("#ay mama").prop("disabled",!0),$("#ompaModify").prop("disabled",!0),gmwa.utils.showProgress("Enviando","Agregando producto al carrito...",!0,!0),void 0):($("#lblError").html("<strong>Campos invalidos</strong> Ingrese todos los datos obligatorios"),void e.preventDefault())}),$("#pdForm input[type=radio]").on("change invalid",function(){var e=$(this).get(0);e.setCustomValidity(""),e.validity.valid||e.setCustomValidity("Porfavor seleccione una de estas opciones")})};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.quoteRequest={},gmwa.controllers.quoteRequest.videoDevices=[],gmwa.controllers.quoteRequest.videoDevicesIndex=0,gmwa.controllers.quoteRequest.stream=void 0,gmwa.controllers.quoteRequest.addStoresToggle=!1,gmwa.controllers.quoteRequest.init=function(){gmwa.components.header.init(),gmwa.services.worker.onInitializeState(function(e){gmwa.logger.log("onInitializeState | "+JSON.stringify(e)),e.isPushSupported?(gmwa.controllers.quoteRequest.isPushEnabled=e.isPushEnabled,e.isPushEnabled?($("#qrNotifyMe i").removeClass("fa-bell-slash-o"),$("#qrNotifyMe i").addClass("fa-bell-o"),$("#qrNotifyMeDesc").html('<span style="color: #4CAF50;">Recibiras notificaciones en este dispositivo</span>')):($("#qrNotifyMe i").removeClass("fa-bell-o"),$("#qrNotifyMe i").addClass("fa-bell-slash-o"),$("#qrNotifyMeDesc").html('<span style="color: #FF9800;">No recibiras notificaciones</span>'))):$("#qrNotifyMeCntr").hide()}),$("#qrNotifyMe").click(function(e){$("#qrNotifyMe").prop("disabled",!0),e.preventDefault(),gmwa.controllers.quoteRequest.isPushEnabled?gmwa.webpush.unsubscribe(function(e){0===e?($("#qrNotifyMe i").removeClass("fa-bell-o"),$("#qrNotifyMe i").addClass("fa-bell-slash-o"),gmwa.controllers.quoteRequest.isPushEnabled=!1,$("#qrNotifyMeDesc").html('<span style="color: #FF9800;">No recibiras notificaciones</span>')):-1==e&&gmwa.logger.error("Unubscribe returned "+e),$("#qrNotifyMe").prop("disabled",!1)}):gmwa.webpush.subscribe(function(e){0===e?($("#qrNotifyMe i").removeClass("fa-bell-slash-o"),$("#qrNotifyMe i").addClass("fa-bell-o"),$("#qrNotifyMeDesc").html('<span style="color: #4CAF50;">Recibiras notificaciones en este dispositivo</span>'),gmwa.controllers.quoteRequest.isPushEnabled=!0):-1==e?($("#qrNotifyMeError1").show(),$("#qrNotifyMe i").removeClass("fa-bell-o"),$("#qrNotifyMe i").addClass("fa-bell-slash-o"),gmwa.controllers.quoteRequest.isPushEnabled=!1):-2==e&&($("#qrNotifyMeError2").show(),$("#qrNotifyMe i").removeClass("fa-bell-o"),$("#qrNotifyMe i").addClass("fa-bell-slash-o"),gmwa.controllers.quoteRequest.isPushEnabled=!1),$("#qrNotifyMe").prop("disabled",!1)})}),$("#qrSubmit").click(function(e){e.preventDefault(),gmwa.controllers.quoteRequest.addImagesToForm();var o=gmwa.controllers.quoteRequest.validateForm();o.length>0?($("#errMsg").html(o),$("#errMsg").show()):($("#errMsg").hide(),gmwa.utils.showProgress("Enviando solicitud","Espere por favor...",!0,!0),grecaptcha.execute())}),gmwa.controllers.requestsList.initQuoteHandlers(),$("qBtnAccept").click(gmwa.controllers.requestsList.quoteAcceptClick),gmwa.controllers.requestsList.token=$("#req-info").data("token"),$("input[name=qrScheduleType]").change(function(){var e=$("input[name=qrScheduleType]:checked").val();4==e?$("#dpMonths").show():$("#dpMonths").hide()}),$("#qrevpriceval").change(function(){this.checked?($("#trpricevalwrong").hide(),$("#trwrongpriceexpensive").hide()):($("#trpricevalwrong").show(),$("#trwrongpriceexpensive").show())}),$("#qrevworkval").change(function(){this.checked?($("#trwrongworkbad").hide(),$("#trwrongworkslow").hide(),$("#trwrongworksloppy").hide()):($("#trwrongworkbad").show(),$("#trwrongworkslow").show(),$("#trwrongworksloppy").show())}),$("#photosAdd").click(function(e){$("#photoLoader").click()}),$("#photoLoader").change(function(e){var o=e.target.files[0],r=/image.*/;if(o.type.match(r)){var t=new FileReader;t.onload=function(e){var o=$("<img>",{src:e.target.result});o.load(function(){var e=gmwa.controllers.quoteRequest.buildCanvasElement(this.naturalWidth,this.naturalHeight),o=e.element.getContext("2d");o.drawImage(this,0,0,this.naturalWidth,this.naturalHeight),$("#canvas-"+e.id+" > i").click(function(e){$(this).parent().remove(),gmwa.controllers.quoteRequest.checkAddPhotoButton();
}),gmwa.controllers.quoteRequest.checkAddPhotoButton()})},t.readAsDataURL(o)}}),$(".u-option input").click(function(e){var o=$(this).prop("name");void 0==gmwa.controllers.quoteRequest[o]?gmwa.controllers.quoteRequest[o]=$(this).prop("value"):gmwa.controllers.quoteRequest[o]==$(this).prop("value")?($(this).prop("checked",!1),gmwa.controllers.quoteRequest[o]=void 0):gmwa.controllers.quoteRequest[o]=$(this).prop("value")}),gmwa.controllers.quoteRequest.initTakePhoto(),$("#changeUserLocation").on("click",function(e){e.preventDefault(),$("#qrLocation").val(""),$("#qrLocationCntrForm").show(),$("#qrLocationCntrLabel").hide(),$(this).hide()}),$("#changeUserData").on("click",function(e){e.preventDefault(),$("#qrUserName").val(""),$("#qrUserEmail").val(""),$("#qrUserTel").val(""),$("#qrUserDataForm").show(),$("#qrUserDataLabel").hide(),$(this).hide()}),$("#qrastoggle-all").on("click",function(e){$("#qras-cntr").find("input:checkbox").prop("checked",!gmwa.controllers.quoteRequest.addStoresToggle),gmwa.controllers.quoteRequest.addStoresToggle=!gmwa.controllers.quoteRequest.addStoresToggle,gmwa.controllers.quoteRequest.countAdditionalStores()}),$("#qras-cntr").find("input:checkbox").on("click",function(e){gmwa.controllers.quoteRequest.countAdditionalStores(),$(this).parent().hasClass("label-checked")?$(this).parent().removeClass("label-checked"):$(this).parent().addClass("label-checked")});var e=document.createElement("script");e.src="/js/vendors/foundation-datepicker/foundation-datepicker.min.js",e.onload=function(){$("#dpMonths").fdatepicker()},document.body.appendChild(e)};var quoteRequestSendRequest=function(e){console.log("reCaptcha user response :"),console.log(e),$("#qrForm").submit()};gmwa.controllers.quoteRequest.initTakePhoto=function(){navigator.mediaDevices&&($("#photosTake").show(),$("#photosTake").click(function(e){void 0===gmwa.controllers.quoteRequest.addPhotoPreview&&(gmwa.controllers.quoteRequest.addPhotoPreview=document.getElementById("addPhotoPreviewVideo")),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&gmwa.controllers.quoteRequest.addPhotoModal.foundation("open")}),$("body").append($('<div class="reveal u-reveal small" id="addPhotoModal" data-reveal style="background-color: #000;"><div class="u-reveal-body"><div class="u-quote-form-photoadd"><p>Asegurese de que la imagen salga clara y en foco</p><video id="addPhotoPreviewVideo" width="100%" height="auto" autoplay></video><div class="photoadd-btns-cntr"><button id="rotateCamera" class="button small" style="display:none"><i class="fa fa-retweet" aria-hidden="true"></i></button><button id="addPhotoSnap" class="button small right small-expanded"><i class="fa fa-camera" aria-hidden="true"></i></button><button id="closePhotoSnap" class="button small secondary small-expanded">Cancelar</button></div></div></div></div>')),gmwa.controllers.quoteRequest.addPhotoModal=$("#addPhotoModal"),gmwa.controllers.quoteRequest.addPhotoModal.foundation(),$(document).on("open.zf.reveal","#addPhotoModal[data-reveal]",function(){navigator.mediaDevices.enumerateDevices().then(function(e){for(var o=0;o!==e.length;++o){var r=e[o];"videoinput"===r.kind&&gmwa.controllers.quoteRequest.videoDevices.push(r.deviceId)}if(0===gmwa.controllers.quoteRequest.videoDevices.length)return void gmwa.logger.log("No video devices found!");gmwa.controllers.quoteRequest.videoDevices.length>1&&($("#rotateCamera").click(function(e){var o=gmwa.controllers.quoteRequest.videoDevicesIndex+1;o==gmwa.controllers.quoteRequest.videoDevices.length&&(o=0),gmwa.controllers.quoteRequest.videoDevicesIndex=o;var r={video:{deviceId:gmwa.controllers.quoteRequest.videoDevices[o]}};gmwa.logger.log("Using device at index "+o+" with deviceId "+r.video.deviceId),gmwa.controllers.quoteRequest.playTakePhoto(r)}),$("#rotateCamera").show()),gmwa.controllers.quoteRequest.videoDevicesIndex=gmwa.controllers.quoteRequest.videoDevices.length-1;var t={video:{deviceId:gmwa.controllers.quoteRequest.videoDevices[gmwa.controllers.quoteRequest.videoDevicesIndex]}};gmwa.controllers.quoteRequest.playTakePhoto(t)})["catch"](function(e){gmwa.logger.error("Could not enumerate devices: ",e)})}),$(document).on("closed.zf.reveal","#addPhotoModal[data-reveal]",function(){}),$("#closePhotoSnap").click(function(e){gmwa.controllers.quoteRequest.stopTakePhoto(),gmwa.controllers.quoteRequest.addPhotoModal.foundation("close")}),$("#addPhotoSnap").click(function(e){var o=gmwa.controllers.quoteRequest.buildCanvasElement(gmwa.controllers.quoteRequest.addPhotoPreview.videoWidth,gmwa.controllers.quoteRequest.addPhotoPreview.videoHeight),r=o.element.getContext("2d");r.drawImage(gmwa.controllers.quoteRequest.addPhotoPreview,0,0,gmwa.controllers.quoteRequest.addPhotoPreview.videoWidth,gmwa.controllers.quoteRequest.addPhotoPreview.videoHeight),$("#canvas-"+o.id+" > i").click(function(e){$(this).parent().remove(),gmwa.controllers.quoteRequest.checkAddPhotoButton()}),gmwa.controllers.quoteRequest.checkAddPhotoButton(),gmwa.controllers.quoteRequest.stopTakePhoto(),gmwa.controllers.quoteRequest.addPhotoModal.foundation("close")}))},gmwa.controllers.quoteRequest.playTakePhoto=function(e){gmwa.controllers.quoteRequest.stopTakePhoto(),gmwa.logger.log("Requesting stream at device "+e.video.deviceId+"..."),navigator.mediaDevices.getUserMedia(e).then(function(o){gmwa.controllers.quoteRequest.stream=o,gmwa.controllers.quoteRequest.addPhotoStream=o;try{gmwa.controllers.quoteRequest.addPhotoPreview.srcObject=o,gmwa.controllers.quoteRequest.addPhotoPreview.onloadedmetadata=function(o){gmwa.logger.log("Playing (1) stream at device "+e.video.deviceId+"."),gmwa.controllers.quoteRequest.addPhotoPreview.play()}}catch(r){gmwa.controllers.quoteRequest.addPhotoPreview.src=window.URL.createObjectURL(o),gmwa.logger.log("Playing (2) stream at device "+e.video.deviceId+"."),gmwa.controllers.quoteRequest.addPhotoPreview.play()}})},gmwa.controllers.quoteRequest.stopTakePhoto=function(){gmwa.controllers.quoteRequest.stream&&gmwa.controllers.quoteRequest.stream.getTracks().forEach(function(e){gmwa.logger.log("Stopping current stream"),e.stop()})},gmwa.controllers.quoteRequest.buildCanvasElement=function(e,o){var r=new Date,t=r.getHours()+"-"+r.getMinutes()+"-"+r.getSeconds();$("#photosList").prepend($('<div id="canvas-'+t+'" class="u-picture-cntr"><i class="fa fa-times" aria-hidden="true"></i><canvas width="'+e+'" height="'+o+'"></canvas></div>'));var a=$("#canvas-"+t+" > canvas").get(0);return{id:t,element:a}},gmwa.controllers.quoteRequest.checkAddPhotoButton=function(){var e=$("#photosList").children().length;0===e?($("#photosTake").text("Tomar con la cámara"),$("#photosTake").show(),$("#photosAdd").text("Cargar desde el dispositivo"),$("#photosAdd").show(),$("#photosMaxMsg").hide()):4>e?($("#photosAdd").text("Cargar otra"),$("#photosAdd").show(),$("#photosTake").text("Tomar otra"),$("#photosTake").show(),$("#photosMaxMsg").hide()):($("#photosTake").hide(),$("#photosAdd").hide(),$("#photosMaxMsg").show())},gmwa.controllers.quoteRequest.addImagesToForm=function(){var e=0;$(".u-picture-cntr canvas").each(function(o,r){gmwa.logger.log("Adding image "+e),$("<input>").attr({type:"hidden",id:"qImg-"+e,name:"qImg-"+e,value:r.toDataURL("image/jpeg",.92)}).appendTo("#qrForm"),e++}),$("<input>").attr({type:"hidden",id:"qImgTotal",name:"qImgTotal",value:e}).appendTo("#qrForm"),gmwa.logger.log("Added "+e+" images and total to form")},gmwa.controllers.quoteRequest.validateForm=function(){var e="";return 0===document.forms.qrForm.qrDesc.value.length&&(e="Ingresa una descripción de lo que necesitas."),0===document.forms.qrForm.qrScheduleType.value.length&&(e.length>0&&(e+="<br>"),e+="Ingresa para cuando lo necesitas."),document.forms.qrForm.qrUserEmail.value.length>0?document.forms.qrForm.qrUserEmail.validity.valid||(e.length>0&&(e+="<br>"),e+="Ingresa un correo electrónico válido."):0===document.forms.qrForm.qrUserEmail.value.length&&(e.length>0&&(e+="<br>"),e+="Ingresa un correo electrónico para que podamos enviarte la respuesta."),0===document.forms.qrForm.qrLocation.value.length&&(e.length>0&&(e+="<br>"),e+="Ingresa tu ubicación aproximada, calle, barrio o zona."),0===document.forms.qrForm.qrUserName.value.length&&(e.length>0&&(e+="<br>"),e+="Ingresa tu nombre."),document.forms.qrForm.qrUserTel.value.length>0&&(document.forms.qrForm.qrUserTel.validity.valid||(e.length>0&&(e+="<br>"),e+="Ingresa un número de teléfono válido.")),e},gmwa.controllers.quoteRequest.countAdditionalStores=function(){var e=0;$("#qras-cntr").find("input:checkbox").each(function(o){$(this).prop("checked")&&e++});var o=$("#qras-desc").data("store");0==e?$("#qras-desc").html("Enviaremos la solicitud solo a "+o):$("#qras-desc").html("Enviaremos la solicitud a "+o+" y a "+e+" más")};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.quoteView={},gmwa.controllers.quoteView.init=function(){gmwa.components.header.init(),$("#mi-reqs").addClass("u-tb-item-selected"),gmwa.controllers.requestsList.token=$("#req-info").data("token"),$(".btnAccept").each(function(e){$(this).click(gmwa.controllers.requestsList.quoteAcceptClick)}),$("#qrevForm").submit(gmwa.controllers.requestsList.quoteSendReviewClick),$("#qrevpriceval").change(function(){this.checked?($("#trpricevalwrong").hide(),$("#trwrongpriceexpensive").hide()):($("#trpricevalwrong").show(),$("#trwrongpriceexpensive").show())}),$("#qrevworkval").change(function(){this.checked?($("#trwrongworkbad").hide(),$("#trwrongworkslow").hide(),$("#trwrongworksloppy").hide()):($("#trwrongworkbad").show(),$("#trwrongworkslow").show(),$("#trwrongworksloppy").show())}),gmwa.controllers.quoteView.initQuoteHandlers()},gmwa.controllers.quoteView.initQuoteHandlers=function(){$("body").append($('<div class="tiny reveal u-reveal" id="cqvm" data-reveal data-animation-in="fade-in" data-animation-out="fade-out" data-close-on-click="false" data-close-on-esc="false"><div class="u-reveal-body"></div><div class="u-reveal-footer"><button id="cqvmAccept" type="button" class="success button">Aceptar</button><button id="cqvmClose" type="button" class="alert button">Cancelar</button></div></div>')),gmwa.controllers.requestsList.confirmModal=$("#cqvm"),gmwa.controllers.requestsList.confirmModal.foundation(),$("body").append($('<div class="small reveal u-reveal" id="fcqvm" data-reveal data-animation-in="fade-in" data-animation-out="fade-out" data-close-on-click="false" data-close-on-esc="false"><div class="u-reveal-body"></div><div class="u-reveal-footer"><button id="fcqvmClose" type="button" class="button">Aceptar</button></div></div>')),gmwa.controllers.requestsList.finalModal=$("#fcqvm"),gmwa.controllers.requestsList.finalModal.foundation(),$("#qvmClose").click(function(e){gmwa.controllers.requestsList.orderViewModal.foundation("close")})};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.requestsList={},gmwa.controllers.requestsList.init=function(){gmwa.components.header.init(),$("#mi-reqs").addClass("u-tb-item-selected"),gmwa.controllers.requestsList.initQuoteHandlers(),$(".u-req-bottom-btns-link").click(function(e){e.preventDefault(),gmwa.controllers.requestsList.token=$(this).data("token");var o="/components/pedidos/presupuesto/"+$(this).data("token");$.ajax(o).done(function(e){$("#qvm .u-reveal-body").html(e),$(".btnAccept").each(function(e){$(this).click(gmwa.controllers.requestsList.quoteAcceptClick)}),$("#qrevForm").submit(gmwa.controllers.requestsList.quoteSendReviewClick),$("#qrevpriceval").change(function(){this.checked?($("#trpricevalwrong").hide(),$("#trwrongpriceexpensive").hide()):($("#trpricevalwrong").show(),$("#trwrongpriceexpensive").show())}),$("#qrevworkval").change(function(){this.checked?($("#trwrongworkbad").hide(),$("#trwrongworkslow").hide(),$("#trwrongworksloppy").hide()):($("#trwrongworkbad").show(),$("#trwrongworkslow").show(),$("#trwrongworksloppy").show())}),gmwa.controllers.requestsList.orderViewModal.foundation("open")})})},gmwa.controllers.requestsList.initQuoteHandlers=function(){$("body").append($('<div class="tiny reveal u-reveal" id="cqvm" data-reveal data-animation-in="fade-in" data-animation-out="fade-out" data-close-on-click="false" data-close-on-esc="false"><div class="u-reveal-body"></div><div class="u-reveal-footer"><button id="cqvmAccept" type="button" class="success button">Aceptar</button><button id="cqvmClose" type="button" class="alert button gmbutton">Cancelar</button></div></div>')),gmwa.controllers.requestsList.confirmModal=$("#cqvm"),gmwa.controllers.requestsList.confirmModal.foundation(),$("body").append($('<div class="reveal u-reveal" id="qvm" data-reveal data-animation-in="fade-in" data-animation-out="fade-out"><div class="u-reveal-body"></div><div class="u-reveal-footer"><button id="qvmClose" type="button" class="button gmbutton">Cerrar</button></div></div>')),gmwa.controllers.requestsList.orderViewModal=$("#qvm"),gmwa.controllers.requestsList.orderViewModal.foundation(),$("body").append($('<div class="small reveal u-reveal" id="fcqvm" data-reveal data-animation-in="fade-in" data-animation-out="fade-out" data-close-on-click="false" data-close-on-esc="false"><div class="u-reveal-body"></div><div class="u-reveal-footer"><button id="fcqvmClose" type="button" class="button gmbutton">Aceptar</button></div></div>')),gmwa.controllers.requestsList.finalModal=$("#fcqvm"),gmwa.controllers.requestsList.finalModal.foundation(),$("#qvmClose").click(function(e){gmwa.controllers.requestsList.orderViewModal.foundation("close")})},gmwa.controllers.requestsList.quoteAcceptClick=function(e){gmwa.controllers.requestsList.retailerName=$(this).data("name"),gmwa.controllers.requestsList.respId=$(this).data("id");var o='<div style="width: 100%;text-align: center;padding: 20px 0px;"><i class="fa fa-handshake-o" aria-hidden="true" style="font-size: 50px;color: #FFC107;"></i></div><div style="text-align: center;font-size: 16px;line-height: 19px;font-weight: 600;">Confirma que acepta el presupuesto enviado por '+gmwa.controllers.requestsList.retailerName+'?</div><div style="font-size: 80%;line-height: 110%;text-align: center;padding: 20px 10px;color: #777;"><i class="fa fa-info-circle" aria-hidden="true"></i> Una vez aceptado el presupuesto, le enviaremos una notificacion a '+gmwa.controllers.requestsList.retailerName+" quien se pondra en contacto con usted para afinar los detalles necesarios.</div>";$("#cqvm .u-reveal-body").html(o),$("#cqvmClose").click(gmwa.controllers.requestsList.quoteAcceptConfirmCancelClick),$("#cqvmAccept").click(gmwa.controllers.requestsList.quoteAcceptConfirmOKClick),gmwa.controllers.requestsList.confirmModal.foundation("open")},gmwa.controllers.requestsList.quoteAcceptConfirmCancelClick=function(e){gmwa.controllers.requestsList.confirmModal.foundation("close")},gmwa.controllers.requestsList.quoteAcceptConfirmOKClick=function(e){gmwa.controllers.requestsList.confirmModal.foundation("close"),gmwa.utils.showProgress("Enviando confirmación","Por favor espere...",!0,!1);var o="/components/presupuesto/ac/"+gmwa.controllers.requestsList.token+"/"+gmwa.controllers.requestsList.respId;$.ajax(o).done(function(e){gmwa.utils.hideProgress(),$("#fcqvm .u-reveal-body").html(e),$("#fcqvmClose").click(function(e){gmwa.controllers.requestsList.finalModal.foundation("close"),document.location.href="/pedidos"}),gmwa.controllers.requestsList.finalModal.foundation("open")}).fail(function(e){gmwa.utils.hideProgress(),gmwa.utils.showError("No se pudo enviar la confirmación","Ocurrio un problema al enviar la confirmación, por favor inténtelo más tarde."),gmwa.logger.error("DoQuoteAccept | API returned error: "+JSON.stringify(e))})},gmwa.controllers.requestsList.quoteSendReviewClick=function(e){e.preventDefault();var o={token:$("#qrevToken").val(),text:$("#qrevDesc").val(),workVal:$("#qrevworkval").is(":checked")?1:0,priceVal:$("#qrevpriceval").is(":checked")?1:0,wrongWorkBad:$("#qrevwrongworkbad").is(":checked")?1:0,wrongWorkSlow:$("#qrevwrongworkslow").is(":checked")?1:0,wrongWorkSloppy:$("#qrevwrongworksloppy").is(":checked")?1:0,wrongPriceExpensive:$("#qrevwrongpriceexpensive").is(":checked")?1:0};gmwa.utils.showProgress("Enviando reseña","Por favor espere...",!0,!1);var r="/presupuesto/review";$.ajax({type:"POST",url:r,data:JSON.stringify(o),contentType:"application/json"}).done(function(e){gmwa.utils.hideProgress(),void 0===gmwa.controllers.requestsList.reviewDoneModal&&($("body").append($('<div class="tiny reveal u-reveal" id="cqrd" data-reveal data-animation-in="fade-in" data-animation-out="fade-out" data-close-on-click="false" data-close-on-esc="false"><div class="u-reveal-body"></div><div class="u-reveal-footer"><button id="cqrdClose" type="button" class="alert button">Cerrar</button></div></div>')),gmwa.controllers.requestsList.reviewDoneModal=$("#cqrd"),gmwa.controllers.requestsList.reviewDoneModal.foundation()),$("#cqrd .u-reveal-body").html(e),$("#cqrdClose").click(function(e){gmwa.controllers.requestsList.reviewDoneModal.foundation("close"),document.location.href="/pedidos"}),gmwa.controllers.requestsList.reviewDoneModal.foundation("open")}).fail(function(e){gmwa.utils.hideProgress(),gmwa.utils.showError("No se pudo enviar la reseña","Ocurrio un problema al enviar la reseña, por favor inténtelo más tarde."),gmwa.logger.error("DoQuoteReview | API returned error: "+JSON.stringify(e))})};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.store={},gmwa.controllers.store.init=function(){var e=$("#retInfoCntr").data("stype");"1"==e?gmwa.controllers.storeBig.init():gmwa.controllers.storeSmall.init()};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.storeBig={},gmwa.controllers.storeBig.mobileCarritoOpened=!1,gmwa.controllers.storeBig.mobileCarritoQty=null,gmwa.controllers.storeBig.mobileCarritoViewBtn=null,gmwa.controllers.storeBig.hoursOpened=!1,gmwa.controllers.storeBig.sectionsOpened=!1,gmwa.controllers.storeBig.colors=["#fc8c69","#006fed","#379300","#d300cf","#d1a504","#750072","#01a4a8","#b32e00","#4db8cd","#de95b9"];var pList={};pList.plist=[];var currentItem={},idSelect=0,carrito=null,productName="",actualPrice=0,selectPrice=0,originalPrice=0,aux=-1,city="Montevideo",address1="",country="Uruguay";gmwa.controllers.storeBig.init=function(){var e=gmwa.utils.isMobile();if(gmwa.logger.log("storeBig|Init..."),gmwa.components.header.init(),currentItem.customFields=[],currentItem.quantity=$("#quantityItem").val(),$("body").append($('<div class="reveal u-reveal small" id="addProduct" data-reveal><div class="u-reveal-body"></div></div>')),gmwa.controllers.storeBig.addProductModal=$("#addProduct"),gmwa.controllers.storeBig.addProductModal.foundation(),$("#closeButton").click(function(e){gmwa.controllers.storeBig.addProductModal.foundation("close")}),$(".u-menu-item").click(function(e){e.preventDefault(),gmwa.utils.showProgress("","",!1,!1),productName=$(this).attr("data-name");var o="/pedido/producto/"+$(this).data("id")+"/1";$.ajax(o).done(function(e){$("#addProduct .u-reveal-body").html(e),gmwa.controllers.storeBig.addProductOpened(-1),gmwa.controllers.storeBig.addProductModal.foundation("open"),gmwa.utils.hideProgress()})}),$("#buttonCheckout, #lnkCheckout").click(function(e){e.preventDefault(),gmwa.controllers.storeBig.goToCheckout()}),$("#bottomCartView").click(function(e){gmwa.controllers.storeBig.mobileCarritoOpened?($("#carritoCntr").hide(),gmwa.controllers.storeBig.mobileCarritoViewBtn.text("PEDIDO")):($("#carritoCntr").show(),gmwa.controllers.storeBig.mobileCarritoViewBtn.text("CERRAR")),gmwa.controllers.storeBig.mobileCarritoOpened=!gmwa.controllers.storeBig.mobileCarritoOpened}),$("#bottomCartClose").click(function(e){$("#carritoCntr").hide(),gmwa.controllers.storeBig.mobileCarritoViewBtn.text("PEDIDO"),gmwa.controllers.storeBig.mobileCarritoOpened=!1}),gmwa.controllers.storeBig.mobileCarritoViewBtn=$("#bottomCartView > :nth-child(2)"),gmwa.controllers.storeBig.mobileCarritoQty=$("#bottomCartView > :nth-child(3)"),$("#btnprodgroups").click(function(e){gmwa.controllers.storeBig.sectionsOpened?$("#prodgroups").hide():$("#prodgroups").show(),gmwa.controllers.storeBig.sectionsOpened=!gmwa.controllers.storeBig.sectionsOpened}),$("#prodgroups ul li").click(function(e){Foundation.MediaQuery.is("small only")&&($("#prodgroups").hide(),gmwa.controllers.storeBig.sectionsOpened=!1)}),$("#hourToday").click(function(e){gmwa.controllers.storeBig.hoursOpened?$("#restHours").hide():$("#restHours").show(),gmwa.controllers.storeBig.hoursOpened=!gmwa.controllers.storeBig.hoursOpened}),null!=window.loadCarrito&&(carrito=window.loadCarrito),$("#openCoverage").click(function(e){if(e.preventDefault(),void 0===window.coverageData){gmwa.controllers.storeBig.viewCoverageModal=$("#viewCoverage");var o=$("#retInfoCntr").data("idr"),r=$("#retInfoCntr").data("ids"),t="/pedidos/listDeliveryCoverage/"+o+"/"+r;gmwa.utils.showProgress("","",!1,!1),$.ajax(t).done(function(e){gmwa.utils.hideProgress(),window.coverageData=e,gmwa.controllers.storeBig.viewCoverageModal.foundation("open"),setTimeout(function(){window.coverageData.storeLat=parseFloat(window.coverageData.storeLat),window.coverageData.storeLng=parseFloat(window.coverageData.storeLng);var e=!1;if(window.coverageData.zones.length>0?(0==gmwa.mapsFW?gmwa.controllers.storeBig.loadCoverageGMap():gmwa.controllers.storeBig.loadCoverageLMap(),e=!0):($("#btnShowUrban").hide(),$("#covUrban").hide()),window.coverageData.states.length>0){for(var o="<ul>",r=0;r<window.coverageData.states.length;r++)o+="<li>"+window.coverageData.states[r].name+"</li>";o+="</ul>",$("#covNational > div").html(o),e||$("#covNational").show()}else $("#btnShowNational").hide(),$("#covNational").hide()},400)}).fail(function(e){gmwa.utils.hideProgress(),gmwa.logger.error("listDeliveryCoverage | API returned error: "+JSON.stringify(e))})}else gmwa.controllers.storeBig.viewCoverageModal.foundation("open")}),$("#btnShowUrban").click(function(){$("#btnShowUrban").css("font-weight","600"),$("#btnShowNational").css("font-weight","100"),$("#covUrban").show(),$("#covNational").hide()}),$("#btnShowNational").click(function(){$("#btnShowUrban").css("font-weight","100"),$("#btnShowNational").css("font-weight","600"),$("#covUrban").hide(),$("#covNational").show()}),e){new Swiper("#swipHighlights",{slidesPerView:1.3,paginationClickable:!1,navigation:{nextEl:"#next-sw-nearprms",prevEl:"#prev-sw-nearprms"},spaceBetween:10})}else{new Swiper("#swipHighlights",{slidesPerView:2.3,paginationClickable:!1,navigation:{nextEl:"#next-sw-nearprms",prevEl:"#prev-sw-nearprms"},spaceBetween:10})}},gmwa.controllers.storeBig.loadCoverageLMap=function(){gmwa.logger.log("Initializing Maps...");var e=$("#coverageMap"),o=16,r=e.data("im"),t=window.coverageData.storeLat,a=window.coverageData.storeLng;gmwa.components.maps.instance.initMapAsync("coverageMap",t,a,o,r,function(e){gmwa.controllers.storeBig.map=e,gmwa.controllers.reportarError.marker=gmwa.components.maps.instance.addMarkerSimple(gmwa.controllers.storeBig.map,t,a);for(var o=window.coverageData.zones.length,r=[],n="",l="",i=0;o>i;i++){var s=L.polygon(window.coverageData.zones[i].polygon,{color:gmwa.controllers.storeBig.colors[i],weight:1});s.addTo(gmwa.controllers.storeBig.map),l=0==window.coverageData.zones[i].amount?"sin costo":"$U "+window.coverageData.zones[i].amount,n+='<div style="background-color:'+gmwa.controllers.storeBig.colors[i]+';width:15px;height:15px;display:inline-block;margin: -2px 4px -2px 10px;border-radius: 50%;"></div><div style="display:inline-block">'+window.coverageData.zones[i].name+" ("+l+")</div>",r=r.concat(window.coverageData.zones[i].polygon)}gmwa.controllers.storeBig.map.fitBounds(r),$("#coverageZonesDesc").html(n)})},gmwa.controllers.storeBig.loadCoverageGMap=function(){covMap=new google.maps.Map(document.getElementById("coverageMap"),{center:{lat:window.coverageData.storeLat,lng:window.coverageData.storeLng},styles:[{elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"geometry.fill",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"geometry.stroke",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#0080ff"},{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.stroke",stylers:[{visibility:"on"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"transit",stylers:[{visibility:"off"}]}]}),google.maps.event.addListenerOnce(covMap,"idle",function(){for(var e=(new google.maps.Marker({map:covMap,position:{lat:window.coverageData.storeLat,lng:window.coverageData.storeLng}}),new google.maps.LatLngBounds),o="",r="",t=window.coverageData.zones.length,a=0;t>a;a++){polygon=new google.maps.Polygon({paths:window.coverageData.zones[a].polygon,strokeColor:gmwa.controllers.storeBig.colors[a],strokeWeight:.5,fillColor:gmwa.controllers.storeBig.colors[a],fillOpacity:.35}),polygon.zonaIndex=a,polygon.setMap(covMap);for(var n=0;n<window.coverageData.zones[a].polygon.length;n++)e.extend(window.coverageData.zones[a].polygon[n]);r=0==window.coverageData.zones[a].amount?"sin costo":"$U "+window.coverageData.zones[a].amount,o+='<div style="background-color:'+gmwa.controllers.storeBig.colors[a]+';width:15px;height:15px;display:inline-block;margin: -2px 4px -2px 10px;border-radius: 50%;"></div><div style="display:inline-block">'+window.coverageData.zones[a].name+" ("+r+")</div>"}covMap.fitBounds(e),$("#coverageZonesDesc").html(o)})},gmwa.controllers.storeBig.calculateItemPrice=function(e){for(var o=e.originalPrice,r=0;r<e.customFields.length;r++)o+=e.customFields[r].price;return console.log("---------------------------------- EL QUANTITY ES"),console.log($("#quantityItem").val()),o*=$("#quantityItem").val()},gmwa.controllers.storeBig.getMainIDs=function(){var e=document.location.href,o=e.split("/"),r={};if(6===o.length)r.idr=o[o.length-4],r.ids=o[o.length-3],r.token=null;else if(7===o.length){r.idr=o[o.length-5],r.ids=o[o.length-4];var t=o[o.length-1],a=t.split("#");r.token=a[0]}return r};var gmwa=gmwa||{};gmwa.controllers=gmwa.controllers||{},gmwa.controllers.storeSmall={},gmwa.controllers.storeSmall.mobileCarritoOpened=!1,gmwa.controllers.storeSmall.mobileCarritoQty=null,gmwa.controllers.storeSmall.mobileCarritoViewBtn=null,gmwa.controllers.storeSmall.hoursOpened=!1,gmwa.controllers.storeSmall.sectionsOpened=!1,gmwa.controllers.storeSmall.colors=["#fc8c69","#006fed","#379300","#d300cf","#d1a504","#750072","#01a4a8","#b32e00","#4db8cd","#de95b9"];var pList={};pList.plist=[];var currentItem={},idSelect=0,carrito=null,productName="",actualPrice=0,selectPrice=0,originalPrice=0,aux=-1,city="Montevideo",address1="",country="Uruguay";gmwa.controllers.storeSmall.init=function(){gmwa.logger.log("storeSmall|Init..."),gmwa.components.header.init(),currentItem.customFields=[],$("body").append($('<div class="reveal u-reveal small" id="addProduct" data-reveal data-v-offset="0" style="padding: 0px;max-width:600px;top:20px"><div class="u-reveal-body"></div></div>')),gmwa.controllers.storeSmall.addProductModal=$("#addProduct"),gmwa.controllers.storeSmall.addProductModal.foundation(),gmwa.controllers.storeSmall.addProductModal.on("closeme.zf.reveal",function(){gmwa.controllers.storeSmall.modalOpen||(gmwa.controllers.storeSmall.scrollPosition=$(document).scrollTop())}),gmwa.controllers.storeSmall.addProductModal.on("open.zf.reveal",function(){gmwa.controllers.storeSmall.modalOpen=!0}),gmwa.controllers.storeSmall.addProductModal.on("closed.zf.reveal",function(){$(document).scrollTop(gmwa.controllers.storeSmall.scrollPosition),gmwa.controllers.storeSmall.modalOpen=!1}),$("[data-reveal]").on("closed.zf.reveal",function(){"addProduct"==$(this).attr("id")&&($("#adImgGal").each(function(){this.swiper&&this.swiper.destroy()}),$("#adImgGal").remove())}),$("#closeButton").click(function(e){gmwa.controllers.storeSmall.addProductModal.foundation("close")}),$(".u-menu-item, .u-prod-card > a").click(function(e){e.preventDefault(),gmwa.utils.showProgress("","",!1,!1),productName=$(this).attr("data-name"),token=$("#carritoCntr").data("token"),0==token.length&&(token="-");var o="/pd/component/"+$(this).data("id")+"/"+$(this).attr("data-ids")+"/"+$(this).attr("data-ids")+"/"+token+"/0/1";$.ajax(o).done(function(e){$("#addProduct .u-reveal-body").html(e),gmwa.controllers.storeSmall.addProductOpened(-1),gmwa.controllers.storeSmall.addProductModal.foundation("open"),gmwa.utils.hideProgress()})}),$("#buttonCheckout, #lnkCheckout").click(function(e){gmwa.controllers.storeSmall.goToCheckout()||e.preventDefault()}),$("#bottomCartView").click(function(e){gmwa.controllers.storeSmall.mobileCarritoOpened?($("#carritoCntr").hide(),gmwa.controllers.storeSmall.mobileCarritoViewBtn.text("PEDIDO")):($("#carritoCntr").show(),gmwa.controllers.storeSmall.mobileCarritoViewBtn.text("CERRAR")),gmwa.controllers.storeSmall.mobileCarritoOpened=!gmwa.controllers.storeSmall.mobileCarritoOpened}),$("#bottomCartClose").click(function(e){$("#carritoCntr").hide(),gmwa.controllers.storeSmall.mobileCarritoViewBtn.text("PEDIDO"),gmwa.controllers.storeSmall.mobileCarritoOpened=!1}),gmwa.controllers.storeSmall.mobileCarritoViewBtn=$("#bottomCartView > :nth-child(2)"),gmwa.controllers.storeSmall.mobileCarritoQty=$("#bottomCartView > :nth-child(3)"),$("#btnprodgroups").click(function(e){gmwa.controllers.storeSmall.sectionsOpened?$("#prodgroups").hide():$("#prodgroups").show(),gmwa.controllers.storeSmall.sectionsOpened=!gmwa.controllers.storeSmall.sectionsOpened}),$("#prodgroups ul li").click(function(e){Foundation.MediaQuery.is("small only")&&($("#prodgroups").hide(),gmwa.controllers.storeSmall.sectionsOpened=!1)}),$("#hourToday").click(function(e){gmwa.controllers.storeSmall.hoursOpened?$("#restHours").hide():$("#restHours").show(),gmwa.controllers.storeSmall.hoursOpened=!gmwa.controllers.storeSmall.hoursOpened}),null!=window.loadCarrito&&(carrito=window.loadCarrito,gmwa.controllers.storeSmall.cartDraw()),$("#openCoverage").click(function(e){if(e.preventDefault(),void 0===window.coverageData){gmwa.controllers.storeSmall.viewCoverageModal=$("#viewCoverage");var o=$("#retInfoCntr").data("idr"),r=$("#retInfoCntr").data("ids"),t="/pedidos/listDeliveryCoverage/"+o+"/"+r;gmwa.utils.showProgress("","",!1,!1),$.ajax(t).done(function(e){gmwa.utils.hideProgress(),window.coverageData=e,gmwa.controllers.storeSmall.viewCoverageModal.foundation("open"),setTimeout(function(){window.coverageData.storeLat=parseFloat(window.coverageData.storeLat),window.coverageData.storeLng=parseFloat(window.coverageData.storeLng);var e=!1;if(window.coverageData.zones.length>0?(0==gmwa.mapsFW?gmwa.controllers.storeSmall.loadCoverageGMap():gmwa.controllers.storeSmall.loadCoverageLMap(),e=!0):($("#btnShowUrban").hide(),$("#covUrban").hide()),window.coverageData.states.length>0){for(var o="<ul>",r=0;r<window.coverageData.states.length;r++)o+="<li>"+window.coverageData.states[r].name+"<span> ( $U "+window.coverageData.states[r].amount+")</span></li>";o+="</ul>",$("#covNational > div").html(o),e||$("#covNational").show()}else $("#btnShowNational").hide(),$("#covNational").hide()},400)}).fail(function(e){gmwa.utils.hideProgress(),gmwa.logger.error("listDeliveryCoverage | API returned error: "+JSON.stringify(e))})}else gmwa.controllers.storeSmall.viewCoverageModal.foundation("open");
}),$("#btnShowUrban").click(function(){$("#btnShowUrban").css("font-weight","600"),$("#btnShowNational").css("font-weight","100"),$("#covUrban").show(),$("#covNational").hide()}),$("#btnShowNational").click(function(){$("#btnShowUrban").css("font-weight","100"),$("#btnShowNational").css("font-weight","600"),$("#covUrban").hide(),$("#covNational").show()}),currentItem.customFields=[],currentItem.quantity=$("#quantityItem").val(),currentItem.price=actualPrice,currentItem.originalPrice=actualPrice,originalPrice=actualPrice;new Swiper("#swipHighlights",{slidesPerView:1.3,paginationClickable:!1,navigation:{nextEl:"#next-sw-nearprms",prevEl:"#prev-sw-nearprms"},spaceBetween:10});if(gmwa.utils.isMobile()){var e=$("#carritoCntr").detach();$(document.body).append(e)}},gmwa.controllers.storeSmall.loadCoverageLMap=function(){gmwa.logger.log("Initializing LMaps...");var e=$("#coverageMap"),o=16,r=e.data("im"),t=null,a=null,n=!1;isNaN(window.coverageData.storeLat)?(t=window.coverageData.zones[0].polygon[0].lat,a=window.coverageData.zones[0].polygon[0].lng):(t=window.coverageData.storeLat,a=window.coverageData.storeLng,n=!0),gmwa.components.maps.instance.initMapAsync("coverageMap",t,a,o,r,function(e){gmwa.controllers.storeSmall.map=e,n&&(gmwa.controllers.reportarError.marker=gmwa.components.maps.instance.addMarkerSimple(gmwa.controllers.storeSmall.map,t,a));for(var o=window.coverageData.zones.length,r=[],l="",i="",s=0;o>s;s++){var c=L.polygon(window.coverageData.zones[s].polygon,{color:gmwa.controllers.storeSmall.colors[s],weight:1});c.addTo(gmwa.controllers.storeSmall.map),i=0==window.coverageData.zones[s].amount?"sin costo":"$U "+window.coverageData.zones[s].amount,l+='<div style="background-color:'+gmwa.controllers.storeSmall.colors[s]+';width:15px;height:15px;display:inline-block;margin: -2px 4px -2px 10px;border-radius: 50%;"></div><div style="display:inline-block">'+window.coverageData.zones[s].name+" ("+i+")</div>",r=r.concat(window.coverageData.zones[s].polygon)}gmwa.controllers.storeSmall.map.fitBounds(r),$("#coverageZonesDesc").html(l)})},gmwa.controllers.storeSmall.loadCoverageGMap=function(){covMap=new google.maps.Map(document.getElementById("coverageMap"),{center:{lat:window.coverageData.storeLat,lng:window.coverageData.storeLng},styles:[{elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"geometry.fill",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"geometry.stroke",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#0080ff"},{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.stroke",stylers:[{visibility:"on"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"transit",stylers:[{visibility:"off"}]}]}),google.maps.event.addListenerOnce(covMap,"idle",function(){for(var e=(new google.maps.Marker({map:covMap,position:{lat:window.coverageData.storeLat,lng:window.coverageData.storeLng}}),new google.maps.LatLngBounds),o="",r="",t=window.coverageData.zones.length,a=0;t>a;a++){polygon=new google.maps.Polygon({paths:window.coverageData.zones[a].polygon,strokeColor:gmwa.controllers.storeSmall.colors[a],strokeWeight:.5,fillColor:gmwa.controllers.storeSmall.colors[a],fillOpacity:.35}),polygon.zonaIndex=a,polygon.setMap(covMap);for(var n=0;n<window.coverageData.zones[a].polygon.length;n++)e.extend(window.coverageData.zones[a].polygon[n]);r=0==window.coverageData.zones[a].amount?"sin costo":"$U "+window.coverageData.zones[a].amount,o+='<div style="background-color:'+gmwa.controllers.storeSmall.colors[a]+';width:15px;height:15px;display:inline-block;margin: -2px 4px -2px 10px;border-radius: 50%;"></div><div style="display:inline-block">'+window.coverageData.zones[a].name+" ("+r+")</div>"}covMap.fitBounds(e),$("#coverageZonesDesc").html(o)})},gmwa.controllers.storeSmall.initProductControls=function(){if(null!=window.loadCustomFields){var e=window.loadCustomFields;currentItem.customFields=e.data.customFields}var o=[];$(".u-menu-option option[data-variant=1]").each(function(){var e=$(this).data("id"),r=$(this).data("val");o.push({cfId:e,cfOpId:r})}),$(".u-menu-option input[data-variant=1]").each(function(){var e=$(this).data("id"),r=$(this).data("val");o.push({cfId:e,cfOpId:r})}),currentItem.quantity=$("#quantityItem").val(),$("#ompaQtyMinus").click(function(){currentItem.quantity>1&&(currentItem.quantity--,$("#ompaQtyNumber").html(currentItem.quantity),$("#quantityItem").val(currentItem.quantity),currentItem.price=gmwa.controllers.storeSmall.calculateItemPrice(currentItem),$("#priceCustom").html(gmwa.utils.formatNumberHTML(currentItem.price)))}),$("#ompaQtyPlus").click(function(){currentItem.quantity<20&&(currentItem.quantity++,$("#ompaQtyNumber").html(currentItem.quantity),$("#quantityItem").val(currentItem.quantity),currentItem.price=gmwa.controllers.storeSmall.calculateItemPrice(currentItem),$("#priceCustom").html(gmwa.utils.formatNumberHTML(currentItem.price)))}),$(".custom-list").change(function(){var e={},o=$("option:selected",this),r=$(this).data("variant");if(e.id=parseInt(o.attr("data-id")),e.type=2,e.val=parseInt(o.attr("data-val")),e.name=o.data("name"),e.optName=o.data("label"),e.price=parseInt(o.attr("data-extra")),"null"!=$(this).val()){for(var t=0;t<currentItem.customFields.length;t++)if(currentItem.customFields[t].id==e.id){currentItem.customFields.splice(t,1);break}currentItem.customFields.push(e),currentItem.price=gmwa.controllers.storeSmall.calculateItemPrice(currentItem),$("#priceCustom").html(gmwa.utils.formatNumberHTML(currentItem.price))}else{for(var t=0;t<currentItem.customFields.length;t++)if(currentItem.customFields[t].id==e.id){currentItem.customFields.splice(t,1);break}currentItem.price=gmwa.controllers.storeSmall.calculateItemPrice(currentItem),$("#priceCustom").html(gmwa.utils.formatNumberHTML(currentItem.price))}if(1==r){var a=(e.id,e.val),n=$(this).find("option[data-val="+a+"]");(n.data("unavailable")||0==a)&&($(".u-menu-option input[data-variant=1]").each(function(){$(this).parent().removeClass("notavailable"),$(this).prop("checked",!1)}),$(".u-menu-option select[data-variant=1] option").each(function(){var e=$(this).data("label"),o=$(this).data("val"),r=Number($(this).data("extraselect"));0!=o&&($(this).text(e),r>0&&$(this).append(" + $"+r))}));var l={};l.pInstId=$("#datos").data("id");o.data("unavailable");l.pairs=[],l.clickedPair={},l.clickedPair.cfId=e.id,l.clickedPair.cfOpId=e.val,l.pairs.push(l.clickedPair);for(var t=0;t<currentItem.customFields.length;t++)if(1==currentItem.customFields[t].variant){var i={};i.cfId=currentItem.customFields[t].id,i.cfOpId=currentItem.customFields[t].val,l.pairs.push(i)}var s="/pd/variant";gmwa.utils.showProgress("","",!1,!1),$.ajax({type:"POST",url:s,data:JSON.stringify(l),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){$(".u-menu-option input[data-variant=1]").each(function(){var e=$(this).data("id");l.clickedPair.cfId!=e&&($(this).parent().addClass("notavailable"),$(this).attr("data-unavailable",!0))}),$(".u-menu-option select[data-variant=1] option").each(function(){var e=$(this).text(),o=$(this).data("id"),r=$(this).data("val");(l.clickedPair.cfId!=o||l.clickedPair.cfOpId!=r)&&(e.includes("[NO DISPONIBLE]")||$(this).text(e+" [NO DISPONIBLE]"),$(this).attr("data-unavailable",!0))}),e.data.pairs.forEach(function(e){$("#cf-"+e.cfId+"-"+e.cfOpId).parent().removeClass("notavailable"),cleanLabel=$(".u-menu-option select[data-variant=1] option[data-val="+e.cfOpId+"]").text().replace("[NO DISPONIBLE]",""),$(".u-menu-option select[data-variant=1] option[data-val="+e.cfOpId+"]").text(cleanLabel),$(".u-menu-option select[data-variant=1] option[data-val="+e.cfOpId+"]").attr("data-unavailable",!1)}),gmwa.utils.hideProgress()}).fail(function(e){gmwa.utils.hideProgress(),gmwa.logger.error("Product variant | API returned error: "+JSON.stringify(e))})}}),$(".custom-check").change(function(){var e=$(this).prop("checked"),o=parseInt($(this).attr("data-extra")),r={};if(r.id=parseInt($(this).attr("data-id")),r.type=1,r.name=$(this).data("label"),r.price=o,e)currentItem.customFields.push(r);else for(var t=0;t<currentItem.customFields.length;t++)currentItem.customFields[t].id==r.id&&currentItem.customFields.splice(t,1);currentItem.price=gmwa.controllers.storeSmall.calculateItemPrice(currentItem),$("#priceCustom").html(gmwa.utils.formatNumberHTML(currentItem.price))}),$(".custom-radio").change(function(){var e={},o=$(this);e.id=parseInt(o.attr("data-id")),e.type=2;var r=o.data("variant");if(e.val=parseInt(o.attr("data-val")),e.name=o.data("name"),e.optName=o.data("label"),e.price=parseFloat($(this).attr("data-extra")),"null"!=$(this).val()){for(var t=0;t<currentItem.customFields.length;t++)if(currentItem.customFields[t].id==e.id){currentItem.customFields.splice(t,1);break}currentItem.customFields.push(e),currentItem.price=gmwa.controllers.storeSmall.calculateItemPrice(currentItem),$("#priceCustom").html(gmwa.utils.formatNumberHTML(currentItem.price))}else{for(var t=0;t<currentItem.customFields.length;t++)if(currentItem.customFields[t].id==e.id){currentItem.customFields.splice(t,1);break}currentItem.price=gmwa.controllers.storeSmall.calculateItemPrice(currentItem),$("#priceCustom").html(gmwa.utils.formatNumberHTML(currentItem.price))}if(1==r){var a=e.id,n=e.val;$(this).find("option[data-val="+n+"]");$(this).parent().hasClass("notavailable")&&($(".u-menu-option input[data-variant=1]").each(function(){$(this).parent().removeClass("notavailable"),$(this).attr("id")!="cf-"+a+"-"+n&&$(this).prop("checked",!1)}),$(".u-menu-option select[data-variant=1] option").val(""),$(".u-menu-option select[data-variant=1] option").each(function(){var e=$(this).data("val"),o=$(this).text();0!=e&&$(this).text(o)}));var l={};l.pInstId=$("#datos").data("id");o.data("unavailable");l.pairs=[],l.clickedPair={},l.clickedPair.cfId=e.id,l.clickedPair.cfOpId=e.val,l.pairs.push(l.clickedPair);for(var t=0;t<currentItem.customFields.length;t++)if(1==currentItem.customFields[t].variant){var i={};i.cfId=currentItem.customFields[t].id,i.cfOpId=currentItem.customFields[t].val,l.pairs.push(i)}var s="/pd/variant";gmwa.utils.showProgress("","",!1,!1),$.ajax({type:"POST",url:s,data:JSON.stringify(l),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){$(".u-menu-option input[data-variant=1]").each(function(){var e=$(this).data("id"),o=$(this).data("val");(l.clickedPair.cfId!=e||l.clickedPair.cfOpId!=o)&&($(this).parent().addClass("notavailable"),$(this).attr("data-unavailable",!0))}),$(".u-menu-option select[data-variant=1] option").each(function(){var e=$(this).text();$(this).data("id"),$(this).data("val");e.includes("[NO DISPONIBLE]")||$(this).text(e+" [NO DISPONIBLE]"),$(this).attr("data-unavailable",!0)}),e.data.pairs.forEach(function(e){$("#cf-"+e.cfId+"-"+e.cfOpId).parent().removeClass("notavailable"),cleanLabel=$(".u-menu-option select[data-variant=1] option[data-val="+e.cfOpId+"]").text().replace("[NO DISPONIBLE]",""),$(".u-menu-option select[data-variant=1] option[data-val="+e.cfOpId+"]").text(cleanLabel),$(".u-menu-option select[data-variant=1] option[data-val="+e.cfOpId+"]").attr("data-unavailable",!1)}),gmwa.utils.hideProgress()}).fail(function(e){gmwa.utils.hideProgress(),gmwa.logger.error("Product variant | API returned error: "+JSON.stringify(e))})}}),$("#lblSpInstr").click(function(e){$("#lblSpInstr").hide(),$("#txtSpInstr").show(0,function(){$("#textArea").focus()})}),$("#textArea").focusout(function(e){0===$("#textArea").val().length&&($("#lblSpInstr").show(),$("#txtSpInstr").hide())}),$("#ompaModify").click(function(e){})},gmwa.controllers.storeSmall.goToCheckout=function(){return null==carrito||0===carrito.items.length?(gmwa.utils.showError("El carrito esta vacio","Agrega algunos productos antes de finalizar la compra"),!1):!0},gmwa.controllers.storeSmall.addProductOpened=function(e){selectPrice=0,actualPrice=parseFloat($("#price").val()),e>0?($("#ompaAdd").click(gmwa.controllers.storeSmall.modifyProduct),$("#ompaAdd").text("Actualizar"),$("#ompaCancel, #ompaCancelTimes").click(gmwa.controllers.storeSmall.addProductCancel),currentItem=gmwa.controllers.storeSmall.cartGetItem(e),originalPrice=parseFloat($("#productOrigPrice").val())):($("#ompaAdd").click(gmwa.controllers.storeSmall.addProduct),$("#ompaCancel, #ompaCancelTimes").click(gmwa.controllers.storeSmall.addProductCancel),currentItem.customFields=[],currentItem.quantity=$("#quantityItem").val(),currentItem.price=actualPrice,currentItem.originalPrice=actualPrice,originalPrice=actualPrice),gmwa.controllers.storeSmall.initProductControls(),$(".swiper-wrapper").attr("style",""),setTimeout(function(){gmwa.controllers.storeSmall.imagesSwiper=new Swiper("#adImgGal",{slidesPerView:1,paginationClickable:!1,spaceBetween:0,pagination:{el:"#adImgGalPag",type:"bullets"}}),gmwa.controllers.storeSmall.pswp=$(".pswp")[0],gmwa.controllers.storeSmall.pswpItems=[],$(".additional-image, #adImgGal img").each(function(){if("moreImages"!=$(this).attr("id")){var e=$(this).data("zoom-image"),o=$(this).data("size").split("x"),r=o[0],t=o[1],a={src:e,w:r,h:t};gmwa.controllers.storeSmall.pswpItems.push(a)}}),$("#adImgGal img").on("click",function(e){e.preventDefault();var o=parseInt($(this).data("index")),r={index:o,bgOpacity:.7,showHideOpacity:!0,shareEl:!1,fullscreenEl:!1,tapToClose:!0,preload:[0,0]},t=new PhotoSwipe(gmwa.controllers.storeSmall.pswp,PhotoSwipeUI_Default,gmwa.controllers.storeSmall.pswpItems,r);t.init()})},500)},gmwa.controllers.storeSmall.addProductCheckMandatories=function(){var e=[],o=!0;$(".u-menu-option-options input[required]").each(function(){var o=$(this).attr("id").split("-"),r=$(this).data("name"),t=$(this).data("id"),a=Number(o[2]),n=$(this).is(":checked"),l={cfId:t,cfOpId:a,cfLabel:r,checked:n};e.push(l)});for(var r=0,t=!1,a=0;a<e.length;a++)0==r&&(r=e[a].cfId),r!=e[a].cfId&&(t||(gmwa.logger.log("Required custom field "+e[a-1].cfId+"-"+e[a-1].cfLabel+" is not checked"),o=!1),t=!1),e[a].checked&&(t=!0),a+1!=e.length||t||(gmwa.logger.log("Required custom field "+e[a].cfId+"-"+e[a].cfLabel+" is not checked 2"),o=!1),r=e[a].cfId;$(".u-menu-option-options select[required]").each(function(){cfId=$(this).val(),""==cfId&&(cfLabel=$(this).data("valcustomname"),gmwa.logger.log("Required custom field "+cfLabel+" is not checked"))});return e.forEach(function(e){}),o},gmwa.controllers.storeSmall.addProduct=function(e){e.preventDefault();var o=gmwa.controllers.storeSmall.getMainIDs(),r=new Date;o.dateTo=[r.getMonth()+1,r.getDate(),r.getFullYear()].join("/")+" "+[r.getHours(),r.getMinutes(),r.getSeconds()].join(":"),currentItem.notes=$("#additionalNotes").val(),currentItem.quantity&&currentItem.quantity>1?currentItem.price=$("#datos").data("price")*currentItem.quantity:currentItem.price=$("#datos").data("price"),currentItem.id=$("#datos").data("id"),o.token=$("#token").val(),o.idr=$("#retInfoCntr").data("idr"),o.ids=$("#retInfoCntr").data("ids"),o.type=$("#retInfoCntr").data("stype"),o.plist=[],o.plist.push(currentItem);var t=JSON.stringify(o),a="/pedido/agregar";return currentItem.productName=productName,gmwa.controllers.storeSmall.addProductCheckMandatories()?($("#lblError").html(""),gmwa.utils.showProgress("","",!1,!1),$.ajax({type:"POST",url:a,data:t,dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){200==e.meta.status?(gmwa.logger.log("Order Add Product | API returned OK: "+JSON.stringify(e)),gmwa.logger.log(t),currentItem.lineId=e.data.lineId,gmwa.controllers.storeSmall.cartAdd(currentItem),gmwa.controllers.storeSmall.cartDraw()):gmwa.logger.error("Order Add Product | API returned error: "+JSON.stringify(e)),gmwa.utils.hideProgress()}).fail(function(e){gmwa.logger.error("Order Add Product | API returned error: "+JSON.stringify(e)),gmwa.utils.hideProgress()}),void gmwa.controllers.storeSmall.addProductModal.foundation("close")):void $("#lblError").html("<strong>Campos invalidos</strong> Ingrese todos los datos obligatorios")},gmwa.controllers.storeSmall.modifyProduct=function(e){e.preventDefault(),gmwa.logger.log("El producto a modificar es "+$("#ompaId").val()+" con cantidad: "+$("#ompaQty").val()),currentItem.notes=$("#textArea").val();var o={};o.idr=$("#idr").val(),o.ids=$("#ids").val(),o.token=$("#token").val(),o.lineId=$("#lineId").val(),o.customFields=currentItem.customFields,o.notes=currentItem.notes,o.quantity=currentItem.quantity;var r=JSON.stringify(o),t="/pedido/editar";gmwa.utils.showProgress("","",!1,!1),$.ajax({type:"POST",url:t,data:r,dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){200==e.meta.status?(gmwa.logger.log("Order Edit Product | API returned OK: "+JSON.stringify(e)),gmwa.logger.log(r),gmwa.controllers.storeSmall.cartEdit(currentItem),gmwa.controllers.storeSmall.cartDraw()):gmwa.logger.error("Order Edit Product | API returned error: "+JSON.stringify(e)),gmwa.utils.hideProgress()}).fail(function(e){gmwa.utils.hideProgress(),gmwa.logger.error("Order Edit Product | API returned error: "+JSON.stringify(e))}),gmwa.controllers.storeSmall.addProductModal.foundation("close")},gmwa.controllers.storeSmall.addProductCancel=function(e){gmwa.controllers.storeSmall.addProductModal.foundation("close")},gmwa.controllers.storeSmall.iniciarAdministrador=function(){$(".line-edit").click(function(e){e.preventDefault();var o={};o.productId=$(this).attr("data-id"),o.lineId=$(this).attr("data-lineId"),o.token=carrito.token,o.idr=carrito.idr,o.ids=carrito.ids,o.type=0;var r="/pd/component/"+o.productId+"/"+o.idr+"/"+o.ids+"/"+o.token+"/0/1?lineId="+o.lineId;gmwa.utils.showProgress("","",!1,!1),$.ajax(r).done(function(e){$("#addProduct .u-reveal-body").html(e),gmwa.controllers.storeSmall.addProductOpened(o.lineId),gmwa.controllers.storeSmall.addProductModal.foundation("open"),gmwa.utils.hideProgress()}).fail(function(e){gmwa.utils.hideProgress(),gmwa.logger.error("Order Modify Product | API returned error: "+JSON.stringify(e))})}),$(".line-delete").click(function(e){e.preventDefault();var o={};$(this).attr("data-id");o.token=carrito.token,o.idr=carrito.idr,o.ids=carrito.ids,o.lineId=$(this).attr("data-lineId");var r=JSON.stringify(o),t="/pedido/quitar";gmwa.utils.showProgress("","",!1,!1),$.ajax({type:"POST",url:t,data:r,dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){200==e.meta.status?(gmwa.logger.log("Order Remove Product | API returned OK: "+JSON.stringify(e)),gmwa.logger.log(r),gmwa.controllers.storeSmall.cartDelete(o.lineId),gmwa.controllers.storeSmall.cartDraw()):gmwa.logger.error("Order Add Product | API returned error: "+JSON.stringify(e)),gmwa.utils.hideProgress()}).fail(function(e){gmwa.utils.hideProgress(),gmwa.logger.error("Order Add Product | API returned error: "+JSON.stringify(e))})})},gmwa.controllers.storeSmall.calculateItemPrice=function(e){for(var o=parseInt(e.originalPrice),r=0;r<e.customFields.length;r++)if(1==e.customFields[r].type)void 0!=e.customFields[r].price&&null!=e.customFields[r].price&&(o=parseInt(o)+parseInt(e.customFields[r].price));else if(2==e.customFields[r].type||3==e.customFields[r].type)if(Array.isArray(e.customFields[r].val))for(var t=0;t<e.customFields[r].val.length;t++)void 0!=e.customFields[r].val[t].checked&&1==e.customFields[r].val[t].checked&&void 0!=e.customFields[r].val[t].price&&null!=e.customFields[r].val[t].price&&(o=parseInt(o)+parseInt(e.customFields[r].val[t].price));else void 0!=e.customFields[r].price&&null!=e.customFields[r].price&&(o=parseInt(o)+parseInt(e.customFields[r].price));return o=parseInt(o)*parseInt(e.quantity)},gmwa.controllers.storeSmall.cartDraw=function(){var e="",o="",r=!1,t=0,a=0;if(0==carrito.items.length)e='<tr><td style="font-size: 12px;text-align: center;padding: 30px;">Nada por aqui. Busca un producto y agregalo a tu carrito</td></tr>';else{for(var n=0;n<carrito.items.length;n++){o="",r=!1,carrito.items[n].notes&&carrito.items[n].notes.length>0&&(r=!0,o=carrito.items[n].notes.length>20?"<p>"+carrito.items[n].notes.substring(0,15)+"... ":"<p>"+carrito.items[n].notes+" ");for(var l=0;l<carrito.items[n].customFields.length;l++)r?o+=", ":(o="<p>",r=!0),2==carrito.items[n].customFields[l].type?(o+=carrito.items[n].customFields[l].name+": "+carrito.items[n].customFields[l].optName,carrito.items[n].customFields[l].price>0&&(o+='<span style="font-size:90%"> ('+gmwa.utils.formatNumberHTML(carrito.items[n].customFields[l].price)+")</span>")):(o+=carrito.items[n].customFields[l].name,carrito.items[n].customFields[l].price>0&&(o+='<span style="font-size:90%"> ('+gmwa.utils.formatNumberHTML(carrito.items[n].customFields[l].price)+")</span>"));r&&(o+="</p>");var i=gmwa.utils.formatNumberObject(carrito.items[n].price);e+='<tr id="order-'+carrito.items[n].lineId+'" style="border-top: 1px solid #EEE;"><td>'+carrito.items[n].productName+o+'<div><a href="" class="line-edit" data-lineId='+carrito.items[n].lineId+" data-id="+carrito.items[n].id+' id="modifyOrder-'+carrito.items[n].lineId+'">Modificar </a><a href="" class="line-delete" data-lineId='+carrito.items[n].lineId+" data-id="+carrito.items[n].id+' id="deleteOrder-'+carrito.items[n].lineId+'">Quitar</a></div></td><td>x'+carrito.items[n].quantity+'</td><td class="price" style="text-align:right"><span class="currency">'+i.currency+" </span>"+i.number+'<span class="decimals">,'+i.decimals+"</span></td></tr>",t+=carrito.items[n].price}t=parseFloat(Math.round(100*t)/100),oSubTotal=gmwa.utils.formatNumberObject(t),e+='<tr style="border-top: 2px solid #DDD;"><td colspan="2" style="text-align:right;bstore-top: 1px dashed #DDD;padding-bottom: 1px;">Sub-total:</td><td style="bstore-top: 1px dashed #DDD;padding-bottom: 1px;text-align:right" class="price"><span class="currency">'+oSubTotal.currency+" </span>"+oSubTotal.number+'<span class="decimals">,'+oSubTotal.decimals+"</span></td></tr>",total=parseFloat(Math.round(100*(t+parseFloat(a)))/100),oTotal=gmwa.utils.formatNumberObject(total),e+='<tr><td colspan="2" style="text-align:right;padding-bottom: 1px;font-size: 20px;">Total:</td><td style="color: #159de1;font-weight: 600;padding-bottom: 1px;font-size: 20px;text-align:right" class="price"><span class="currency">'+oTotal.currency+" </span>"+oTotal.number+'<span class="decimals">,'+oTotal.decimals+"</span></td></tr>"}$("#carrito").html(e),gmwa.controllers.storeSmall.iniciarAdministrador(),gmwa.controllers.storeSmall.cartUpdateMobileQty()},gmwa.controllers.storeSmall.cartInit=function(){var e=new Date;carrito=gmwa.controllers.storeSmall.getMainIDs(),carrito.dateTo=[e.getMonth()+1,e.getDate(),e.getFullYear()].join("/")+" "+[e.getHours(),e.getMinutes(),e.getSeconds()].join(":"),carrito.items=[]},gmwa.controllers.storeSmall.cartAdd=function(e){var o=$.extend({},e);null===carrito&&gmwa.controllers.storeSmall.cartInit(),carrito.items.push(o),gmwa.controllers.storeSmall.cartUpdateMobileQty()},gmwa.controllers.storeSmall.cartEdit=function(e){var o=$.extend({},e);null===carrito&&gmwa.controllers.storeSmall.cartInit();for(var r=0;r<carrito.items.length;r++)if(carrito.items[r].lineId==o.lineId){carrito.items[r]=o;break}},gmwa.controllers.storeSmall.cartDelete=function(e){null===carrito&&gmwa.controllers.storeSmall.cartInit();for(var o=0;o<carrito.items.length;o++)if(carrito.items[o].lineId==e){carrito.items.splice(o,1);break}gmwa.controllers.storeSmall.cartUpdateMobileQty()},gmwa.controllers.storeSmall.cartGetItem=function(e){for(var o=0;o<carrito.items.length;o++)if(carrito.items[o].lineId==e)return carrito.items[o]},gmwa.controllers.storeSmall.cartUpdateMobileQty=function(){var e=carrito.items.length;e>0?(gmwa.controllers.storeSmall.mobileCarritoQty.css("display","inline-block"),gmwa.controllers.storeSmall.mobileCarritoQty.text(e)):gmwa.controllers.storeSmall.mobileCarritoQty.css("display","none")},gmwa.controllers.storeSmall.getMainIDs=function(){var e={},o=document.getElementById("token"),r=document.getElementById("idr"),t=document.getElementById("ids");if(o&&r&&t)return e.token=o.value,e.idr=r.value,e.ids=t.value,e;var a=document.location.href,n=a.split("/");if("store"==n[3])if(n.length>8){e.idr=n[n.length-5],e.ids=n[n.length-4];var l=n[n.length-1],i=l.split("#");e.token=i[0]}else e.idr=n[n.length-4],e.ids=n[n.length-3];else if("pedido"==n[3])if(n.length>8){var l=n[n.length-1],i=l.split("#");e.token=i[0],e.ids=n[n.length-2]}else e.ids=n[n.length-1];return e};